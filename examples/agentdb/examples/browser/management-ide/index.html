<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AgentDB Management IDE - Full-Featured Database & Vector Management System</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: hsl(0 0% 10%);
      --bg-secondary: hsl(0 0% 15%);
      --bg-tertiary: hsl(0 0% 20%);
      --border-color: hsl(0 0% 25%);
      --text-primary: hsl(0 0% 95%);
      --text-secondary: hsl(0 0% 70%);
      --text-muted: hsl(0 0% 50%);
      --accent: hsl(195 100% 60%);
      --accent-hover: hsl(195 100% 55%);
      --accent-dim: hsl(195 100% 60% / 0.1);
      --danger: hsl(0 76% 50%);
      --warning: hsl(45 76% 50%);
      --info: hsl(200 76% 50%);
      --success: hsl(195 100% 60%);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow: hidden;
    }

    /* Layout */
    .ide-container {
      display: grid;
      grid-template-rows: 60px 1fr;
      grid-template-columns: 250px 1fr 300px;
      height: 100vh;
      gap: 0;
    }

    /* Header */
    .ide-header {
      grid-column: 1 / -1;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.5rem;
    }

    .header-brand {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .brand-logo {
      font-size: 0.9375rem;
      font-weight: 400;
      font-family: 'Courier New', Monaco, monospace;
      color: var(--text-primary);
      letter-spacing: 0.02em;
    }

    .brand-prompt {
      color: var(--accent);
      font-weight: 600;
    }

    .brand-subtitle {
      color: var(--text-muted);
      font-size: 0.75rem;
      font-family: 'Courier New', Monaco, monospace;
      opacity: 0.6;
    }

    .header-stats {
      display: flex;
      gap: 2rem;
      align-items: center;
      margin-left: auto;
      margin-right: 2rem;
      font-family: 'Courier New', Monaco, monospace;
      font-size: 0.8125rem;
    }

    .header-stat {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-secondary);
    }

    .header-stat-label {
      color: var(--text-muted);
    }

    .header-stat-value {
      color: var(--accent);
      font-weight: 600;
    }

    .header-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .header-link {
      color: var(--text-muted);
      text-decoration: none;
      font-weight: 400;
      font-size: 0.8125rem;
      font-family: 'Courier New', Monaco, monospace;
      transition: color 0.2s;
      border-bottom: 1px solid transparent;
    }

    .header-link:hover {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }

    /* Sidebar */
    .ide-sidebar {
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-color);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .sidebar-section {
      padding: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .sidebar-title {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 0.75rem;
      letter-spacing: 0.05em;
    }

    .sidebar-nav {
      list-style: none;
    }

    .nav-item {
      padding: 0.625rem 0.75rem;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.2s;
      margin-bottom: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
    }

    .nav-item:hover {
      background: var(--bg-tertiary);
    }

    .nav-item.active {
      background: var(--accent-dim);
      color: var(--accent);
      font-weight: 600;
    }

    .nav-icon {
      width: 16px;
      opacity: 0.7;
    }

    .nav-item.active .nav-icon {
      opacity: 1;
    }

    /* Main Content */
    .ide-main {
      background: var(--bg-primary);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .main-tabs {
      display: flex;
      gap: 0.25rem;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 0.5rem 0.75rem 0;
    }

    .main-tabs.hidden {
      display: none;
    }

    .main-tab {
      padding: 0.5rem 1rem;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: 6px 6px 0 0;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s;
      border-bottom: 2px solid transparent;
    }

    .main-tab:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .main-tab.active {
      background: var(--bg-primary);
      color: var(--accent);
      border-bottom-color: var(--accent);
    }

    .main-content {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
    }

    /* Tab Content Panels */
    .tab-content-panel {
      display: none;
    }

    .tab-content-panel.active {
      display: block;
    }

    .content-panel {
      display: none;
    }

    .content-panel.active {
      display: block;
    }

    /* Dashboard Styles */
    .dashboard-welcome {
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      font-family: 'Courier New', Monaco, monospace;
    }

    .dashboard-hero {
      padding: 1.5rem;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(75, 85, 99, 0.3);
      border-radius: 8px;
      margin-bottom: 2rem;
    }

    .dashboard-hero-title {
      font-size: 1rem;
      font-weight: 400;
      margin-bottom: 0.5rem;
      color: var(--text-secondary);
      font-family: 'Courier New', Monaco, monospace;
    }

    .dashboard-hero-title::before {
      content: '# ';
      color: var(--accent);
    }

    .dashboard-hero-subtitle {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-bottom: 1.5rem;
      line-height: 1.6;
      padding-left: 1rem;
    }

    .dashboard-hero-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .dashboard-card {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(75, 85, 99, 0.3);
      border-left: 3px solid #6b7280;
      border-radius: 4px;
      padding: 1rem;
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .dashboard-card:hover {
      border-left-color: #22c55e;
      background: rgba(34, 197, 94, 0.05);
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.15);
    }

    .dashboard-card-icon {
      font-size: 1rem;
      margin-bottom: 0.5rem;
      display: inline;
      margin-right: 0.5rem;
    }

    .dashboard-card-title {
      font-size: 0.875rem;
      font-weight: 400;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      display: inline;
    }

    .dashboard-card-description {
      color: var(--text-muted);
      font-size: 0.75rem;
      line-height: 1.5;
      margin-bottom: 0.75rem;
      padding-left: 1.5rem;
    }

    .dashboard-card-stats {
      display: flex;
      gap: 1.5rem;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(75, 85, 99, 0.3);
      font-size: 0.75rem;
    }

    .dashboard-card-stat {
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
    }

    .dashboard-card-stat-label {
      color: var(--text-muted);
    }

    .dashboard-card-stat-value {
      color: var(--accent);
      font-weight: 600;
    }

    .dashboard-quick-actions {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(75, 85, 99, 0.3);
      border-radius: 8px;
      padding: 1.5rem;
    }

    .dashboard-quick-actions-title {
      font-size: 0.875rem;
      font-weight: 400;
      margin-bottom: 1rem;
      color: var(--text-secondary);
    }

    .dashboard-quick-actions-title::before {
      content: '> ';
      color: var(--accent);
    }

    .dashboard-actions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 0.5rem;
    }

    .dashboard-action-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(75, 85, 99, 0.3);
      border-radius: 4px;
      color: #9ca3af;
      text-decoration: none;
      transition: all 0.2s;
      cursor: pointer;
      font-weight: 400;
      font-size: 0.8125rem;
    }

    .dashboard-action-btn:hover {
      background: rgba(34, 197, 94, 0.1);
      border-color: rgba(34, 197, 94, 0.5);
      color: #22c55e;
    }

    .dashboard-action-icon {
      font-size: 1rem;
    }

    /* Right Panel */
    .ide-panel {
      background: var(--bg-secondary);
      border-left: 1px solid var(--border-color);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .panel-header {
      padding: 1rem;
      border-bottom: 1px solid var(--border-color);
      font-weight: 600;
      font-size: 0.875rem;
    }

    .panel-content {
      padding: 1rem;
      flex: 1;
    }

    /* Console */
    .ide-console {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.95);
      border-top: 1px solid rgba(75, 85, 99, 0.5);
      display: flex;
      flex-direction: column;
      z-index: 1000;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
      transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      max-height: 300px;
    }

    .ide-console.collapsed {
      max-height: 48px;
    }

    .console-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid rgba(75, 85, 99, 0.3);
      cursor: pointer;
      transition: background 0.2s ease;
      flex-shrink: 0;
    }

    .console-header:hover {
      background: rgba(34, 197, 94, 0.05);
    }

    .console-title {
      font-weight: 600;
      font-size: 0.875rem;
      color: #9ca3af;
      font-family: 'Courier New', Monaco, monospace;
    }

    .console-toggle {
      color: #22c55e;
      font-size: 0.875rem;
      transition: transform 0.3s ease;
      display: inline-block;
      line-height: 1;
    }

    .ide-console.collapsed .console-toggle {
      transform: rotate(180deg);
    }

    .ide-console.collapsed .console-header {
      border-bottom: none;
    }

    .console-actions {
      display: flex;
      gap: 0.5rem;
    }

    .console-content {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 0.75rem;
      font-family: 'Courier New', monospace;
      font-size: 0.75rem;
      min-height: 0;
      opacity: 1;
      transition: opacity 0.2s ease;
    }

    .ide-console.collapsed .console-content {
      opacity: 0;
      overflow: hidden;
    }

    .console-log {
      padding: 0.25rem 0.5rem;
      margin-bottom: 0.125rem;
      border-radius: 3px;
      display: flex;
      gap: 0.5rem;
      align-items: flex-start;
    }

    .console-log .timestamp {
      color: var(--text-muted);
      min-width: 80px;
    }

    .console-log .type {
      min-width: 60px;
      font-weight: 600;
    }

    .console-log.info { background: hsl(200 76% 50% / 0.05); }
    .console-log.info .type { color: var(--info); }

    .console-log.success { background: hsl(142 76% 50% / 0.05); }
    .console-log.success .type { color: var(--success); }

    .console-log.warning { background: hsl(45 76% 50% / 0.05); }
    .console-log.warning .type { color: var(--warning); }

    .console-log.error { background: hsl(0 76% 50% / 0.05); }
    .console-log.error .type { color: var(--danger); }

    /* Buttons */
    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--accent);
      color: hsl(0 0% 10%);
    }

    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--bg-secondary);
    }

    .btn-sm {
      padding: 0.375rem 0.75rem;
      font-size: 0.75rem;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    /* Editor */
    .editor-container {
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(75, 85, 99, 0.3);
      border-radius: 8px;
      overflow: hidden;
    }

    .editor-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      background: rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(75, 85, 99, 0.3);
    }

    .editor-toolbar::before {
      content: '';
      display: flex;
      align-items: center;
      gap: 0.5rem;
      position: absolute;
      left: 1rem;
    }

    .editor-textarea {
      width: 100%;
      min-height: 300px;
      background: rgba(0, 0, 0, 0.8);
      color: #e5e7eb;
      border: none;
      padding: 1rem;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      resize: vertical;
      outline: none;
    }

    /* Table */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--bg-secondary);
      border-radius: 8px;
      overflow: hidden;
    }

    .data-table th,
    .data-table td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    .data-table th {
      background: var(--bg-tertiary);
      font-weight: 600;
      font-size: 0.75rem;
      text-transform: uppercase;
      color: var(--text-secondary);
    }

    .data-table tr:hover {
      background: var(--bg-tertiary);
    }

    .data-table td {
      font-size: 0.875rem;
    }

    /* Cards */
    .card {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(75, 85, 99, 0.3);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .card-title {
      font-size: 0.9375rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: #22c55e;
      font-family: 'Courier New', Monaco, monospace;
    }

    .card-title::before {
      content: '$ ';
      color: #22c55e;
    }

    .metric-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .metric {
      background: var(--bg-tertiary);
      padding: 1rem;
      border-radius: 6px;
      border: 1px solid var(--border-color);
    }

    .metric-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      margin-bottom: 0.5rem;
    }

    .metric-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent);
    }

    /* Forms */
    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-secondary);
    }

    .form-input,
    .form-select {
      width: 100%;
      padding: 0.625rem 0.875rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 0.875rem;
      transition: border-color 0.2s;
    }

    .form-input:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--accent);
    }

    .form-checkbox {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
    }

    .form-checkbox input {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: hsl(0 0% 0% / 0.7);
      backdrop-filter: blur(4px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: rgba(0, 0, 0, 0.95);
      border: 1px solid rgba(75, 85, 99, 0.5);
      border-radius: 8px;
      max-width: 900px;
      max-height: 90vh;
      width: 90%;
      display: flex;
      flex-direction: column;
      box-shadow: 0 24px 48px rgba(0, 0, 0, 0.6);
    }

    .modal-large {
      max-width: 800px;
      width: 95%;
    }

    .modal-header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid rgba(75, 85, 99, 0.3);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0, 0, 0, 0.4);
    }

    .modal-header::before {
      content: '';
      display: flex;
      gap: 0.5rem;
      margin-right: 1rem;
      background-image:
        radial-gradient(circle, #374151 40%, transparent 40%),
        radial-gradient(circle, #4b5563 40%, transparent 40%),
        radial-gradient(circle, #22c55e 40%, transparent 40%);
      background-size: 12px 12px;
      background-position: 0 0, 16px 0, 32px 0;
      background-repeat: no-repeat;
      width: 44px;
      height: 12px;
    }

    .modal-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: #9ca3af;
      font-family: 'Courier New', Monaco, monospace;
      text-transform: lowercase;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.2s;
    }

    .modal-close:hover {
      color: var(--text-primary);
    }

    .modal-body {
      padding: 1.5rem;
      overflow-y: auto;
      flex: 1;
      background: rgba(0, 0, 0, 0.2);
    }

    .modal-body.help-content {
      padding: 0;
    }

    .help-content {
      width: 100%;
      padding: 0;
    }

    .modal-footer {
      padding: 1.5rem;
      border-top: 1px solid rgba(75, 85, 99, 0.3);
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      background: rgba(0, 0, 0, 0.4);
    }

    /* Help Modal Specific Styles */
    .help-tabs {
      display: flex;
      gap: 0.25rem;
      padding: 0.5rem 0;
      background: rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(75, 85, 99, 0.3);
      overflow-x: auto;
    }

    .help-tab {
      padding: 0.5rem 1.5rem;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: #9ca3af;
      font-size: 0.8125rem;
      font-family: 'Courier New', Monaco, monospace;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .help-tab:first-child {
      margin-left: 1rem;
    }

    .help-tab:last-child {
      margin-right: 1rem;
    }

    .help-tab:hover {
      color: #e5e7eb;
      background: rgba(34, 197, 94, 0.05);
    }

    .help-tab.active {
      color: #22c55e;
      border-bottom-color: #22c55e;
    }

    .help-tab-content {
      display: none;
    }

    .help-tab-content.active {
      display: block;
      padding: 1.5rem;
    }

    .help-subsection-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(75, 85, 99, 0.2);
    }

    .help-subtab {
      padding: 0.375rem 0.75rem;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(75, 85, 99, 0.3);
      border-radius: 4px;
      color: #9ca3af;
      font-size: 0.75rem;
      font-family: 'Courier New', Monaco, monospace;
      cursor: pointer;
      transition: all 0.2s;
    }

    .help-subtab:hover {
      background: rgba(34, 197, 94, 0.1);
      border-color: #22c55e;
      color: #22c55e;
    }

    .help-subtab.active {
      background: rgba(34, 197, 94, 0.15);
      border-color: #22c55e;
      color: #22c55e;
    }

    .help-subsection {
      display: none;
    }

    .help-subsection.active {
      display: block;
    }

    .help-content h3 {
      color: #22c55e;
      font-family: 'Courier New', Monaco, monospace;
      font-size: 1.125rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(75, 85, 99, 0.3);
    }

    .help-content h4 {
      color: #e5e7eb;
      font-family: 'Courier New', Monaco, monospace;
      font-size: 0.9375rem;
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
    }

    .help-content p {
      color: #d1d5db;
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .help-content ul, .help-content ol {
      color: #d1d5db;
      margin-left: 1.5rem;
      margin-bottom: 1rem;
    }

    .help-content li {
      margin-bottom: 0.5rem;
      line-height: 1.6;
    }

    .help-content code {
      background: rgba(34, 197, 94, 0.1);
      color: #22c55e;
      padding: 0.125rem 0.375rem;
      border-radius: 3px;
      font-family: 'Courier New', Monaco, monospace;
      font-size: 0.875em;
    }

    .help-card {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(75, 85, 99, 0.3);
      border-left: 3px solid #22c55e;
      border-radius: 4px;
      padding: 1.25rem;
      margin-bottom: 1.5rem;
      transition: all 0.2s ease;
    }

    .help-card:hover {
      background: rgba(34, 197, 94, 0.05);
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.15);
    }

    .help-card h4 {
      margin-top: 0;
      margin-bottom: 0.75rem;
      color: #22c55e;
      font-family: 'Courier New', Monaco, monospace;
    }

    .help-card h4::before {
      content: '> ';
      color: #22c55e;
    }

    .help-code-example {
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(75, 85, 99, 0.3);
      border-radius: 4px;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }

    .help-code-example h4 {
      margin-top: 0;
      margin-bottom: 0.75rem;
      color: #9ca3af;
      font-size: 0.875rem;
      font-family: 'Courier New', Monaco, monospace;
    }

    .help-code-example pre {
      margin: 0;
      background: rgba(0, 0, 0, 0.4);
      padding: 1rem;
      border-radius: 4px;
      overflow-x: auto;
    }

    .help-code-example code {
      color: #22c55e;
      font-family: 'Courier New', Monaco, monospace;
      font-size: 0.8125rem;
      line-height: 1.5;
    }

    .help-steps {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      margin: 1.5rem 0;
    }

    .help-step {
      display: flex;
      gap: 1rem;
      align-items: flex-start;
    }

    .help-step-number {
      flex-shrink: 0;
      width: 32px;
      height: 32px;
      background: rgba(34, 197, 94, 0.2);
      border: 2px solid #22c55e;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #22c55e;
      font-weight: 700;
      font-family: 'Courier New', Monaco, monospace;
    }

    .help-step-content h4 {
      margin-top: 0;
    }

    .help-tip {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      border-radius: 4px;
      padding: 0.75rem 1rem;
      margin: 1rem 0;
      color: #d1d5db;
    }

    .help-tip strong {
      color: #22c55e;
    }

    .help-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(75, 85, 99, 0.3);
      border-radius: 4px;
      overflow: hidden;
    }

    .help-table thead {
      background: rgba(0, 0, 0, 0.6);
    }

    .help-table th {
      padding: 0.75rem 1rem;
      text-align: left;
      color: #22c55e;
      font-family: 'Courier New', Monaco, monospace;
      font-size: 0.8125rem;
      font-weight: 600;
      border-bottom: 1px solid rgba(75, 85, 99, 0.3);
    }

    .help-table td {
      padding: 0.75rem 1rem;
      color: #d1d5db;
      font-family: 'Courier New', Monaco, monospace;
      font-size: 0.8125rem;
      border-bottom: 1px solid rgba(75, 85, 99, 0.2);
    }

    .help-table tbody tr:last-child td {
      border-bottom: none;
    }

    .help-table tbody tr:hover {
      background: rgba(34, 197, 94, 0.05);
    }

    .help-table code {
      background: rgba(34, 197, 94, 0.15);
      padding: 0.125rem 0.375rem;
      border-radius: 3px;
    }

    .help-section {
      padding: 0;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 0.5rem;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 1.5rem;
    }

    .tab-button {
      padding: 0.75rem 1.25rem;
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 600;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .tab-button:hover {
      color: var(--text-primary);
    }

    .tab-button.active {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Schema Tree */
    .schema-tree {
      font-size: 0.875rem;
    }

    .schema-table {
      margin-bottom: 0.75rem;
    }

    .schema-table-name {
      font-weight: 600;
      padding: 0.5rem;
      background: var(--bg-tertiary);
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .schema-table-name:hover {
      background: var(--border-color);
    }

    .schema-columns {
      margin-left: 1.5rem;
      margin-top: 0.5rem;
    }

    .schema-column {
      padding: 0.375rem 0.5rem;
      color: var(--text-secondary);
      font-family: 'Courier New', monospace;
    }

    /* Stats */
    .stat-bar {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .stat-label {
      min-width: 120px;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .stat-value {
      flex: 1;
      height: 24px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      position: relative;
      overflow: hidden;
    }

    .stat-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-hover));
      transition: width 0.3s;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 0.5rem;
    }

    .stat-text {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--bg-primary);
    }

    /* Query Results */
    .result-container {
      margin-top: 1rem;
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .result-info {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .empty-state-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .empty-state-text {
      font-size: 0.875rem;
    }

    /* Episode Analytics Components */
    .stat-card {
      background: var(--bg-tertiary);
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .stat-card-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .stat-card-value {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 0.25rem;
    }

    .stat-card-trend {
      font-size: 0.75rem;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .stat-card-trend.positive {
      color: var(--success);
    }

    .stat-card-trend.negative {
      color: var(--danger);
    }

    /* View Mode Buttons */
    .view-mode-btn {
      background: transparent;
      border: none;
      padding: 0.5rem 1rem;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s;
      border-bottom: 2px solid transparent;
    }

    .view-mode-btn:hover {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }

    .view-mode-btn.active {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }

    /* Episode Card Enhancements */
    .episode-card {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }

    .episode-card:hover {
      border-color: var(--accent);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transform: translateX(4px);
    }

    .episode-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--accent);
      opacity: 0;
      transition: opacity 0.2s;
    }

    .episode-card:hover::before {
      opacity: 1;
    }

    .episode-card.reward-high::before {
      background: var(--success);
    }

    .episode-card.reward-medium::before {
      background: var(--warning);
    }

    .episode-card.reward-low::before {
      background: var(--danger);
    }

    .episode-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 0.75rem;
    }

    .episode-title {
      font-weight: 600;
      font-size: 1rem;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .episode-badges {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 0.5rem;
    }

    .episode-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.5rem;
      background: var(--bg-primary);
      border-radius: 4px;
      font-size: 0.7rem;
      font-weight: 500;
      border: 1px solid var(--border-color);
    }

    .episode-badge.success {
      background: var(--success);
      color: var(--bg-primary);
      border-color: var(--success);
    }

    .episode-badge.warning {
      background: var(--warning);
      color: var(--bg-primary);
      border-color: var(--warning);
    }

    .episode-badge.danger {
      background: var(--danger);
      color: var(--text-primary);
      border-color: var(--danger);
    }

    .episode-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid var(--border-color);
    }

    .episode-action-btn {
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      border-radius: 4px;
      border: 1px solid var(--border-color);
      background: var(--bg-secondary);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
    }

    .episode-action-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border-color: var(--accent);
    }

    /* Histogram Styles */
    .histogram-bar {
      flex: 1;
      background: var(--accent);
      border-radius: 2px 2px 0 0;
      min-height: 2px;
      transition: all 0.3s;
      cursor: pointer;
      position: relative;
    }

    .histogram-bar:hover {
      opacity: 0.8;
      transform: scaleY(1.1);
    }

    .histogram-bar::after {
      content: attr(data-count);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-primary);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.7rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .histogram-bar:hover::after {
      opacity: 1;
    }

    /* Timeline View */
    .timeline-container {
      position: relative;
      padding-left: 2.5rem;
      padding-top: 0.5rem;
    }

    .timeline-line {
      position: absolute;
      left: 0.65rem;
      top: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(180deg, rgba(34, 197, 94, 0.3) 0%, rgba(107, 114, 128, 0.2) 100%);
      border-radius: 2px;
    }

    .timeline-item {
      position: relative;
      padding: 1.25rem;
      margin-bottom: 1.25rem;
      background: linear-gradient(135deg, rgba(15, 20, 25, 0.8) 0%, rgba(26, 31, 46, 0.6) 100%);
      border-radius: 10px;
      border: 1px solid rgba(75, 85, 99, 0.3);
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .timeline-item:hover {
      transform: translateX(4px);
      border-color: rgba(34, 197, 94, 0.5);
      box-shadow: 0 4px 16px rgba(34, 197, 94, 0.15);
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: -2.15rem;
      top: 1.5rem;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #22c55e;
      border: 3px solid rgba(15, 20, 25, 0.95);
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
      z-index: 2;
      transition: all 0.3s ease;
    }

    .timeline-item:hover::before {
      box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.3), 0 0 12px rgba(34, 197, 94, 0.5);
      transform: scale(1.15);
    }

    .timeline-item.success::before {
      background: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
    }

    .timeline-item.failure::before {
      background: #6b7280;
      box-shadow: 0 0 0 3px rgba(107, 114, 128, 0.2);
    }

    /* Trajectory Chart */
    .trajectory-container {
      background: var(--bg-tertiary);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    .trajectory-chart {
      position: relative;
      height: 150px;
      background: var(--bg-primary);
      border-radius: 4px;
      overflow: hidden;
    }

    .trajectory-path {
      stroke: var(--accent);
      stroke-width: 2;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .trajectory-point {
      fill: var(--accent);
      cursor: pointer;
      transition: r 0.2s;
    }

    .trajectory-point:hover {
      fill: var(--accent-hover);
    }

    /* Comparison View */
    .comparison-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }

    .comparison-item {
      background: var(--bg-tertiary);
      padding: 1rem;
      border-radius: 8px;
      border: 2px solid transparent;
      transition: border-color 0.2s;
    }

    .comparison-item.selected {
      border-color: var(--accent);
    }

    .comparison-item.winner {
      border-color: var(--success);
      background: linear-gradient(135deg, var(--bg-tertiary) 0%, rgba(142, 76, 50, 0.1) 100%);
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-primary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-muted);
    }

    /* Syntax Highlighting */
    .sql-keyword { color: hsl(270 76% 70%); font-weight: 600; }
    .sql-string { color: hsl(142 76% 60%); }
    .sql-number { color: hsl(45 76% 60%); }
    .sql-comment { color: var(--text-muted); font-style: italic; }

    /* Vector Display */
    .vector-display {
      background: var(--bg-tertiary);
      padding: 1rem;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 0.75rem;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 0.5rem;
    }

    .vector-value {
      display: inline-block;
      margin: 0.125rem;
      padding: 0.25rem 0.375rem;
      background: var(--bg-primary);
      border-radius: 3px;
      color: var(--accent);
    }

    /* Help System */
    .help-section {
      margin-bottom: 2rem;
    }

    .help-section h3 {
      color: var(--accent);
      margin-bottom: 0.75rem;
      font-size: 1.125rem;
    }

    .help-section h4 {
      color: var(--text-primary);
      margin-top: 1rem;
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }

    .help-section p {
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
      line-height: 1.8;
    }

    .help-code {
      background: var(--bg-primary);
      padding: 0.125rem 0.375rem;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      color: var(--accent);
    }

    /* Trajectory Visualization */
    .stat-card {
      background: var(--bg-tertiary);
      padding: 1.5rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      text-align: center;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 0.5rem;
    }

    .stat-label {
      font-size: 0.875rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .stat-trend {
      display: inline-block;
      margin-left: 0.5rem;
      font-size: 1.25rem;
    }

    .trend-up { color: var(--success); }
    .trend-stable { color: var(--warning); }
    .trend-down { color: var(--danger); }

    .trajectory-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .trajectory-chart {
      background: var(--bg-tertiary);
      padding: 1.5rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      margin-bottom: 2rem;
    }

    .chart-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .timeline {
      position: relative;
      padding: 1rem 0;
    }

    .timeline-item {
      display: flex;
      align-items: center;
      margin-bottom: 0.75rem;
      padding: 0.75rem;
      background: var(--bg-secondary);
      border-radius: 6px;
      border-left: 3px solid var(--border-color);
      transition: all 0.2s;
    }

    .timeline-item:hover {
      background: var(--bg-primary);
      transform: translateX(4px);
    }

    .timeline-item.reward-high {
      border-left-color: var(--success);
    }

    .timeline-item.reward-medium {
      border-left-color: var(--warning);
    }

    .timeline-item.reward-low {
      border-left-color: var(--danger);
    }

    .timeline-marker {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 1rem;
      flex-shrink: 0;
    }

    .reward-high .timeline-marker {
      background: var(--success);
      box-shadow: 0 0 8px var(--success);
    }

    .reward-medium .timeline-marker {
      background: var(--warning);
      box-shadow: 0 0 8px var(--warning);
    }

    .reward-low .timeline-marker {
      background: var(--danger);
      box-shadow: 0 0 8px var(--danger);
    }

    .timeline-content {
      flex: 1;
    }

    .timeline-task {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .timeline-reward {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .timeline-time {
      font-size: 0.75rem;
      color: var(--text-muted);
      white-space: nowrap;
      margin-left: 1rem;
    }

    .progress-bar-container {
      background: var(--bg-secondary);
      border-radius: 4px;
      height: 24px;
      overflow: hidden;
      margin-bottom: 0.5rem;
      position: relative;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-dim), var(--accent));
      transition: width 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding: 0 0.5rem;
    }

    .progress-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-primary);
      position: absolute;
      right: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
    }

    .reward-distribution {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .reward-bar {
      flex: 1;
      text-align: center;
      padding: 0.5rem;
      border-radius: 6px;
      font-size: 0.875rem;
    }

    .reward-bar-high {
      background: hsl(142 76% 50% / 0.2);
      border: 1px solid var(--success);
      color: var(--success);
    }

    .reward-bar-medium {
      background: hsl(45 76% 50% / 0.2);
      border: 1px solid var(--warning);
      color: var(--warning);
    }

    .reward-bar-low {
      background: hsl(0 76% 50% / 0.2);
      border: 1px solid var(--danger);
      color: var(--danger);
    }

    .strategy-list {
      list-style: none;
      padding: 0;
    }

    .strategy-item {
      display: flex;
      justify-content: space-between;
      padding: 0.75rem;
      background: var(--bg-secondary);
      border-radius: 6px;
      margin-bottom: 0.5rem;
      border-left: 3px solid var(--accent);
    }

    .strategy-name {
      color: var(--text-primary);
      font-weight: 500;
    }

    .strategy-score {
      color: var(--accent);
      font-weight: 700;
    }

    .help-example {
      background: var(--bg-tertiary);
      padding: 1rem;
      border-radius: 6px;
      border-left: 3px solid var(--accent);
      margin: 1rem 0;
    }

    .help-example pre {
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      overflow-x: auto;
      color: var(--text-primary);
    }

    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 48px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--bg-tertiary);
      transition: 0.3s;
      border-radius: 24px;
      border: 1px solid var(--border-color);
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 3px;
      bottom: 3px;
      background-color: var(--text-muted);
      transition: 0.3s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: var(--accent);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(24px);
      background-color: white;
    }

    /* Pagination */
    .pagination {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      margin-top: 1.5rem;
    }

    .page-btn {
      padding: 0.5rem 0.75rem;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      cursor: pointer;
      border-radius: 4px;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .page-btn:hover {
      background: var(--border-color);
    }

    .page-btn.active {
      background: var(--accent);
      color: var(--bg-primary);
      border-color: var(--accent);
    }

    .page-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Search */
    .search-box {
      position: relative;
      margin-bottom: 1rem;
    }

    .search-input {
      width: 100%;
      padding: 0.625rem 0.875rem 0.625rem 2.5rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 0.875rem;
    }

    .search-icon {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
    }

    /* Status Badge */
    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.625rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-badge.success {
      background: hsl(142 76% 50% / 0.1);
      color: var(--success);
    }

    .status-badge.error {
      background: hsl(0 76% 50% / 0.1);
      color: var(--danger);
    }

    .status-badge.warning {
      background: hsl(45 76% 50% / 0.1);
      color: var(--warning);
    }

    .status-badge.info {
      background: hsl(200 76% 50% / 0.1);
      color: var(--info);
    }

    /* Help Button */
    .help-btn {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      padding: 0.375rem 0.75rem;
      background: var(--accent-dim);
      color: var(--accent);
      border: 1px solid var(--accent);
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.75rem;
      font-weight: 600;
      transition: all 0.2s;
    }

    .help-btn:hover {
      background: var(--accent);
      color: var(--bg-primary);
    }

    /* Mobile Hamburger */
    .mobile-menu-toggle {
      display: none;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
    }

    /* Feature Grid */
    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .feature-card {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 1rem;
      transition: all 0.2s;
    }

    .feature-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .feature-card h4 {
      color: var(--accent);
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
    }

    .feature-card p {
      color: var(--text-secondary);
      font-size: 0.75rem;
      line-height: 1.5;
    }

    /* Code Block */
    .code-block {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 1rem;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      line-height: 1.6;
      margin: 0.75rem 0;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .ide-container {
        grid-template-columns: 200px 1fr;
        grid-template-rows: 60px 1fr;
      }

      .ide-info {
        display: none;
      }

      .ide-sidebar {
        width: 200px;
      }
    }

    @media (max-width: 768px) {
      .ide-container {
        grid-template-columns: 1fr;
        grid-template-rows: 60px 1fr;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .ide-sidebar {
        position: fixed;
        left: -250px;
        top: 60px;
        height: calc(100vh - 60px);
        width: 250px;
        z-index: 1000;
        transition: left 0.3s ease;
        box-shadow: 2px 0 10px rgba(0,0,0,0.5);
      }

      .ide-sidebar.mobile-open {
        left: 0;
      }

      .header-brand .brand-subtitle {
        display: none;
      }

      .header-actions {
        gap: 0.5rem;
      }

      .header-link {
        display: none;
      }

      .ide-info {
        display: none;
      }

      .main-content {
        padding: 1rem;
      }

      .feature-grid {
        grid-template-columns: 1fr;
      }

      .modal {
        width: 95%;
        max-height: 90vh;
      }

      .ide-console {
        grid-column: 1 / -1;
        min-height: 150px;
      }
    }

    @media (max-width: 480px) {
      .ide-header {
        padding: 0 1rem;
      }

      .brand-logo {
        font-size: 1.25rem;
      }

      .main-tabs {
        padding: 0.25rem 0.5rem 0;
        overflow-x: auto;
      }

      .main-tab {
        padding: 0.375rem 0.75rem;
        font-size: 0.8125rem;
        white-space: nowrap;
      }

      .btn {
        padding: 0.5rem 0.75rem;
        font-size: 0.8125rem;
      }

      .card-title {
        font-size: 0.9375rem;
      }
    }

    /* Mobile Sidebar Overlay */
    .mobile-overlay {
      display: none;
      position: fixed;
      top: 60px;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 999;
    }

    .mobile-overlay.active {
      display: block;
    }

    /* Advanced Query Optimizer Styles */
    .optimizer-tab-content {
      display: none;
    }

    .optimizer-tab.active {
      background: var(--primary-color);
      color: white;
    }

    .library-item {
      transition: all 0.2s ease;
    }

    .library-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .library-filter.active {
      background: var(--primary-color);
      color: white;
    }

    .badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
    }
  </style>
  <!-- Enhancement Stylesheets -->
  <link rel="stylesheet" href="pattern-enhancements.css">
  <link rel="stylesheet" href="help-system.css">
</head>
<body>

  <!-- IDE Container -->
  <div class="ide-container">

    <!-- Header -->
    <header class="ide-header">
      <div class="header-brand">
        <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Toggle menu"></button>
        <div class="brand-logo">
          <span class="brand-prompt"></span> agentdb --mode=ide
        </div>
        <div class="brand-subtitle">// Vector Database & Agentic Memory System</div>
      </div>
      <div class="header-stats">
        <div class="header-stat">
          <span class="header-stat-label">tables:</span>
          <span class="header-stat-value" id="header-table-count">0</span>
        </div>
        <div class="header-stat">
          <span class="header-stat-label">patterns:</span>
          <span class="header-stat-value" id="header-pattern-count">0</span>
        </div>
        <div class="header-stat">
          <span class="header-stat-label">episodes:</span>
          <span class="header-stat-value" id="header-episode-count">0</span>
        </div>
      </div>
      <div class="header-actions">
        <a href="https://agentdb.ruv.io" target="_blank" class="header-link">[home]</a>
        <a href="https://agentdb.ruv.io/demo" target="_blank" class="header-link">[docs]</a>
        <a href="https://github.com/ruvnet/agentic-flow/tree/main/packages/agentdb" target="_blank" class="header-link">[github]</a>
        <button class="btn btn-primary btn-sm" onclick="showHelp()" style="font-family: 'Courier New', Monaco, monospace; text-transform: lowercase;">help</button>
      </div>
    </header>

    <!-- Mobile Sidebar Overlay -->
    <div class="mobile-overlay" id="mobileOverlay" onclick="toggleMobileMenu()"></div>

    <!-- Sidebar -->
    <aside class="ide-sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Navigation</div>
        <ul class="sidebar-nav">
          <li class="nav-item active" onclick="switchView('dashboard')">
            <span class="nav-icon"></span>
            Dashboard
          </li>
          <li class="nav-item" onclick="switchView('sql-editor')">
            <span class="nav-icon"></span>
            SQL Editor
          </li>
          <li class="nav-item" onclick="switchView('data-browser')">
            <span class="nav-icon"></span>
            Data Browser
          </li>
          <li class="nav-item" onclick="switchView('patterns')">
            <span class="nav-icon"></span>
            Patterns
          </li>
          <li class="nav-item" onclick="switchView('episodes')">
            <span class="nav-icon"></span>
            Episodes
          </li>
          <li class="nav-item" onclick="switchView('causal-graph')">
            <span class="nav-icon"></span>
            Causal Graph
          </li>
          <li class="nav-item" onclick="switchView('vector-search')">
            <span class="nav-icon"></span>
            Vector Search
          </li>
          <li class="nav-item" onclick="switchView('optimizer')">
            <span class="nav-icon"></span>
            Query Optimizer
          </li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Tools</div>
        <ul class="sidebar-nav">
          <li class="nav-item" onclick="showSettings()">
            <span class="nav-icon"></span>
            Settings
          </li>
          <li class="nav-item" onclick="showImportExport()">
            <span class="nav-icon"></span>
            Import/Export
          </li>
          <li class="nav-item" onclick="showSchemaDesigner()">
            <span class="nav-icon"></span>
            Schema Designer
          </li>
          <li class="nav-item" onclick="showSampleDataModal()">
            <span class="nav-icon"></span>
            Sample Data
          </li>
          <li class="nav-item" onclick="generateHTML()">
            <span class="nav-icon"></span>
            Export HTML
          </li>
        </ul>
      </div>

      <div class="sidebar-section" style="flex: 1; display: flex; flex-direction: column; justify-content: flex-end;">
        <div class="sidebar-title">Database Status</div>
        <div style="font-size: 0.75rem; color: var(--text-secondary);">
          <div style="margin-bottom: 0.5rem;">
            <span class="status-badge success" id="db-status">Connected</span>
          </div>
          <div><strong>Version:</strong> 1.3.9</div>
          <div><strong>Mode:</strong> <span id="db-mode">Memory</span></div>
          <div><strong>Tables:</strong> <span id="db-tables">0</span></div>
          <div><strong>Vectors:</strong> <span id="db-vectors">0</span></div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="ide-main">
      <div class="main-tabs hidden">
        <button class="main-tab active" data-tab="editor">Editor</button>
        <button class="main-tab" data-tab="results">Results</button>
        <button class="main-tab" data-tab="diagnostics">Diagnostics</button>
      </div>

      <div class="main-content">
        <!-- Dashboard Panel -->
        <div id="panel-dashboard" class="content-panel active">
          <div class="dashboard-welcome">
            <!-- Hero Section -->
            <div class="dashboard-hero">
              <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                <span style="width: 12px; height: 12px; background: #374151; border-radius: 50%;"></span>
                <span style="width: 12px; height: 12px; background: #4b5563; border-radius: 50%;"></span>
                <span style="width: 12px; height: 12px; background: #22c55e; border-radius: 50%;"></span>
                <span style="margin-left: auto; color: rgba(107, 114, 128, 0.8); font-size: 0.75rem;">agentdb-terminal</span>
              </div>
              <div class="dashboard-hero-title">agentdb/ide</div>
              <div class="dashboard-hero-subtitle">
                > sql database with vector embeddings, semantic search, and agentic memory<br>
                > type a command or select a module below to get started
              </div>
              <div class="dashboard-hero-actions">
                <button class="btn btn-secondary btn-sm" onclick="switchView('sql-editor')" style="font-family: 'Courier New', Monaco, monospace;">
                  $ editor
                </button>
                <button class="btn btn-secondary btn-sm" onclick="showSampleDataOverview()" style="font-family: 'Courier New', Monaco, monospace;">
                  $ load-sample-data
                </button>
                <button class="btn btn-secondary btn-sm" onclick="switchView('patterns')" style="font-family: 'Courier New', Monaco, monospace;">
                  $ patterns
                </button>
                <button class="btn btn-secondary btn-sm" onclick="switchView('episodes')" style="font-family: 'Courier New', Monaco, monospace;">
                  $ episodes
                </button>
              </div>
            </div>

            <!-- Feature Cards -->
            <div class="dashboard-cards">
              <!-- SQL Editor Card -->
              <div class="dashboard-card" onclick="switchView('sql-editor')">
                <span class="dashboard-card-icon">></span>
                <div class="dashboard-card-title">sql-editor</div>
                <div class="dashboard-card-description">
                  execute queries with templates and real-time results
                </div>
                <div class="dashboard-card-stats">
                  <div class="dashboard-card-stat">
                    <span class="dashboard-card-stat-label">queries:</span>
                    <span class="dashboard-card-stat-value" id="dash-query-count">0</span>
                  </div>
                  <div class="dashboard-card-stat">
                    <span class="dashboard-card-stat-label">templates:</span>
                    <span class="dashboard-card-stat-value">12</span>
                  </div>
                </div>
              </div>

              <!-- Data Browser Card -->
              <div class="dashboard-card" onclick="switchView('data-browser')">
                <span class="dashboard-card-icon">></span>
                <div class="dashboard-card-title">data-browser</div>
                <div class="dashboard-card-description">
                  browse tables, view schema, explore data
                </div>
                <div class="dashboard-card-stats">
                  <div class="dashboard-card-stat">
                    <span class="dashboard-card-stat-label">tables:</span>
                    <span class="dashboard-card-stat-value" id="dash-table-count">0</span>
                  </div>
                  <div class="dashboard-card-stat">
                    <span class="dashboard-card-stat-label">records:</span>
                    <span class="dashboard-card-stat-value" id="dash-record-count">0</span>
                  </div>
                </div>
              </div>

              <!-- Patterns Card -->
              <div class="dashboard-card" onclick="switchView('patterns')">
                <span class="dashboard-card-icon">></span>
                <div class="dashboard-card-title">patterns</div>
                <div class="dashboard-card-description">
                  agentic memory with vector embeddings & semantic search
                </div>
                <div class="dashboard-card-stats">
                  <div class="dashboard-card-stat">
                    <span class="dashboard-card-stat-label">count:</span>
                    <span class="dashboard-card-stat-value" id="dash-pattern-count">0</span>
                  </div>
                  <div class="dashboard-card-stat">
                    <span class="dashboard-card-stat-label">avg-score:</span>
                    <span class="dashboard-card-stat-value" id="dash-pattern-score">N/A</span>
                  </div>
                </div>
              </div>

              <!-- Episodes Card -->
              <div class="dashboard-card" onclick="switchView('episodes')">
                <span class="dashboard-card-icon">></span>
                <div class="dashboard-card-title">episodes</div>
                <div class="dashboard-card-description">
                  task-action-reward-critique for reinforcement learning
                </div>
                <div class="dashboard-card-stats">
                  <div class="dashboard-card-stat">
                    <span class="dashboard-card-stat-label">count:</span>
                    <span class="dashboard-card-stat-value" id="dash-episode-count">0</span>
                  </div>
                  <div class="dashboard-card-stat">
                    <span class="dashboard-card-stat-label">avg-reward:</span>
                    <span class="dashboard-card-stat-value" id="dash-episode-reward">N/A</span>
                  </div>
                </div>
              </div>

              <!-- Vector Search Card -->
              <div class="dashboard-card" onclick="switchView('vector-search')">
                <span class="dashboard-card-icon">></span>
                <div class="dashboard-card-title">vector-search</div>
                <div class="dashboard-card-description">
                  semantic search with embeddings & cosine similarity
                </div>
                <div class="dashboard-card-stats">
                  <div class="dashboard-card-stat">
                    <span class="dashboard-card-stat-label">vectors:</span>
                    <span class="dashboard-card-stat-value" id="dash-vector-count">0</span>
                  </div>
                  <div class="dashboard-card-stat">
                    <span class="dashboard-card-stat-label">dims:</span>
                    <span class="dashboard-card-stat-value">1536</span>
                  </div>
                </div>
              </div>

              <!-- Causal Graph Card -->
              <div class="dashboard-card" onclick="switchView('causal-graph')">
                <span class="dashboard-card-icon">></span>
                <div class="dashboard-card-title">causal-graph</div>
                <div class="dashboard-card-description">
                  discover relationships & visualize knowledge graphs
                </div>
                <div class="dashboard-card-stats">
                  <div class="dashboard-card-stat">
                    <span class="dashboard-card-stat-label">edges:</span>
                    <span class="dashboard-card-stat-value" id="dash-causal-count">0</span>
                  </div>
                  <div class="dashboard-card-stat">
                    <span class="dashboard-card-stat-label">strength:</span>
                    <span class="dashboard-card-stat-value">N/A</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Quick Actions -->
            <div class="dashboard-quick-actions">
              <div class="dashboard-quick-actions-title">
                quick-commands
              </div>
              <div class="dashboard-actions-grid">
                <button class="dashboard-action-btn" onclick="showSampleDataOverview()">
                  <span class="dashboard-action-icon">$</span>
                  <span>load-sample-data</span>
                </button>
                <button class="dashboard-action-btn" onclick="showImportExport()">
                  <span class="dashboard-action-icon">$</span>
                  <span>import-export</span>
                </button>
                <button class="dashboard-action-btn" onclick="showSchemaDesigner()">
                  <span class="dashboard-action-icon">$</span>
                  <span>schema-designer</span>
                </button>
                <button class="dashboard-action-btn" onclick="loadTemplate('vectors')">
                  <span class="dashboard-action-icon">$</span>
                  <span>query-vectors</span>
                </button>
                <button class="dashboard-action-btn" onclick="loadTemplate('similarity')">
                  <span class="dashboard-action-icon">$</span>
                  <span>semantic-search</span>
                </button>
                <button class="dashboard-action-btn" onclick="switchView('patterns')">
                  <span class="dashboard-action-icon">$</span>
                  <span>add-pattern</span>
                </button>
                <button class="dashboard-action-btn" onclick="switchView('episodes')">
                  <span class="dashboard-action-icon">$</span>
                  <span>add-episode</span>
                </button>
                <button class="dashboard-action-btn" onclick="showSettings()">
                  <span class="dashboard-action-icon">$</span>
                  <span>settings</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- SQL Editor Panel -->
        <div id="panel-sql-editor" class="content-panel">
          <!-- Editor Tab Content -->
          <div id="tab-editor" class="tab-content-panel active">
            <div class="card">
              <div class="card-title">AgentDB SQL Editor</div>

              <!-- Quick Templates -->
              <div style="margin-bottom: 1rem; padding: 1rem; background: var(--bg-tertiary); border-radius: 8px;">
                <div style="font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 0.75rem;">
                   AgentDB Query Templates
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem;">
                  <button class="btn btn-secondary btn-sm" onclick="loadTemplate('vectors')"> Query Vectors</button>
                  <button class="btn btn-secondary btn-sm" onclick="loadTemplate('patterns')"> Query Patterns</button>
                  <button class="btn btn-secondary btn-sm" onclick="loadTemplate('episodes')"> Query Episodes</button>
                  <button class="btn btn-secondary btn-sm" onclick="loadTemplate('causal')"> Query Causal Edges</button>
                  <button class="btn btn-secondary btn-sm" onclick="loadTemplate('similarity')"> Semantic Search</button>
                  <button class="btn btn-secondary btn-sm" onclick="loadTemplate('aggregate')"> Aggregate Stats</button>
                  <button class="btn btn-secondary btn-sm" onclick="loadTemplate('join')"> Advanced Joins</button>
                  <button class="btn btn-secondary btn-sm" onclick="loadTemplate('metadata')"> JSON Metadata</button>
                </div>
              </div>

              <div class="editor-container">
                <div class="editor-toolbar">
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <button class="btn btn-primary btn-sm" onclick="executeSQL()"> Execute</button>
                    <button class="btn btn-secondary btn-sm" onclick="formatSQL()"> Format</button>
                    <button class="btn btn-secondary btn-sm" onclick="clearEditor()"> Clear</button>
                    <button class="btn btn-secondary btn-sm" onclick="saveQuery()"> Save</button>
                    <button class="btn btn-secondary btn-sm" onclick="showExamples()"> Examples</button>
                  </div>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <select class="form-select" style="width: auto;" id="saved-queries" onchange="loadSavedQuery(this.value)">
                      <option value="">Load Saved...</option>
                    </select>
                    <button class="btn btn-secondary btn-sm" onclick="showSchemaHelp()"> Schema</button>
                  </div>
                </div>
                <textarea class="editor-textarea" id="sql-editor" placeholder="-- AgentDB SQL Editor
-- Use templates above for common queries
-- Example: SELECT * FROM patterns WHERE pattern_type = 'causal' LIMIT 10;

SELECT * FROM sqlite_master WHERE type='table' ORDER BY name;">SELECT * FROM sqlite_master WHERE type='table' ORDER BY name;</textarea>
              </div>
            </div>
          </div>

          <!-- Results Tab Content -->
          <div id="tab-results" class="tab-content-panel">
            <div class="card">
              <div class="card-title">Query Results</div>
              <div id="query-result" class="result-container">
                <div class="result-header" style="display: none;">
                  <div class="result-info">
                    <span id="result-count">0</span> rows returned in <span id="result-time">0</span>ms
                  </div>
                  <div>
                    <button class="btn btn-secondary btn-sm" onclick="exportResults('json')">Export JSON</button>
                    <button class="btn btn-secondary btn-sm" onclick="exportResults('csv')">Export CSV</button>
                  </div>
                </div>
                <div id="result-table-container">
                  <div class="empty-state">
                    <div class="empty-state-icon"></div>
                    <div class="empty-state-title">No results yet</div>
                    <div class="empty-state-text">Execute a query from the Editor tab to see results here</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Diagnostics Tab Content -->
          <div id="tab-diagnostics" class="tab-content-panel">
            <div class="card">
              <div class="card-title">Query Diagnostics & Performance</div>
              <div id="query-diagnostics">
                <div class="empty-state">
                  <div class="empty-state-icon"></div>
                  <div class="empty-state-title">No diagnostics available</div>
                  <div class="empty-state-text">Execute a query to see performance metrics and diagnostics</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Data Browser Panel -->
        <div id="panel-data-browser" class="content-panel">
          <div class="card">
            <div class="card-title">Data Browser</div>
            <div class="form-group">
              <label class="form-label">Select Table</label>
              <select class="form-select" id="table-select" onchange="browseTable(this.value)">
                <option value="">Choose a table...</option>
              </select>
            </div>

            <div class="search-box">
              <span class="search-icon"></span>
              <input type="text" class="search-input" id="browser-search" placeholder="Search records..." oninput="filterBrowserData()">
            </div>

            <div id="browser-content">
              <div class="empty-state">
                <div class="empty-state-icon"></div>
                <div class="empty-state-title">Select a table to browse</div>
                <div class="empty-state-text">Choose a table from the dropdown above to view its data</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Patterns Panel -->
        <div id="panel-patterns" class="content-panel">
          <div class="card" style="position: relative;">
            <button class="help-btn" onclick="showPatternHelp()"> Help</button>
            <div class="card-title"> Pattern Management</div>
            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.875rem;">
              Store reusable reasoning patterns with vector embeddings for semantic similarity search
            </p>

            <div style="display: flex; gap: 0.75rem; margin-bottom: 1rem; flex-wrap: wrap;">
              <button class="btn btn-primary btn-sm" onclick="showAddPattern()"> Add Pattern</button>
              <button class="btn btn-secondary btn-sm" onclick="refreshPatterns()"> Refresh</button>
              <button class="btn btn-secondary btn-sm" onclick="showPatternTemplates()"> Templates</button>
              <button class="btn btn-secondary btn-sm" onclick="exportPatterns()"> Export</button>
              <button class="btn btn-secondary btn-sm" onclick="showBatchPatterns()"> Batch Add</button>
            </div>

            <!-- Pattern Type Filter -->
            <div class="form-group">
              <label class="form-label">Filter by Type</label>
              <select class="form-select" id="pattern-type-filter" onchange="filterPatterns()">
                <option value="">All Types</option>
                <option value="causal">Causal</option>
                <option value="temporal">Temporal</option>
                <option value="reasoning">Reasoning</option>
                <option value="optimization">Optimization</option>
                <option value="custom">Custom</option>
              </select>
            </div>

            <div id="patterns-list">
              <div class="empty-state">
                <div class="empty-state-icon"></div>
                <div class="empty-state-title">No patterns stored</div>
                <div class="empty-state-text">Patterns are reusable reasoning templates with vector embeddings</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Episodes Panel -->
        <div id="panel-episodes" class="content-panel">
          <div class="card" style="position: relative;">
            <button class="help-btn" onclick="showEpisodeHelp()"> Help</button>
            <div class="card-title"> Reinforcement Learning Dashboard</div>
            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.875rem;">
              Comprehensive episode management with learning analytics, trajectory visualization, and performance insights
            </p>

            <!-- Action Toolbar -->
            <div style="display: flex; gap: 0.75rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
              <button class="btn btn-primary btn-sm" onclick="showAddEpisode()"> Add Episode</button>
              <button class="btn btn-secondary btn-sm" onclick="refreshEpisodes()"> Refresh</button>
              <button class="btn btn-secondary btn-sm" onclick="showEpisodeTemplates()"> Templates</button>
              <button class="btn btn-secondary btn-sm" onclick="showCompareEpisodes()"> Compare</button>
              <button class="btn btn-secondary btn-sm" onclick="showLearningInsights()"> Insights</button>
              <button class="btn btn-secondary btn-sm" onclick="exportEpisodes()"> Export</button>
            </div>

            <!-- Learning Analytics Dashboard -->
            <div id="analytics-dashboard" style="margin-bottom: 1.5rem;">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                <!-- Quick Stats Cards -->
                <div class="stat-card">
                  <div class="stat-card-label">Total Episodes</div>
                  <div class="stat-card-value" id="total-episodes">0</div>
                  <div class="stat-card-trend" id="episodes-trend">--</div>
                </div>
                <div class="stat-card">
                  <div class="stat-card-label">Success Rate</div>
                  <div class="stat-card-value" id="success-rate">0%</div>
                  <div class="stat-card-trend" id="success-trend">--</div>
                </div>
                <div class="stat-card">
                  <div class="stat-card-label">Avg Reward</div>
                  <div class="stat-card-value" id="avg-reward">0.00</div>
                  <div class="stat-card-trend" id="reward-trend">--</div>
                </div>
                <div class="stat-card">
                  <div class="stat-card-label">Top Strategy</div>
                  <div class="stat-card-value" id="top-strategy" style="font-size: 0.875rem;">--</div>
                  <div class="stat-card-trend" id="strategy-count">--</div>
                </div>
              </div>

              <!-- Reward Distribution Histogram -->
              <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <div style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--text-secondary);">
                   Reward Distribution
                </div>
                <div id="reward-histogram" style="height: 100px; display: flex; align-items: flex-end; gap: 4px;">
                  <!-- Histogram bars will be generated here -->
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-muted); margin-top: 0.5rem;">
                  <span>-1.0</span>
                  <span>0.0</span>
                  <span>1.0</span>
                </div>
              </div>

              <!-- Reward Over Time Chart -->
              <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 8px;">
                <div style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--text-secondary);">
                   Reward Trend (Last 20 Episodes)
                </div>
                <canvas id="reward-trend-chart" width="100%" height="60"></canvas>
              </div>
            </div>

            <!-- Advanced Filters -->
            <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">

                <!-- Reward Range Filter -->
                <div class="form-group" style="margin: 0;">
                  <label class="form-label">Reward Range</label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <input type="number" id="reward-min" class="form-input" placeholder="Min" value="-1" step="0.1" style="width: 80px;">
                    <span>to</span>
                    <input type="number" id="reward-max" class="form-input" placeholder="Max" value="1" step="0.1" style="width: 80px;">
                  </div>
                </div>

                <!-- Task Type Filter -->
                <div class="form-group" style="margin: 0;">
                  <label class="form-label">Task Type</label>
                  <select id="task-type-filter" class="form-select">
                    <option value="">All Types</option>
                    <option value="coding">Coding</option>
                    <option value="analysis">Analysis</option>
                    <option value="optimization">Optimization</option>
                    <option value="testing">Testing</option>
                    <option value="custom">Custom</option>
                  </select>
                </div>

                <!-- Time Period Filter -->
                <div class="form-group" style="margin: 0;">
                  <label class="form-label">Time Period</label>
                  <select id="time-period-filter" class="form-select">
                    <option value="all">All Time</option>
                    <option value="1h">Last Hour</option>
                    <option value="1d">Last Day</option>
                    <option value="1w">Last Week</option>
                    <option value="1m">Last Month</option>
                  </select>
                </div>

                <!-- Outcome Filter -->
                <div class="form-group" style="margin: 0;">
                  <label class="form-label">Outcome</label>
                  <select id="outcome-filter" class="form-select">
                    <option value="all">All Outcomes</option>
                    <option value="success">Success (>0.5)</option>
                    <option value="failure">Failure (<0)</option>
                    <option value="neutral">Neutral (0-0.5)</option>
                  </select>
                </div>

              </div>

              <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                <button class="btn btn-secondary btn-sm" onclick="applyEpisodeFilters()"> Apply Filters</button>
                <button class="btn btn-secondary btn-sm" onclick="resetEpisodeFilters()"> Reset</button>
                <button class="btn btn-secondary btn-sm" onclick="saveFilterPreset()"> Save Preset</button>
              </div>
            </div>

            <!-- View Mode Selector -->
            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">
              <button class="view-mode-btn active" data-mode="cards" onclick="setEpisodeViewMode('cards')">
                 Cards
              </button>
              <button class="view-mode-btn" data-mode="table" onclick="setEpisodeViewMode('table')">
                 Table
              </button>
              <button class="view-mode-btn" data-mode="timeline" onclick="setEpisodeViewMode('timeline')">
                 Timeline
              </button>
              <button class="view-mode-btn" data-mode="trajectories" onclick="setEpisodeViewMode('trajectories')">
                 Trajectories
              </button>
            </div>

            <!-- Episodes List Container -->
            <div id="episodes-list">
              <div class="empty-state">
                <div class="empty-state-icon"></div>
                <div class="empty-state-title">No episodes recorded</div>
                <div class="empty-state-text">Click "Add Episode" to record your first reinforcement learning trajectory</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Causal Graph Panel -->
        <div id="panel-causal-graph" class="content-panel">
          <div class="card" style="position: relative;">
            <button class="help-btn" onclick="showCausalHelp()"> Help</button>
            <div class="card-title"> Causal Graph Visualization</div>
            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.875rem;">
              Map cause-effect relationships with weighted edges for causal inference and decision making
            </p>

            <div style="display: flex; gap: 0.75rem; margin-bottom: 1rem; flex-wrap: wrap;">
              <button class="btn btn-primary btn-sm" onclick="showAddCausalEdge()"> Add Edge</button>
              <button class="btn btn-secondary btn-sm" onclick="refreshCausalGraph()"> Refresh</button>
              <button class="btn btn-secondary btn-sm" onclick="showCausalExamples()"> Examples</button>
              <button class="btn btn-secondary btn-sm" onclick="exportCausalGraph()"> Export</button>
              <button class="btn btn-secondary btn-sm" onclick="analyzeCausalPaths()"> Analyze Paths</button>
            </div>

            <!-- Weight Filter -->
            <div class="form-group">
              <label class="form-label">Minimum Edge Weight</label>
              <div style="display: flex; gap: 0.5rem; align-items: center;">
                <input type="range" id="weight-filter" class="form-input" min="0" max="1" step="0.1" value="0" style="flex: 1;" oninput="filterCausalEdges(this.value)">
                <span id="weight-filter-value" style="min-width: 50px; text-align: center;"> 0.0</span>
              </div>
            </div>

            <div id="causal-graph-viz">
              <div class="empty-state">
                <div class="empty-state-icon"></div>
                <div class="empty-state-title">No causal relationships</div>
                <div class="empty-state-text">Causal edges represent cause-effect relationships with weights</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Vector Search Panel -->
        <div id="panel-vector-search" class="content-panel">
          <div class="card" style="position: relative;">
            <button class="help-btn" onclick="showVectorHelp()"> Help</button>
            <div class="card-title"> Vector Similarity Search</div>
            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.875rem;">
              Semantic search across stored vectors using cosine similarity for intelligent content retrieval
            </p>

            <div class="form-group">
              <label class="form-label">Search Query</label>
              <input type="text" class="form-input" id="vector-query" placeholder="Enter search query...">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
              <div class="form-group" style="margin: 0;">
                <label class="form-label">Number of Results</label>
                <input type="number" class="form-input" id="vector-limit" value="5" min="1" max="50">
              </div>
              <div class="form-group" style="margin: 0;">
                <label class="form-label">Similarity Threshold</label>
                <input type="number" class="form-input" id="similarity-threshold" value="0" min="0" max="1" step="0.1">
              </div>
            </div>

            <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
              <button class="btn btn-primary" onclick="performVectorSearch()"> Search Similar</button>
              <button class="btn btn-secondary btn-sm" onclick="showVectorExamples()"> Examples</button>
              <button class="btn btn-secondary btn-sm" onclick="clearVectorSearch()"> Clear</button>
            </div>

            <div id="vector-results" style="margin-top: 1.5rem;">
              <div class="empty-state">
                <div class="empty-state-icon"></div>
                <div class="empty-state-title">Enter a query to search</div>
                <div class="empty-state-text">Semantic search using vector embeddings</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Optimizer Panel -->
        <div id="panel-optimizer" class="content-panel">
          <div class="card" style="position: relative;">
            <button class="help-btn" onclick="showOptimizerHelp()"> Help</button>
            <div class="card-title"> Advanced Query Optimizer</div>
            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.875rem;">
              Comprehensive SQL optimization workbench with query analysis, performance insights, and AgentDB-specific optimizations
            </p>

            <!-- Optimizer Tabs -->
            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem;">
              <button class="btn btn-secondary btn-sm optimizer-tab active" data-tab="analyze" onclick="switchOptimizerTab('analyze')"> Analyze</button>
              <button class="btn btn-secondary btn-sm optimizer-tab" data-tab="compare" onclick="switchOptimizerTab('compare')"> Compare</button>
              <button class="btn btn-secondary btn-sm optimizer-tab" data-tab="library" onclick="switchOptimizerTab('library')"> Library</button>
              <button class="btn btn-secondary btn-sm optimizer-tab" data-tab="wizard" onclick="switchOptimizerTab('wizard')"> Wizard</button>
            </div>

            <!-- Analyze Tab -->
            <div id="optimizer-tab-analyze" class="optimizer-tab-content" style="display: block;">
              <div class="form-group">
                <label class="form-label">SQL Query to Analyze</label>
                <div style="position: relative;">
                  <textarea class="form-input" id="optimizer-query" rows="6" placeholder="-- Paste your SQL query here for optimization analysis
-- Supports: SELECT, JOIN, WHERE, GROUP BY, ORDER BY, vectors, patterns, causal edges
-- Example: SELECT * FROM vectors WHERE similarity(embedding, query_vector) > 0.8 LIMIT 10;"></textarea>
                  <div style="position: absolute; top: 0.5rem; right: 0.5rem; display: flex; gap: 0.25rem;">
                    <button class="btn btn-secondary btn-sm" onclick="formatOptimizerQuery()" title="Format SQL"></button>
                    <button class="btn btn-secondary btn-sm" onclick="loadFromEditor()" title="Load from Editor"></button>
                  </div>
                </div>
              </div>

              <div style="display: flex; gap: 0.75rem; margin-bottom: 1rem; flex-wrap: wrap; align-items: center;">
                <button class="btn btn-primary" onclick="analyzeQuery()"> Deep Analysis</button>
                <button class="btn btn-secondary btn-sm" onclick="quickAnalysis()"> Quick Check</button>
                <button class="btn btn-secondary btn-sm" onclick="benchmarkQuery()"> Benchmark</button>
                <button class="btn btn-secondary btn-sm" onclick="showOptimizationTips()"> Tips</button>
                <button class="btn btn-secondary btn-sm" onclick="clearOptimizer()"> Clear</button>
                <label style="display: flex; align-items: center; gap: 0.5rem; margin-left: auto; cursor: pointer;">
                  <input type="checkbox" id="auto-optimize" style="cursor: pointer;">
                  <span style="font-size: 0.875rem;">Auto-apply safe optimizations</span>
                </label>
              </div>

              <!-- Analysis Results -->
              <div id="optimizer-results">
                <div class="empty-state">
                  <div class="empty-state-icon"></div>
                  <div class="empty-state-title">Paste a query to analyze</div>
                  <div class="empty-state-text">Get comprehensive performance insights and optimization suggestions</div>
                </div>
              </div>
            </div>

            <!-- Compare Tab -->
            <div id="optimizer-tab-compare" class="optimizer-tab-content" style="display: none;">
              <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.875rem;">
                Compare performance between original and optimized queries
              </p>

              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div class="form-group" style="margin: 0;">
                  <label class="form-label">Original Query</label>
                  <textarea class="form-input" id="compare-query-a" rows="4" placeholder="Original query..."></textarea>
                </div>
                <div class="form-group" style="margin: 0;">
                  <label class="form-label">Optimized Query</label>
                  <textarea class="form-input" id="compare-query-b" rows="4" placeholder="Optimized query..."></textarea>
                </div>
              </div>

              <div style="display: flex; gap: 0.75rem; margin-bottom: 1rem;">
                <button class="btn btn-primary" onclick="compareQueries()"> Run Comparison</button>
                <button class="btn btn-secondary btn-sm" onclick="loadComparisonFromAnalysis()"> Load from Analysis</button>
                <button class="btn btn-secondary btn-sm" onclick="clearComparison()"> Clear</button>
              </div>

              <div id="comparison-results">
                <div class="empty-state">
                  <div class="empty-state-icon"></div>
                  <div class="empty-state-title">Enter queries to compare</div>
                  <div class="empty-state-text">Side-by-side performance comparison with benchmarks</div>
                </div>
              </div>
            </div>

            <!-- Library Tab -->
            <div id="optimizer-tab-library" class="optimizer-tab-content" style="display: none;">
              <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.875rem;">
                Pre-optimized query templates and common patterns for AgentDB
              </p>

              <div class="search-box" style="margin-bottom: 1rem;">
                <span class="search-icon"></span>
                <input type="text" class="search-input" id="library-search" placeholder="Search templates..." oninput="filterLibrary()">
              </div>

              <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
                <button class="btn btn-secondary btn-sm library-filter active" data-category="all" onclick="filterLibraryCategory('all')">All</button>
                <button class="btn btn-secondary btn-sm library-filter" data-category="vectors" onclick="filterLibraryCategory('vectors')"> Vectors</button>
                <button class="btn btn-secondary btn-sm library-filter" data-category="patterns" onclick="filterLibraryCategory('patterns')"> Patterns</button>
                <button class="btn btn-secondary btn-sm library-filter" data-category="causal" onclick="filterLibraryCategory('causal')"> Causal</button>
                <button class="btn btn-secondary btn-sm library-filter" data-category="joins" onclick="filterLibraryCategory('joins')"> Joins</button>
                <button class="btn btn-secondary btn-sm library-filter" data-category="aggregates" onclick="filterLibraryCategory('aggregates')"> Aggregates</button>
              </div>

              <div id="library-templates">
                <!-- Templates will be populated by JavaScript -->
              </div>
            </div>

            <!-- Wizard Tab -->
            <div id="optimizer-tab-wizard" class="optimizer-tab-content" style="display: none;">
              <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.875rem;">
                Step-by-step interactive optimization guidance
              </p>

              <div id="wizard-content">
                <div class="empty-state">
                  <div class="empty-state-icon"></div>
                  <div class="empty-state-title">Start optimization wizard</div>
                  <div class="empty-state-text">
                    <button class="btn btn-primary" onclick="startWizard()"> Start Wizard</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Right Panel -->
    <aside class="ide-panel">
      <!-- Performance Metrics -->
      <div class="panel-section" style="background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(75, 85, 99, 0.3); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
          <span style="width: 12px; height: 12px; background: #374151; border-radius: 50%;"></span>
          <span style="width: 12px; height: 12px; background: #4b5563; border-radius: 50%;"></span>
          <span style="width: 12px; height: 12px; background: #22c55e; border-radius: 50%;"></span>
          <span style="margin-left: auto; color: rgba(107, 114, 128, 0.8); font-size: 0.75rem;">performance-monitor</span>
        </div>
        <div style="color: #22c55e; font-weight: 700; margin-bottom: 1rem; font-size: 0.9375rem; font-family: 'Courier New', Monaco, monospace;">
          <span style="color: #22c55e;">$</span> performance metrics
        </div>

        <div style="display: flex; flex-direction: column; gap: 1rem;">
          <!-- Query Count -->
          <div style="background: rgba(34, 197, 94, 0.05); border-left: 3px solid #22c55e; padding: 0.75rem; border-radius: 4px;">
            <div style="color: #6b7280; font-size: 0.75rem; margin-bottom: 0.25rem; font-family: 'Courier New', Monaco, monospace;">query-count:</div>
            <div style="color: #e5e7eb; font-size: 1.5rem; font-weight: 700; font-family: 'Courier New', Monaco, monospace;" id="query-count">0</div>
          </div>

          <!-- Avg Query Time -->
          <div style="background: rgba(34, 197, 94, 0.05); border-left: 3px solid #16a34a; padding: 0.75rem; border-radius: 4px;">
            <div style="color: #6b7280; font-size: 0.75rem; margin-bottom: 0.25rem; font-family: 'Courier New', Monaco, monospace;">avg-query-time:</div>
            <div style="color: #e5e7eb; font-size: 1.5rem; font-weight: 700; font-family: 'Courier New', Monaco, monospace;" id="avg-time">0ms</div>
          </div>

          <!-- Cache Hit Rate -->
          <div style="background: rgba(107, 114, 128, 0.1); border-left: 3px solid #6b7280; padding: 0.75rem; border-radius: 4px;">
            <div style="color: #6b7280; font-size: 0.75rem; margin-bottom: 0.25rem; font-family: 'Courier New', Monaco, monospace;">cache-hit-rate:</div>
            <div style="color: #e5e7eb; font-size: 1.5rem; font-weight: 700; font-family: 'Courier New', Monaco, monospace;" id="cache-rate">0%</div>
          </div>
        </div>

        <button class="btn btn-secondary btn-sm" style="width: 100%; margin-top: 1rem; font-size: 0.75rem; font-family: 'Courier New', Monaco, monospace;" onclick="testMetrics()">
          $ test-metrics
        </button>
      </div>

      <!-- Schema & Info -->
      <div class="panel-header">Schema & Info</div>
      <div class="panel-content">
        <div id="schema-view">
          <div class="empty-state">
            <div class="empty-state-icon"></div>
            <div class="empty-state-title">Loading schema...</div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Console -->
    <div class="ide-console collapsed">
      <div class="console-header" onclick="toggleConsole()">
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <span class="console-toggle" id="console-toggle"></span>
          <div class="console-title" style="cursor: pointer;">diagnostic-console</div>
        </div>
        <div class="console-actions" onclick="event.stopPropagation()">
          <button class="btn btn-secondary btn-sm" onclick="clearConsole()" style="font-family: 'Courier New', Monaco, monospace; font-size: 0.75rem;">$ clear</button>
          <button class="btn btn-secondary btn-sm" onclick="exportLogs()" style="font-family: 'Courier New', Monaco, monospace; font-size: 0.75rem;">$ export</button>
        </div>
      </div>
      <div class="console-content" id="console-output">
        <div class="console-log info">
          <span class="timestamp">00:00:00</span>
          <span class="type">INFO</span>
          <span class="message">agentdb management ide initialized</span>
        </div>
      </div>
    </div>

  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"> Database Settings</div>
        <button class="modal-close" onclick="closeSettings()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="tabs">
          <button class="tab-button active" onclick="switchSettingsTab('general')">General</button>
          <button class="tab-button" onclick="switchSettingsTab('vector')">Vector Settings</button>
          <button class="tab-button" onclick="switchSettingsTab('performance')">Performance</button>
          <button class="tab-button" onclick="switchSettingsTab('advanced')">Advanced</button>
        </div>

        <div id="settings-general" class="tab-content active">
          <div class="form-group">
            <label class="form-label">Database Mode</label>
            <select class="form-select" id="setting-mode">
              <option value="memory">In-Memory (Volatile)</option>
              <option value="persistent">Persistent (IndexedDB)</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Auto-Save Interval (seconds)</label>
            <input type="number" class="form-input" id="setting-autosave" value="30" min="10" max="300">
          </div>
          <div class="form-checkbox">
            <input type="checkbox" id="setting-autobackup" checked>
            <label>Enable automatic backups</label>
          </div>
        </div>

        <div id="settings-vector" class="tab-content">
          <div class="form-group">
            <label class="form-label">Vector Dimensions</label>
            <input type="number" class="form-input" id="setting-dimensions" value="384" min="128" max="1024">
          </div>
          <div class="form-group">
            <label class="form-label">Similarity Threshold</label>
            <input type="number" class="form-input" id="setting-threshold" value="0.7" min="0" max="1" step="0.1">
          </div>
          <div class="form-group">
            <label class="form-label">Default Search Limit</label>
            <input type="number" class="form-input" id="setting-search-limit" value="10" min="1" max="100">
          </div>
        </div>

        <div id="settings-performance" class="tab-content">
          <div class="form-group">
            <label class="form-label">Query Cache Size</label>
            <input type="number" class="form-input" id="setting-cache-size" value="100" min="10" max="1000">
          </div>
          <div class="form-checkbox">
            <input type="checkbox" id="setting-query-cache" checked>
            <label>Enable query result caching</label>
          </div>
          <div class="form-checkbox">
            <input type="checkbox" id="setting-lazy-load" checked>
            <label>Enable lazy loading for large datasets</label>
          </div>
        </div>

        <div id="settings-advanced" class="tab-content">
          <div class="form-group">
            <label class="form-label">Debug Level</label>
            <select class="form-select" id="setting-debug-level">
              <option value="error">Error Only</option>
              <option value="warn">Warnings</option>
              <option value="info" selected>Info</option>
              <option value="debug">Debug</option>
            </select>
          </div>
          <div class="form-checkbox">
            <input type="checkbox" id="setting-detailed-logs" checked>
            <label>Enable detailed console logging</label>
          </div>
          <div class="form-checkbox">
            <input type="checkbox" id="setting-performance-tracking">
            <label>Track performance metrics</label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeSettings()">Cancel</button>
        <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
      </div>
    </div>
  </div>

<!-- Enhanced Help Modal with Tabs and Context Awareness -->
<div id="helpModal" class="modal-overlay">
  <div class="modal modal-large">
    <div class="modal-header">
      <div class="modal-title">agentdb-ide/help</div>
      <button class="modal-close" onclick="closeHelp()">&times;</button>
    </div>

    <!-- Main Tab Navigation -->
    <div class="help-tabs">
      <button class="help-tab active" data-tab="getting-started" onclick="switchHelpTab('getting-started')">
        getting-started
      </button>
      <button class="help-tab" data-tab="features" onclick="switchHelpTab('features')">
        features
      </button>
      <button class="help-tab" data-tab="examples" onclick="switchHelpTab('examples')">
        examples
      </button>
      <button class="help-tab" data-tab="reference" onclick="switchHelpTab('reference')">
        reference
      </button>
      <button class="help-tab" data-tab="faq" onclick="switchHelpTab('faq')">
        faq
      </button>
    </div>

    <div class="modal-body help-content">

      <!-- Getting Started Tab -->
      <div id="help-tab-getting-started" class="help-tab-content active">
        <div class="help-subsection-tabs">
          <button class="help-subtab active" onclick="switchHelpSubtab('getting-started', 'overview')">overview</button>
          <button class="help-subtab" onclick="switchHelpSubtab('getting-started', 'library')">Using Library</button>
          <button class="help-subtab" onclick="switchHelpSubtab('getting-started', 'quickstart')">IDE Quick-Start</button>
          <button class="help-subtab" onclick="switchHelpSubtab('getting-started', 'interface')">interface</button>
        </div>

        <div id="help-getting-started-overview" class="help-subsection active">
          <h3>$ agentdb management ide</h3>
          <p>A comprehensive database and vector management system built on <strong>AgentDB v1.3.9</strong>. This IDE provides professional-grade tools for managing SQL databases, vector embeddings, reasoning patterns, and causal relationships.</p>

          <div class="help-card">
            <h4>What is AgentDB?</h4>
            <p>AgentDB is an SQL-based agentic memory system that combines traditional relational databases with semantic vector search. It's designed for AI agents, intelligent applications, and systems that need to store, retrieve, and reason over complex data.</p>
            <p><strong>Version:</strong> 1.3.9 (backward compatible with v1.0.7 API)</p>
            <p><strong>Technology:</strong> SQLite compiled to WebAssembly (WASM) via sql.js</p>
            <p><strong>License:</strong> MIT License</p>
          </div>

          <div class="help-card">
            <h4>Core Capabilities</h4>
            <ul>
              <li><strong>SQL Database:</strong> Full SQLite database with ACID transactions</li>
              <li><strong>Vector Embeddings:</strong> 384-dimensional semantic vectors for similarity search</li>
              <li><strong>Pattern Storage:</strong> Reusable reasoning templates with metadata</li>
              <li><strong>Episode Tracking:</strong> Complete task execution trajectories for RL</li>
              <li><strong>Causal Graphs:</strong> Cause-effect relationships with weighted edges</li>
              <li><strong>Query Optimization:</strong> Performance analysis and suggestions</li>
            </ul>
          </div>

          <div class="help-card">
            <h4>Use Cases</h4>
            <ul>
              <li><strong>AI Agents:</strong> Long-term memory, episodic learning, skill storage</li>
              <li><strong>RAG Systems:</strong> Semantic search over knowledge bases</li>
              <li><strong>Reinforcement Learning:</strong> Episode tracking, trajectory analysis</li>
              <li><strong>Knowledge Management:</strong> Pattern libraries, causal reasoning</li>
              <li><strong>Decision Support:</strong> Causal graph exploration, optimization patterns</li>
            </ul>
          </div>
        </div>

        <div id="help-getting-started-library" class="help-subsection">
          <h3> Using AgentDB Library</h3>

          <h4>Installation</h4>

          <div class="help-code-example">
            <h4>Via CDN (Browser)</h4>
            <pre><code>&lt;script src="https://unpkg.com/agentdb@1.3.9/dist/agentdb.min.js"&gt;&lt;/script&gt;
&lt;script&gt;
  // AgentDB is now available globally
  AgentDB.onReady(() => {
    console.log('AgentDB v' + AgentDB.version + ' ready!');
  });
&lt;/script&gt;</code></pre>
          </div>

          <div class="help-code-example">
            <h4>Via NPM (Node.js)</h4>
            <pre><code>npm install agentdb

// Then in your code:
const AgentDB = require('agentdb');

AgentDB.onReady(() => {
  const db = new AgentDB.Database();
  // Start using the database
});</code></pre>
          </div>

          <h4>Basic Usage</h4>

          <div class="help-steps">
            <div class="help-step">
              <div class="help-step-number">1</div>
              <div class="help-step-content">
                <h4>Wait for Library Initialization</h4>
                <p>AgentDB uses WASM, so you must wait for it to load before creating databases:</p>
                <pre><code>AgentDB.onReady(() => {
  // Library is ready, safe to create databases
  const db = new AgentDB.Database();
});</code></pre>
              </div>
            </div>

            <div class="help-step">
              <div class="help-step-number">2</div>
              <div class="help-step-content">
                <h4>Create Database</h4>
                <p>Create an in-memory database or load from existing data:</p>
                <pre><code>// New empty database
const db = new AgentDB.Database();

// Or load from existing data
const savedData = new Uint8Array([...]); 
const db = new AgentDB.Database(savedData);</code></pre>
              </div>
            </div>

            <div class="help-step">
              <div class="help-step-number">3</div>
              <div class="help-step-content">
                <h4>Initialize Tables</h4>
                <p>Use the async initializer to create all standard tables:</p>
                <pre><code>await db.initializeAsync();

// Tables created:
// - vectors, patterns, episodes
// - causal_edges, skills</code></pre>
              </div>
            </div>

            <div class="help-step">
              <div class="help-step-number">4</div>
              <div class="help-step-content">
                <h4>Insert and Query Data</h4>
                <p>Use SQL or helper methods to work with data:</p>
                <pre><code>// Insert data
db.insert('patterns', {
  pattern: 'optimization-template',
  metadata: JSON.stringify({ type: 'ml' })
});

// Query data
const results = db.exec(`
  SELECT * FROM patterns 
  WHERE pattern LIKE '%optimization%'
`);</code></pre>
              </div>
            </div>

            <div class="help-step">
              <div class="help-step-number">5</div>
              <div class="help-step-content">
                <h4>Export/Save Database</h4>
                <p>Persist your database by exporting it:</p>
                <pre><code>// Export as binary data
const data = db.export();

// Save to localStorage
const base64 = btoa(String.fromCharCode(...data));
localStorage.setItem('mydb', base64);

// Or download as file
const blob = new Blob([data], { 
  type: 'application/x-sqlite3' 
});
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = 'database.db';
a.click();</code></pre>
              </div>
            </div>
          </div>

          <div class="help-tip">
            <strong> Pro Tip:</strong> Check <code>AgentDB.ready</code> property to see if the library is initialized. You can also use multiple databases simultaneously: <code>const db1 = new AgentDB.Database(); const db2 = new AgentDB.Database();</code>
          </div>

          <h4>Complete Example</h4>

          <div class="help-code-example">
            <h4>Full Working Example</h4>
            <pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;script src="https://unpkg.com/agentdb@1.3.9/dist/agentdb.min.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id="output"&gt;&lt;/div&gt;
  
  &lt;script&gt;
    AgentDB.onReady(async () => {
      // Create and initialize database
      const db = new AgentDB.Database();
      await db.initializeAsync();
      
      // Insert some patterns
      const patterns = [
        { pattern: 'causal-reasoning', metadata: '{"domain":"logic"}' },
        { pattern: 'optimization', metadata: '{"domain":"ml"}' },
        { pattern: 'temporal-sequence', metadata: '{"domain":"time"}' }
      ];
      
      patterns.forEach(p => {
        db.insert('patterns', p);
      });
      
      // Query and display
      const results = db.exec('SELECT * FROM patterns');
      const output = document.getElementById('output');
      
      if (results.length > 0) {
        const { columns, values } = results[0];
        output.innerHTML = '&lt;h3&gt;Patterns:&lt;/h3&gt;';
        values.forEach(row => {
          const obj = {};
          columns.forEach((col, i) => obj[col] = row[i]);
          output.innerHTML += `&lt;pre&gt;${JSON.stringify(obj, null, 2)}&lt;/pre&gt;`;
        });
      }
      
      // Export database
      const data = db.export();
      console.log('Database size:', data.length, 'bytes');
    });
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
          </div>
        </div>

        <div id="help-getting-started-quickstart" class="help-subsection">
          <h3>$ IDE Quick-Start Guide</h3>

          <div class="help-steps">
            <div class="help-step">
              <div class="help-step-number">1</div>
              <div class="help-step-content">
                <h4>Initialize Database</h4>
                <p>Click the <strong> Initialize AgentDB</strong> button in the header. This creates an in-memory database with all required tables and indexes.</p>
              </div>
            </div>

            <div class="help-step">
              <div class="help-step-number">2</div>
              <div class="help-step-content">
                <h4>Generate Sample Data</h4>
                <p>Click <strong> Sample Data</strong> to generate realistic test data. Choose Gemini AI for intelligent generation or local for instant creation.</p>
              </div>
            </div>

            <div class="help-step">
              <div class="help-step-number">3</div>
              <div class="help-step-content">
                <h4>Explore Features</h4>
                <p>Navigate through the sidebar to access SQL Editor, Data Browser, Patterns, Episodes, Causal Graph, Vector Search, and Query Optimizer.</p>
              </div>
            </div>

            <div class="help-step">
              <div class="help-step-number">4</div>
              <div class="help-step-content">
                <h4>Run Queries</h4>
                <p>Use the SQL Editor to query data, or use specialized panels for pattern search, episode analysis, and causal exploration.</p>
              </div>
            </div>
          </div>

          <div class="help-tip">
            <strong> Pro Tip:</strong> Press <code>Ctrl+Enter</code> (or <code>Cmd+Enter</code> on Mac) in the SQL Editor to execute queries quickly.
          </div>
        </div>

        <div id="help-getting-started-interface" class="help-subsection">
          <h3> Interface Guide</h3>

          <div class="help-interface-section">
            <h4>Header Bar</h4>
            <ul>
              <li><strong>Brand Logo:</strong> Click to return to SQL Editor</li>
              <li><strong>Initialize:</strong> Create/reset the AgentDB database</li>
              <li><strong>Sample Data:</strong> Generate test data for exploration</li>
              <li><strong>Settings:</strong> Configure database parameters</li>
              <li><strong>Export:</strong> Save configuration as standalone HTML</li>
              <li><strong>Help:</strong> Access this documentation (you're here!)</li>
            </ul>
          </div>

          <div class="help-interface-section">
            <h4>Sidebar Navigation</h4>
            <ul>
              <li><strong> SQL Editor:</strong> Execute SQL queries with diagnostics</li>
              <li><strong> Data Browser:</strong> Browse tables with pagination</li>
              <li><strong> Patterns:</strong> Manage reasoning patterns (60+ features)</li>
              <li><strong> Episodes:</strong> Track task trajectories with RL dashboard</li>
              <li><strong> Causal Graph:</strong> Visualize cause-effect relationships</li>
              <li><strong> Vector Search:</strong> Semantic similarity search (60+ features)</li>
              <li><strong> Query Optimizer:</strong> Performance analysis engine</li>
            </ul>
          </div>

          <div class="help-interface-section">
            <h4>Console Output</h4>
            <p>The bottom panel shows real-time logs and execution details. Color-coded messages indicate:</p>
            <ul>
              <li><span class="help-badge help-badge-info">INFO</span> General operations</li>
              <li><span class="help-badge help-badge-success">SUCCESS</span> Completed operations</li>
              <li><span class="help-badge help-badge-warning">WARNING</span> Potential issues</li>
              <li><span class="help-badge help-badge-error">ERROR</span> Failed operations</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Features Tab -->
      <div id="help-tab-features" class="help-tab-content">
        <div class="help-subsection-tabs">
          <button class="help-subtab active" onclick="switchHelpSubtab('features', 'sql-editor')">SQL Editor</button>
          <button class="help-subtab" onclick="switchHelpSubtab('features', 'patterns')">Patterns</button>
          <button class="help-subtab" onclick="switchHelpSubtab('features', 'episodes')">Episodes</button>
          <button class="help-subtab" onclick="switchHelpSubtab('features', 'causal')">Causal Graph</button>
          <button class="help-subtab" onclick="switchHelpSubtab('features', 'vector')">Vector Search</button>
          <button class="help-subtab" onclick="switchHelpSubtab('features', 'optimizer')">Optimizer</button>
        </div>

        <div id="help-features-sql-editor" class="help-subsection active">
          <h3> SQL Editor</h3>
          <p>Professional SQL editor with query execution, results display, and performance diagnostics.</p>

          <h4>Features</h4>
          <ul>
            <li>Multi-line SQL query editor</li>
            <li>Execute queries with Ctrl+Enter</li>
            <li>Tabbed interface (Editor / Results / Diagnostics)</li>
            <li>Query history tracking</li>
            <li>Export results to CSV/JSON</li>
            <li>Performance metrics (execution time, rows affected)</li>
            <li>Query optimization suggestions</li>
          </ul>

          <h4>Query Diagnostics</h4>
          <p>After executing queries, switch to the <strong>Diagnostics</strong> tab to view:</p>
          <ul>
            <li>Execution time with color-coded performance indicators</li>
            <li>Query complexity analysis</li>
            <li>WHERE clause detection</li>
            <li>JOIN operation detection</li>
            <li>LIMIT clause recommendations</li>
            <li>Optimization suggestions</li>
          </ul>
        </div>

        <div id="help-features-patterns" class="help-subsection">
          <h3> Patterns - 60+ Features</h3>
          <p>Advanced pattern management system with bulk operations, analytics, and dual-view interface.</p>

          <h4>Core Features</h4>
          <ul>
            <li><strong>Dual View:</strong> Switch between grid cards and list view</li>
            <li><strong>Advanced Filters:</strong> Multi-criteria filtering with 8+ filter types</li>
            <li><strong>Bulk Operations:</strong> Select multiple patterns for batch actions</li>
            <li><strong>Analytics Dashboard:</strong> Pattern distribution, usage stats, trends</li>
            <li><strong>Pattern Relationships:</strong> Link patterns with dependencies</li>
            <li><strong>Version Control:</strong> Track pattern changes over time</li>
            <li><strong>Quality Scoring:</strong> Automatic pattern quality metrics</li>
            <li><strong>Batch Import:</strong> Import patterns from JSON or templates</li>
          </ul>

          <h4>Pattern Types</h4>
          <ul>
            <li><strong>Causal:</strong> Cause-effect reasoning patterns</li>
            <li><strong>Temporal:</strong> Time-based sequential patterns</li>
            <li><strong>Reasoning:</strong> Logic and inference patterns</li>
            <li><strong>Optimization:</strong> Performance improvement patterns</li>
            <li><strong>Custom:</strong> User-defined pattern types</li>
          </ul>

          <h4>Batch Import</h4>
          <p>Click <strong> Batch Import</strong> to:</p>
          <ul>
            <li>Upload JSON files with multiple patterns</li>
            <li>Use pre-built templates (Marketing, Healthcare, Financial)</li>
            <li>Generate patterns with specific themes</li>
            <li>Automatic duplicate detection and merging</li>
          </ul>
        </div>

        <div id="help-features-episodes" class="help-subsection">
          <h3> Episodes - RL Dashboard</h3>
          <p>Complete reinforcement learning dashboard with trajectory visualization and analysis.</p>

          <h4>Episode Structure</h4>
          <ul>
            <li><strong>Task:</strong> What the agent attempted to do</li>
            <li><strong>Action:</strong> The specific action taken</li>
            <li><strong>Reward:</strong> Numeric outcome (positive/negative)</li>
            <li><strong>Critique:</strong> Analysis of the result</li>
            <li><strong>Trajectory:</strong> Sequence of states and actions</li>
            <li><strong>Metadata:</strong> Additional context (model, tokens, confidence)</li>
          </ul>

          <h4>RL Dashboard Features</h4>
          <ul>
            <li> Reward distribution chart (success vs failure)</li>
            <li> Trajectory visualization with state transitions</li>
            <li> Success rate calculator</li>
            <li> Trend analysis over time</li>
            <li> Filter by reward range</li>
            <li> Export episodes to JSON</li>
            <li> Color-coded reward indicators</li>
          </ul>

          <h4>Trajectory Visualization</h4>
          <p>Click the <strong> View Trajectory</strong> button on any episode to see:</p>
          <ul>
            <li>Canvas-based trajectory chart</li>
            <li>State-action sequences</li>
            <li>Reward progression</li>
            <li>Critical decision points</li>
          </ul>
        </div>

        <div id="help-features-causal" class="help-subsection">
          <h3> Causal Graph Analysis</h3>
          <p>Advanced graph analysis with path finding, cycle detection, and centrality measures.</p>

          <h4>Graph Analysis Features</h4>
          <ul>
            <li><strong>DFS Path Finding:</strong> Find all paths between cause and effect</li>
            <li><strong>Cycle Detection:</strong> Identify circular dependencies</li>
            <li><strong>PageRank:</strong> Calculate node importance</li>
            <li><strong>Betweenness Centrality:</strong> Find critical connectors</li>
            <li><strong>Weight Analysis:</strong> Identify strongest relationships</li>
            <li><strong>Graph Visualization:</strong> SVG-based network diagram</li>
          </ul>

          <h4>Analysis Modes</h4>
          <ul>
            <li><strong>Path Analysis:</strong> Find all paths between two nodes</li>
            <li><strong>Cycle Detection:</strong> Detect feedback loops</li>
            <li><strong>Centrality:</strong> Find most important nodes</li>
            <li><strong>Cluster Analysis:</strong> Group related causes/effects</li>
          </ul>

          <h4>Causal Edge Structure</h4>
          <ul>
            <li><strong>Cause:</strong> The triggering event or condition</li>
            <li><strong>Effect:</strong> The resulting outcome</li>
            <li><strong>Weight:</strong> Strength of relationship (0.0 - 1.0)</li>
            <li><strong>Metadata:</strong> Additional context (confidence, evidence)</li>
          </ul>
        </div>

        <div id="help-features-vector" class="help-subsection">
          <h3> Vector Search - 60+ Features</h3>
          <p>State-of-the-art semantic search with vector operations, re-ranking, and clustering.</p>

          <h4>Search Features</h4>
          <ul>
            <li><strong>Multi-Query Search:</strong> Search across multiple embeddings</li>
            <li><strong>Vector Operations:</strong> Add, subtract, interpolate vectors</li>
            <li><strong>k-means Clustering:</strong> Group similar results</li>
            <li><strong>Re-Ranking Algorithms:</strong> MMR, RRF, Semantic Coherence</li>
            <li><strong>Drift Detection:</strong> Monitor vector distribution changes</li>
            <li><strong>Nearest Neighbors:</strong> Find k most similar vectors</li>
            <li><strong>Vector Analogies:</strong> A is to B as C is to ?</li>
          </ul>

          <h4>Visualizations</h4>
          <ul>
            <li> Similarity distribution chart</li>
            <li> PCA 2D projection</li>
            <li> Cluster visualization</li>
            <li> Heatmap of similarities</li>
            <li> Vector drift over time</li>
          </ul>

          <h4>Re-Ranking Algorithms</h4>
          <ul>
            <li><strong>MMR (Maximal Marginal Relevance):</strong> Balance relevance and diversity</li>
            <li><strong>RRF (Reciprocal Rank Fusion):</strong> Combine multiple ranking sources</li>
            <li><strong>Semantic Coherence:</strong> Ensure results are contextually related</li>
          </ul>
        </div>

        <div id="help-features-optimizer" class="help-subsection">
          <h3> Query Optimizer</h3>
          <p>Complete SQL optimization engine with benchmarking and query wizard.</p>

          <h4>Optimizer Tabs</h4>
          <ul>
            <li><strong>Analyze:</strong> Analyze single queries for performance</li>
            <li><strong>Compare:</strong> A/B test different query approaches</li>
            <li><strong>Library:</strong> Pre-built optimized query templates</li>
            <li><strong>Wizard:</strong> Step-by-step query builder</li>
          </ul>

          <h4>Analysis Features</h4>
          <ul>
            <li>Execution time measurement</li>
            <li>Query plan visualization</li>
            <li>Index usage detection</li>
            <li>Anti-pattern detection (N+1, missing indexes)</li>
            <li>Optimization suggestions</li>
            <li>Benchmark comparison</li>
          </ul>

          <h4>Query Templates</h4>
          <p>6 pre-built templates for common operations:</p>
          <ul>
            <li>Vector similarity search</li>
            <li>Pattern retrieval by type</li>
            <li>Episode analysis by reward</li>
            <li>Causal path queries</li>
            <li>Aggregate statistics</li>
            <li>Join optimizations</li>
          </ul>
        </div>
      </div>

      <!-- Examples Tab -->
      <div id="help-tab-examples" class="help-tab-content">
        <div class="help-subsection-tabs">
          <button class="help-subtab active" onclick="switchHelpSubtab('examples', 'sql')">SQL Queries</button>
          <button class="help-subtab" onclick="switchHelpSubtab('examples', 'patterns')">Pattern Usage</button>
          <button class="help-subtab" onclick="switchHelpSubtab('examples', 'episodes')">Episode Tracking</button>
          <button class="help-subtab" onclick="switchHelpSubtab('examples', 'vector')">Vector Search</button>
        </div>

        <div id="help-examples-sql" class="help-subsection active">
          <h3> SQL Query Examples</h3>

          <div class="help-code-example">
            <h4>View All Tables</h4>
            <pre><code>-- List all tables in the database
SELECT name, type, sql
FROM sqlite_master
WHERE type = 'table'
ORDER BY name;</code></pre>
          </div>

          <div class="help-code-example">
            <h4>Query Patterns by Type</h4>
            <pre><code>-- Get all causal patterns
SELECT
  id,
  pattern_type,
  json_extract(metadata, '$.description') as description,
  created_at
FROM patterns
WHERE pattern_type = 'causal'
ORDER BY created_at DESC
LIMIT 10;</code></pre>
          </div>

          <div class="help-code-example">
            <h4>Analyze Episode Performance</h4>
            <pre><code>-- Calculate success rate by task type
SELECT
  json_extract(metadata, '$.task_type') as task_type,
  COUNT(*) as total_episodes,
  SUM(CASE WHEN reward > 0 THEN 1 ELSE 0 END) as successes,
  ROUND(AVG(reward), 3) as avg_reward
FROM episodes
GROUP BY task_type
ORDER BY avg_reward DESC;</code></pre>
          </div>

          <div class="help-code-example">
            <h4>Find Strong Causal Relationships</h4>
            <pre><code>-- Get causal edges with high weights
SELECT
  cause,
  effect,
  json_extract(metadata, '$.weight') as weight,
  json_extract(metadata, '$.confidence') as confidence
FROM causal_edges
WHERE CAST(json_extract(metadata, '$.weight') AS REAL) > 0.7
ORDER BY weight DESC;</code></pre>
          </div>
        </div>

        <div id="help-examples-patterns" class="help-subsection">
          <h3> Pattern Usage Examples</h3>

          <div class="help-example-scenario">
            <h4>Scenario: Marketing Campaign Optimization</h4>
            <p>Store a pattern for successful marketing campaigns:</p>

            <div class="help-step">
              <div class="help-step-number">1</div>
              <div class="help-step-content">
                <p>Click <strong> Add Pattern</strong> in the Patterns panel</p>
              </div>
            </div>

            <div class="help-step">
              <div class="help-step-number">2</div>
              <div class="help-step-content">
                <p>Fill in the details:</p>
                <ul>
                  <li><strong>Type:</strong> optimization</li>
                  <li><strong>Description:</strong> "Social media campaign with A/B testing"</li>
                  <li><strong>Metadata:</strong> <code>{"platform": "instagram", "ctr": 3.2, "conversion": 1.8}</code></li>
                </ul>
              </div>
            </div>

            <div class="help-step">
              <div class="help-step-number">3</div>
              <div class="help-step-content">
                <p>Use Vector Search to find similar successful campaigns</p>
              </div>
            </div>
          </div>

          <div class="help-example-scenario">
            <h4>Scenario: Batch Import Industry Templates</h4>
            <p>Import pre-built patterns for your industry:</p>

            <ol>
              <li>Click <strong> Batch Import</strong></li>
              <li>Select <strong>Template</strong> method</li>
              <li>Choose <strong>Marketing Campaign Patterns</strong></li>
              <li>Review and import 10 proven patterns</li>
            </ol>
          </div>
        </div>

        <div id="help-examples-episodes" class="help-subsection">
          <h3> Episode Tracking Examples</h3>

          <div class="help-example-scenario">
            <h4>Scenario: AI Agent Learning</h4>
            <p>Track an agent's learning progress over time:</p>

            <div class="help-code-example">
              <pre><code>// Store an episode after agent action
{
  "task": "Generate product description",
  "action": "Used GPT-4 with creative prompt",
  "reward": 0.85,
  "critique": "Description was engaging but slightly too long",
  "trajectory": ["research_product", "generate_draft", "refine_content"],
  "metadata": {
    "model": "gpt-4",
    "tokens": 256,
    "confidence": 0.92
  }
}</code></pre>
            </div>

            <p><strong>Analysis:</strong> Use the RL Dashboard to:</p>
            <ul>
              <li>View reward distribution (how many positive vs negative)</li>
              <li>Calculate success rate (percentage with reward > 0)</li>
              <li>Identify which actions lead to best outcomes</li>
              <li>Visualize trajectory patterns</li>
            </ul>
          </div>
        </div>

        <div id="help-examples-vector" class="help-subsection">
          <h3> Vector Search Examples</h3>

          <div class="help-example-scenario">
            <h4>Scenario: Find Similar Patterns</h4>
            <ol>
              <li>Enter a query: "budget optimization for marketing"</li>
              <li>Set similarity threshold: 0.7</li>
              <li>Set max results: 5</li>
              <li>Click <strong> Search</strong></li>
            </ol>
            <p>Results show patterns semantically similar to your query, ranked by cosine similarity.</p>
          </div>

          <div class="help-example-scenario">
            <h4>Scenario: Vector Arithmetic</h4>
            <p>Find patterns that combine concepts:</p>
            <ul>
              <li><strong>Query:</strong> "email campaign" + "automation" - "manual"</li>
              <li><strong>Result:</strong> Patterns about automated email marketing</li>
            </ul>
          </div>

          <div class="help-example-scenario">
            <h4>Scenario: Cluster Analysis</h4>
            <ol>
              <li>Run a broad vector search</li>
              <li>Click <strong> Cluster Results</strong></li>
              <li>Choose number of clusters: 3</li>
              <li>View grouped results by similarity</li>
            </ol>
            <p>k-means clustering automatically groups similar results together.</p>
          </div>
        </div>
      </div>

      <!-- Reference Tab -->
      <div id="help-tab-reference" class="help-tab-content">
        <div class="help-subsection-tabs">
          <button class="help-subtab active" onclick="switchHelpSubtab('reference', 'schema')">Database Schema</button>
          <button class="help-subtab" onclick="switchHelpSubtab('reference', 'api')">API Reference</button>
          <button class="help-subtab" onclick="switchHelpSubtab('reference', 'shortcuts')">Keyboard Shortcuts</button>
        </div>

        <div id="help-reference-schema" class="help-subsection active">
          <h3> Database Schema</h3>

          <h4>patterns Table</h4>
          <table class="help-table">
            <thead>
              <tr>
                <th>Column</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>id</code></td>
                <td>INTEGER</td>
                <td>Primary key (auto-increment)</td>
              </tr>
              <tr>
                <td><code>pattern_type</code></td>
                <td>TEXT</td>
                <td>Category: causal, temporal, reasoning, etc.</td>
              </tr>
              <tr>
                <td><code>embedding</code></td>
                <td>BLOB</td>
                <td>384-dimensional vector (binary)</td>
              </tr>
              <tr>
                <td><code>metadata</code></td>
                <td>TEXT</td>
                <td>JSON object with additional context</td>
              </tr>
              <tr>
                <td><code>created_at</code></td>
                <td>TEXT</td>
                <td>ISO 8601 timestamp</td>
              </tr>
            </tbody>
          </table>

          <h4>episodes Table</h4>
          <table class="help-table">
            <thead>
              <tr>
                <th>Column</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>id</code></td>
                <td>INTEGER</td>
                <td>Primary key (auto-increment)</td>
              </tr>
              <tr>
                <td><code>task</code></td>
                <td>TEXT</td>
                <td>What was attempted</td>
              </tr>
              <tr>
                <td><code>action</code></td>
                <td>TEXT</td>
                <td>Action taken</td>
              </tr>
              <tr>
                <td><code>reward</code></td>
                <td>REAL</td>
                <td>Numeric outcome (-1.0 to 1.0)</td>
              </tr>
              <tr>
                <td><code>critique</code></td>
                <td>TEXT</td>
                <td>Analysis of result</td>
              </tr>
              <tr>
                <td><code>trajectory</code></td>
                <td>TEXT</td>
                <td>JSON array of states/actions</td>
              </tr>
              <tr>
                <td><code>metadata</code></td>
                <td>TEXT</td>
                <td>JSON object (model, tokens, etc.)</td>
              </tr>
              <tr>
                <td><code>created_at</code></td>
                <td>TEXT</td>
                <td>ISO 8601 timestamp</td>
              </tr>
            </tbody>
          </table>

          <h4>causal_edges Table</h4>
          <table class="help-table">
            <thead>
              <tr>
                <th>Column</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>id</code></td>
                <td>INTEGER</td>
                <td>Primary key (auto-increment)</td>
              </tr>
              <tr>
                <td><code>cause</code></td>
                <td>TEXT</td>
                <td>Triggering event/condition</td>
              </tr>
              <tr>
                <td><code>effect</code></td>
                <td>TEXT</td>
                <td>Resulting outcome</td>
              </tr>
              <tr>
                <td><code>metadata</code></td>
                <td>TEXT</td>
                <td>JSON: {"weight": 0.85, "confidence": 0.92}</td>
              </tr>
              <tr>
                <td><code>created_at</code></td>
                <td>TEXT</td>
                <td>ISO 8601 timestamp</td>
              </tr>
            </tbody>
          </table>

          <h4>vectors Table</h4>
          <table class="help-table">
            <thead>
              <tr>
                <th>Column</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>id</code></td>
                <td>INTEGER</td>
                <td>Primary key (auto-increment)</td>
              </tr>
              <tr>
                <td><code>embedding</code></td>
                <td>BLOB</td>
                <td>384-dimensional vector</td>
              </tr>
              <tr>
                <td><code>metadata</code></td>
                <td>TEXT</td>
                <td>JSON context</td>
              </tr>
              <tr>
                <td><code>created_at</code></td>
                <td>TEXT</td>
                <td>ISO 8601 timestamp</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div id="help-reference-api" class="help-subsection">
          <h3> API Reference</h3>

          <div class="help-card">
            <h4> AgentDB Library v1.3.9</h4>
            <p>AgentDB is a WASM-powered SQLite vector database with semantic search capabilities, designed for AI agents and memory systems.</p>
            <p><strong>CDN:</strong> <code>https://unpkg.com/agentdb@1.3.9/dist/agentdb.min.js</code></p>
            <p><strong>Compatibility:</strong> Backward compatible with v1.0.7 API</p>
          </div>

          <h4>Initialization</h4>

          <div class="help-api-method">
            <code>AgentDB.onReady(callback)</code>
            <p>Wait for AgentDB to initialize (WASM loading)</p>
            <pre><code>// Wait for library to be ready
AgentDB.onReady(() => {
  console.log('AgentDB ready!');
  const db = new AgentDB.Database();
  // Start using the database
});</code></pre>
          </div>

          <div class="help-api-method">
            <code>new AgentDB.Database()</code>
            <p>Create a new in-memory database instance</p>
            <pre><code>// Create new database
const db = new AgentDB.Database();

// Or load from existing data
const data = new Uint8Array(savedData);
const db = new AgentDB.Database(data);</code></pre>
          </div>

          <div class="help-api-method">
            <code>db.initializeAsync()</code>
            <p>Initialize database with all tables (returns Promise)</p>
            <pre><code>// Async initialization with all tables
const db = new AgentDB.Database();
await db.initializeAsync();

// Tables created:
// - vectors (embeddings storage)
// - patterns (reasoning templates)
// - episodes (learning trajectories)
// - causal_edges (causal relationships)
// - skills (code snippets)</code></pre>
          </div>

          <h4>Core Database Methods</h4>

          <div class="help-api-method">
            <code>db.run(sql, params)</code>
            <p>Execute SQL statement without returning results</p>
            <pre><code>// Insert data
db.run(
  'INSERT INTO patterns (pattern, metadata) VALUES (?, ?)',
  ['optimization', '{"type": "ml"}']
);

// Update data
db.run(
  'UPDATE patterns SET metadata = ? WHERE id = ?',
  ['{"updated": true}', 1]
);</code></pre>
          </div>

          <div class="help-api-method">
            <code>db.exec(sql)</code>
            <p>Execute SQL and return raw results array</p>
            <pre><code>// Query data
const results = db.exec('SELECT * FROM patterns');

// Results format:
// [{
//   columns: ['id', 'pattern', 'metadata'],
//   values: [[1, 'opt', '{}'], [2, 'causal', '{}']]
// }]</code></pre>
          </div>

          <div class="help-api-method">
            <code>db.prepare(sql)</code>
            <p>Prepare a SQL statement for repeated execution</p>
            <pre><code>// Prepare statement
const stmt = db.prepare(
  'SELECT * FROM patterns WHERE pattern = ?'
);

// Bind and execute
stmt.bind(['optimization']);
while (stmt.step()) {
  const row = stmt.getAsObject();
  console.log(row);
}
stmt.free();</code></pre>
          </div>

          <div class="help-api-method">
            <code>db.export()</code>
            <p>Export database as Uint8Array for persistence</p>
            <pre><code>// Export database
const data = db.export();

// Save to localStorage
localStorage.setItem('agentdb', 
  btoa(String.fromCharCode(...data))
);

// Load later
const saved = localStorage.getItem('agentdb');
const data = new Uint8Array(
  atob(saved).split('').map(c => c.charCodeAt(0))
);
const db = new AgentDB.Database(data);</code></pre>
          </div>

          <div class="help-api-method">
            <code>db.close()</code>
            <p>Close database and free resources</p>
            <pre><code>// Clean up when done
db.close();</code></pre>
          </div>

          <h4>High-Level Insert Methods</h4>

          <div class="help-api-method">
            <code>db.insert(text, metadata)</code>
            <p>Insert into vectors table with text and metadata</p>
            <pre><code>// Insert vector entry
const result = db.insert(
  'User query about optimization',
  { source: 'user', timestamp: Date.now() }
);

console.log(result.lastID); // ID of inserted row</code></pre>
          </div>

          <div class="help-api-method">
            <code>db.insert(table, data)</code>
            <p>Insert into any table with column-value object</p>
            <pre><code>// Insert into patterns table
const result = db.insert('patterns', {
  pattern: 'causal-reasoning',
  metadata: JSON.stringify({ type: 'logic' })
});

// Insert into episodes table
const result = db.insert('episodes', {
  trajectory: JSON.stringify(['plan', 'act', 'reflect']),
  self_reflection: 'Good approach',
  verdict: 'success'
});</code></pre>
          </div>

          <h4>Search Methods</h4>

          <div class="help-api-method">
            <code>db.search(query, options)</code>
            <p>Simple search in vectors table</p>
            <pre><code>// Search vectors
const results = db.search('optimization', {
  limit: 10
});

// Returns array of matching entries
results.forEach(item => {
  console.log(item.text, item.metadata);
});</code></pre>
          </div>

          <h4>Schema Information</h4>

          <div class="help-card">
            <h4> Automatic Tables</h4>
            <p>When you call <code>db.initializeAsync()</code>, these tables are created:</p>
            <ul>
              <li><strong>vectors</strong> - General embedding storage (id, embedding, metadata, text, created_at)</li>
              <li><strong>patterns</strong> - Reasoning patterns (id, pattern, metadata, embedding, created_at)</li>
              <li><strong>episodes</strong> - Learning trajectories (id, trajectory, self_reflection, verdict, metadata, embedding, created_at)</li>
              <li><strong>causal_edges</strong> - Causal relationships (id, cause, effect, strength, metadata, created_at)</li>
              <li><strong>skills</strong> - Code/skill storage (id, skill_name, code, metadata, embedding, created_at)</li>
            </ul>
          </div>

          <h4>IDE-Specific Helper Functions</h4>

          <h4>IDE-Specific Helper Functions</h4>

          <div class="help-api-method">
            <code>sqlAll(query, params)</code>
            <p>Execute query and return all rows as objects (IDE utility)</p>
            <pre><code>const patterns = sqlAll(
  'SELECT * FROM patterns WHERE pattern LIKE ?',
  ['%optimization%']
);

// Returns: [{ id: 1, pattern: 'opt', ... }, ...]</code></pre>
          </div>

          <div class="help-api-method">
            <code>sqlGet(query, params)</code>
            <p>Execute query and return first row as object (IDE utility)</p>
            <pre><code>const pattern = sqlGet(
  'SELECT * FROM patterns WHERE id = ?',
  [123]
);

// Returns: { id: 123, pattern: 'opt', ... } or undefined</code></pre>
          </div>

          <div class="help-api-method">
            <code>sqlRun(query, params)</code>
            <p>Execute query without returning results (IDE utility)</p>
            <pre><code>sqlRun(
  'DELETE FROM patterns WHERE id = ?',
  [123]
);

// No return value</code></pre>
          </div>

          <h4>Usage Examples</h4>

          <div class="help-example-scenario">
            <h4>Example 1: Store and Search Patterns</h4>
            <pre><code>// Initialize database
AgentDB.onReady(async () => {
  const db = new AgentDB.Database();
  await db.initializeAsync();

  // Store a pattern with embedding
  const embedding = new Float32Array(384).fill(0.5);
  db.run(`
    INSERT INTO patterns (pattern, metadata, embedding)
    VALUES (?, ?, ?)
  `, [
    'budget-optimization',
    JSON.stringify({ domain: 'finance', complexity: 'medium' }),
    embedding
  ]);

  // Search patterns
  const results = db.exec(`
    SELECT id, pattern, metadata
    FROM patterns
    WHERE pattern LIKE '%optimization%'
    ORDER BY created_at DESC
  `);

  console.log('Found patterns:', results[0].values);
});</code></pre>
          </div>

          <div class="help-example-scenario">
            <h4>Example 2: Track Learning Episodes</h4>
            <pre><code>// Store episode with trajectory
const trajectory = JSON.stringify([
  'analyze_problem',
  'generate_solution',
  'test_approach',
  'refine_result'
]);

db.insert('episodes', {
  trajectory: trajectory,
  self_reflection: 'Approach was effective but slow',
  verdict: 'success',
  metadata: JSON.stringify({
    task: 'code_generation',
    duration_ms: 3500,
    reward: 0.85
  })
});

// Query successful episodes for learning
const successful = db.exec(`
  SELECT * FROM episodes
  WHERE verdict = 'success'
  ORDER BY created_at DESC
  LIMIT 10
`);</code></pre>
          </div>

          <div class="help-example-scenario">
            <h4>Example 3: Build Causal Graph</h4>
            <pre><code>// Add causal relationships
const causalData = [
  { cause: 'increased_budget', effect: 'more_conversions', strength: 0.75 },
  { cause: 'better_targeting', effect: 'more_conversions', strength: 0.85 },
  { cause: 'more_conversions', effect: 'higher_revenue', strength: 0.90 }
];

causalData.forEach(edge => {
  db.insert('causal_edges', {
    cause: edge.cause,
    effect: edge.effect,
    strength: edge.strength,
    metadata: JSON.stringify({ confidence: 'high' })
  });
});

// Find all causes of an effect
const causes = db.exec(`
  SELECT cause, strength
  FROM causal_edges
  WHERE effect = 'more_conversions'
  ORDER BY strength DESC
`);</code></pre>
          </div>

          <div class="help-example-scenario">
            <h4>Example 4: Persist Database</h4>
            <pre><code>// Export database to localStorage
function saveDatabase(db) {
  const data = db.export();
  const base64 = btoa(String.fromCharCode(...data));
  localStorage.setItem('agentdb_backup', base64);
  console.log('Database saved!');
}

// Load database from localStorage
function loadDatabase() {
  const base64 = localStorage.getItem('agentdb_backup');
  if (!base64) return null;
  
  const binary = atob(base64);
  const data = new Uint8Array(binary.length);
  for (let i = 0; i < binary.length; i++) {
    data[i] = binary.charCodeAt(i);
  }
  
  return new AgentDB.Database(data);
}

// Usage
AgentDB.onReady(() => {
  const db = loadDatabase() || new AgentDB.Database();
  // Use database...
  saveDatabase(db); // Save when done
});</code></pre>
          </div>

          <h4>Best Practices</h4>

          <div class="help-card">
            <h4> Performance Tips</h4>
            <ul>
              <li><strong>Use transactions</strong> for bulk inserts (wrap multiple INSERTs in BEGIN/COMMIT)</li>
              <li><strong>Create indexes</strong> on frequently queried columns</li>
              <li><strong>Prepare statements</strong> for repeated queries</li>
              <li><strong>Limit result sets</strong> to avoid memory issues</li>
              <li><strong>Close databases</strong> when done to free memory</li>
            </ul>
          </div>

          <div class="help-card">
            <h4> Data Integrity</h4>
            <ul>
              <li><strong>Validate inputs</strong> before inserting into database</li>
              <li><strong>Use parameters</strong> in queries to prevent SQL injection</li>
              <li><strong>Handle errors</strong> with try-catch blocks</li>
              <li><strong>Backup regularly</strong> using export() method</li>
              <li><strong>Version your schema</strong> for future migrations</li>
            </ul>
          </div>

          <div class="help-card">
            <h4> Vector Embeddings</h4>
            <ul>
              <li><strong>Consistent dimensions</strong> - Use 384 for MiniLM, 1536 for OpenAI</li>
              <li><strong>Normalize vectors</strong> for cosine similarity</li>
              <li><strong>Store as BLOB</strong> using Float32Array</li>
              <li><strong>Batch processing</strong> for large embedding operations</li>
              <li><strong>Cache embeddings</strong> to avoid recomputation</li>
            </ul>
          </div>

          <h4>Integration with IDE</h4>

          <div class="help-tip">
            <strong> Tip:</strong> The AgentDB IDE provides a visual interface for all these operations. Use the <strong>SQL Editor</strong> for custom queries, <strong>Pattern Manager</strong> for reasoning templates, <strong>Episode Tracker</strong> for learning data, and <strong>Causal Graph</strong> for relationship visualization.
          </div>
        </div>

        <div id="help-reference-shortcuts" class="help-subsection">
          <h3> Keyboard Shortcuts</h3>

          <h4>SQL Editor</h4>
          <table class="help-table">
            <thead>
              <tr>
                <th>Shortcut</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><kbd>Ctrl</kbd> + <kbd>Enter</kbd></td>
                <td>Execute query</td>
              </tr>
              <tr>
                <td><kbd>Cmd</kbd> + <kbd>Enter</kbd></td>
                <td>Execute query (Mac)</td>
              </tr>
              <tr>
                <td><kbd>Ctrl</kbd> + <kbd>/</kbd></td>
                <td>Toggle comment</td>
              </tr>
              <tr>
                <td><kbd>Tab</kbd></td>
                <td>Indent selection</td>
              </tr>
              <tr>
                <td><kbd>Shift</kbd> + <kbd>Tab</kbd></td>
                <td>Outdent selection</td>
              </tr>
            </tbody>
          </table>

          <h4>Global Shortcuts</h4>
          <table class="help-table">
            <thead>
              <tr>
                <th>Shortcut</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><kbd>?</kbd></td>
                <td>Open help (this modal)</td>
              </tr>
              <tr>
                <td><kbd>Esc</kbd></td>
                <td>Close current modal</td>
              </tr>
              <tr>
                <td><kbd>Ctrl</kbd> + <kbd>S</kbd></td>
                <td>Save/export current view</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- FAQ Tab -->
      <div id="help-tab-faq" class="help-tab-content">
        <h3> Frequently Asked Questions</h3>

        <div class="help-faq-item">
          <h4>Q: Is my data stored permanently?</h4>
          <p><strong>A:</strong> By default, AgentDB IDE uses in-memory storage. Your data is lost when you close the browser tab. To persist data, use the Export HTML feature to save your database configuration, or implement browser storage integration.</p>
        </div>

        <div class="help-faq-item">
          <h4>Q: What are vector embeddings and why 384 dimensions?</h4>
          <p><strong>A:</strong> Vector embeddings are numeric representations of text that capture semantic meaning. 384 dimensions is the standard for many embedding models (like MiniLM) and provides a good balance between semantic richness and computational efficiency.</p>
        </div>

        <div class="help-faq-item">
          <h4>Q: How do I generate embeddings for my own text?</h4>
          <p><strong>A:</strong> The Sample Data Generator includes Gemini AI integration that automatically generates embeddings. For custom integration, you can use embedding APIs (OpenAI, Cohere, etc.) and store the resulting vectors in the database.</p>
        </div>

        <div class="help-faq-item">
          <h4>Q: What's the difference between Patterns and Episodes?</h4>
          <p><strong>A:</strong> <strong>Patterns</strong> are reusable reasoning templates (e.g., "how to optimize budgets"). <strong>Episodes</strong> are specific execution records (e.g., "I tried optimization approach X and got reward Y"). Patterns are for knowledge storage, episodes are for learning from experience.</p>
        </div>

        <div class="help-faq-item">
          <h4>Q: How accurate is the Query Optimizer?</h4>
          <p><strong>A:</strong> The optimizer provides heuristic-based suggestions based on common SQL anti-patterns. While helpful for most queries, it doesn't replace a full query planner. Use it as a guide, and always test performance with your actual data.</p>
        </div>

        <div class="help-faq-item">
          <h4>Q: Can I use this with real APIs and external databases?</h4>
          <p><strong>A:</strong> Yes! The IDE is designed to be extended. You can modify the code to integrate with external APIs, connect to remote databases, or add custom data sources. The Export HTML feature makes it easy to create customized versions.</p>
        </div>

        <div class="help-faq-item">
          <h4>Q: What's the maximum database size?</h4>
          <p><strong>A:</strong> Since this uses WASM/SQLite in the browser, you're limited by browser memory (typically 1-2 GB). For larger datasets, consider using AgentDB's Node.js version with file-based storage.</p>
        </div>

        <div class="help-faq-item">
          <h4>Q: How do I report bugs or request features?</h4>
          <p><strong>A:</strong> Visit the <a href="https://github.com/ruvnet/agentic-flow/tree/main/packages/agentdb" target="_blank" style="color: var(--accent);">GitHub repository</a> to open issues or submit pull requests. We welcome community contributions!</p>
        </div>

        <div class="help-faq-item">
          <h4>Q: Is this production-ready?</h4>
          <p><strong>A:</strong> The IDE is a powerful development and prototyping tool. For production use, consider:</p>
          <ul>
            <li>Adding authentication and access control</li>
            <li>Implementing persistent storage</li>
            <li>Adding error handling and monitoring</li>
            <li>Performance testing with real workloads</li>
            <li>Security audits and input validation</li>
          </ul>
        </div>

        <div class="help-faq-item">
          <h4>Q: Where can I learn more about AgentDB?</h4>
          <p><strong>A:</strong> Resources:</p>
          <ul>
            <li><a href="https://agentdb.ruv.io" target="_blank" style="color: var(--accent);">Official Website</a> - Comprehensive documentation</li>
            <li><a href="https://github.com/ruvnet/agentic-flow/tree/main/packages/agentdb" target="_blank" style="color: var(--accent);">GitHub Repository</a> - Source code and examples</li>
            <li><a href="https://www.npmjs.com/package/agentdb" target="_blank" style="color: var(--accent);">NPM Package</a> - Installation and usage</li>
          </ul>
        </div>
      </div>

    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeHelp()">Close</button>
      <a href="https://agentdb.ruv.io" target="_blank" class="btn btn-primary"> Full Documentation</a>
    </div>
  </div>
</div>


  <!-- Add Pattern Modal -->
  <div id="addPatternModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"> Add Pattern</div>
        <button class="modal-close" onclick="closeAddPattern()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Pattern Type</label>
          <select class="form-select" id="pattern-type">
            <option value="causal">Causal</option>
            <option value="temporal">Temporal</option>
            <option value="reasoning">Reasoning</option>
            <option value="optimization">Optimization</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Pattern Description</label>
          <textarea class="form-input" id="pattern-description" rows="4" placeholder="Describe the pattern..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Metadata (JSON)</label>
          <textarea class="form-input" id="pattern-metadata" rows="3" placeholder='{"key": "value"}'>{}</textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeAddPattern()">Cancel</button>
        <button class="btn btn-primary" onclick="savePattern()">Save Pattern</button>
      </div>
    </div>
  </div>

  <!-- Add Episode Modal -->
  <div id="addEpisodeModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"> Add Episode</div>
        <button class="modal-close" onclick="closeAddEpisode()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Task</label>
          <input type="text" class="form-input" id="episode-task" placeholder="What task was performed?">
        </div>
        <div class="form-group">
          <label class="form-label">Action</label>
          <input type="text" class="form-input" id="episode-action" placeholder="What action was taken?">
        </div>
        <div class="form-group">
          <label class="form-label">Reward</label>
          <input type="number" class="form-input" id="episode-reward" placeholder="0.0" step="0.01">
        </div>
        <div class="form-group">
          <label class="form-label">Critique</label>
          <textarea class="form-input" id="episode-critique" rows="3" placeholder="Analysis of the outcome..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Metadata (JSON)</label>
          <textarea class="form-input" id="episode-metadata" rows="2" placeholder='{"key": "value"}'>{}</textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeAddEpisode()">Cancel</button>
        <button class="btn btn-primary" onclick="saveEpisode()">Save Episode</button>
      </div>
    </div>
  </div>

  <!-- Add Causal Edge Modal -->
  <div id="addCausalEdgeModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"> Add Causal Edge</div>
        <button class="modal-close" onclick="closeAddCausalEdge()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Cause</label>
          <input type="text" class="form-input" id="causal-cause" placeholder="What is the cause?">
        </div>
        <div class="form-group">
          <label class="form-label">Effect</label>
          <input type="text" class="form-input" id="causal-effect" placeholder="What is the effect?">
        </div>
        <div class="form-group">
          <label class="form-label">Weight (0.0 - 1.0)</label>
          <input type="number" class="form-input" id="causal-weight" placeholder="0.5" step="0.01" min="0" max="1" value="0.5">
        </div>
        <div class="form-group">
          <label class="form-label">Metadata (JSON)</label>
          <textarea class="form-input" id="causal-metadata" rows="2" placeholder='{"confidence": 0.9}'>{}</textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeAddCausalEdge()">Cancel</button>
        <button class="btn btn-primary" onclick="saveCausalEdge()">Save Edge</button>
      </div>
    </div>
  </div>

  <!-- Import/Export Modal -->
  <div id="importExportModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"> Import/Export Data</div>
        <button class="modal-close" onclick="closeImportExport()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="tabs">
          <button class="tab-button active" onclick="switchImportExportTab('export')">Export</button>
          <button class="tab-button" onclick="switchImportExportTab('import')">Import</button>
        </div>

        <div id="importexport-export" class="tab-content active">
          <h4 style="margin-bottom: 1rem;">Export Database</h4>
          <p style="color: var(--text-secondary); margin-bottom: 1rem;">Download your database in various formats:</p>

          <div style="display: grid; gap: 0.75rem;">
            <button class="btn btn-primary" onclick="exportDatabase('json')"> Export as JSON</button>
            <button class="btn btn-primary" onclick="exportDatabase('sql')"> Export as SQL</button>
            <button class="btn btn-primary" onclick="exportDatabase('csv')"> Export as CSV</button>
          </div>
        </div>

        <div id="importexport-import" class="tab-content">
          <h4 style="margin-bottom: 1rem;">Import Database</h4>
          <p style="color: var(--text-secondary); margin-bottom: 1rem;">Import data from a file:</p>

          <div class="form-group">
            <label class="form-label">Select File</label>
            <input type="file" class="form-input" id="import-file" accept=".json,.sql,.csv">
          </div>
          <button class="btn btn-primary" onclick="importDatabase()"> Import Data</button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeImportExport()">Close</button>
      </div>
    </div>
  </div>

  <!-- Sample Data Generator Modal -->
  <div id="sampleDataModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"> Sample Data Generator</div>
        <button class="modal-close" onclick="closeSampleData()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Data Type</label>
          <select class="form-input" id="sample-data-type">
            <option value="all" selected>All Types (Complete Dataset)</option>
            <option value="patterns">Reasoning Patterns</option>
            <option value="episodes">Episodes (Task-Action-Reward)</option>
            <option value="causal">Causal Edges</option>
            <option value="skills">Skills (Reusable Capabilities)</option>
            <option value="vectors">Vector Embeddings (Semantic Search)</option>
          </select>
          <small style="color: var(--text-secondary); display: block; margin-top: 0.25rem;">
            Choose what type of sample data to generate
          </small>
        </div>

        <div class="form-group">
          <label class="form-label">Number of Records</label>
          <input type="number" class="form-input" id="sample-data-count" value="10" min="1" max="100">
          <small style="color: var(--text-secondary); display: block; margin-top: 0.25rem;">
            How many records to generate (1-100)
          </small>
        </div>

        <div class="form-group">
          <label class="form-label">Generation Method</label>
          <select class="form-input" id="sample-data-method">
            <option value="local" selected>Local Templates (Recommended)</option>
            <option value="ai">AI-Powered (Gemini - requires CORS setup)</option>
          </select>
          <small style="color: var(--text-secondary); display: block; margin-top: 0.25rem;">
            Local generation works instantly. AI requires CORS configuration.
          </small>
        </div>

        <div class="form-group" id="sample-theme-group">
          <label class="form-label">Theme (for AI generation)</label>
          <input type="text" class="form-input" id="sample-data-theme" placeholder="e.g., e-commerce, robotics, customer service">
          <small style="color: var(--text-secondary); display: block; margin-top: 0.25rem;">
            Optional: Domain context for more relevant AI-generated data
          </small>
        </div>

        <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 6px; border-left: 3px solid var(--primary);">
          <div style="font-weight: 500; margin-bottom: 0.5rem;"> What will be generated:</div>
          <ul style="margin: 0; padding-left: 1.5rem; font-size: 0.875rem; color: var(--text-secondary);">
            <li id="gen-info-patterns" style="display: none;">Reasoning patterns with contexts and results</li>
            <li id="gen-info-episodes" style="display: none;">Episodes with tasks, actions, rewards, and critiques</li>
            <li id="gen-info-causal" style="display: none;">Causal edges showing cause-effect relationships</li>
            <li id="gen-info-skills" style="display: none;">Reusable skills with prompts and success criteria</li>
            <li id="gen-info-vectors" style="display: none;">Vector embeddings for semantic search and similarity</li>
            <li id="gen-info-all" style="display: none;">Complete dataset distributed across all data types</li>
          </ul>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeSampleData()">Cancel</button>
        <button class="btn btn-primary" onclick="generateSampleData()"> Generate Data</button>
      </div>
    </div>
  </div>

  <!-- Schema Designer Modal -->
  <div id="schemaDesignerModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"> Schema Designer</div>
        <button class="modal-close" onclick="closeSchemaDesigner()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Table Name</label>
          <input type="text" class="form-input" id="schema-table-name" placeholder="my_table">
        </div>
        <div class="form-group">
          <label class="form-label">Columns (one per line: name TYPE [constraints])</label>
          <textarea class="form-input" id="schema-columns" rows="8" placeholder="id INTEGER PRIMARY KEY AUTOINCREMENT
name TEXT NOT NULL
value REAL
created_at INTEGER DEFAULT (strftime('%s', 'now'))"></textarea>
        </div>
        <div style="margin-top: 1rem;">
          <button class="btn btn-primary" onclick="createTableFromSchema()"> Create Table</button>
          <button class="btn btn-secondary" onclick="previewSchema()"> Preview SQL</button>
        </div>
        <div id="schema-preview" style="margin-top: 1rem; display: none;">
          <label class="form-label">Generated SQL</label>
          <pre style="background: var(--bg-primary); padding: 1rem; border-radius: 6px; overflow-x: auto; color: var(--text-primary); font-size: 0.875rem;" id="schema-sql"></pre>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeSchemaDesigner()">Close</button>
      </div>
    </div>
  </div>

  <!-- Trajectory Visualization Modal -->
  <div id="trajectoryModal" class="modal-overlay">
    <div class="modal" style="max-width: 900px;">
      <div class="modal-header">
        <div class="modal-title"> Episode Trajectories</div>
        <button class="modal-close" onclick="closeTrajectoryView()">&times;</button>
      </div>
      <div class="modal-body" id="trajectoryContent">
        <!-- Content will be populated by JavaScript -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeTrajectoryView()">Close</button>
      </div>
    </div>
  </div>

  <!-- Causal Analysis Modal -->
  <div id="causalAnalysisModal" class="modal-overlay">
    <div class="modal" style="max-width: 900px;">
      <div class="modal-header">
        <div class="modal-title"> Causal Path Analysis</div>
        <button class="modal-close" onclick="closeCausalAnalysis()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="info-banner" style="margin-bottom: 1.5rem; background: var(--bg-secondary); padding: 1rem; border-radius: 6px; border-left: 3px solid var(--primary-color);">
          <div style="font-weight: 500; margin-bottom: 0.5rem;"> Path Analysis Features</div>
          <div style="font-size: 0.875rem; opacity: 0.9;">
             Discover direct and indirect causal relationships<br>
             Detect feedback loops and cycles<br>
             Rank paths by cumulative strength<br>
             Find strongest causal chains
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
          <div class="form-group">
            <label class="form-label">Start Node (optional)</label>
            <input type="text" class="form-input" id="analysis-start-node" placeholder="Leave empty for all nodes">
            <div style="font-size: 0.75rem; opacity: 0.7; margin-top: 0.25rem;">Find all paths starting from this cause</div>
          </div>
          <div class="form-group">
            <label class="form-label">End Node (optional)</label>
            <input type="text" class="form-input" id="analysis-end-node" placeholder="Leave empty for all nodes">
            <div style="font-size: 0.75rem; opacity: 0.7; margin-top: 0.25rem;">Find all paths ending at this effect</div>
          </div>
        </div>

        <div class="form-group" style="margin-bottom: 1.5rem;">
          <label class="form-label">Maximum Path Depth: <span id="max-depth-value">3</span> hops</label>
          <input type="range" class="form-input" id="analysis-max-depth" min="1" max="5" value="3"
                 style="width: 100%;" oninput="document.getElementById('max-depth-value').textContent = this.value">
          <div style="font-size: 0.75rem; opacity: 0.7; margin-top: 0.25rem;">How many steps to traverse in the causal graph</div>
        </div>

        <div style="display: flex; gap: 0.75rem; margin-bottom: 1.5rem;">
          <button class="btn btn-primary" onclick="runPathAnalysis()"> Find Paths</button>
          <button class="btn btn-secondary" onclick="detectCycles()"> Detect Cycles</button>
          <button class="btn btn-secondary" onclick="findStrongestChains()"> Strongest Chains</button>
          <button class="btn btn-secondary" onclick="analyzeAllPaths()"> Analyze All</button>
        </div>

        <div id="analysis-results" style="max-height: 400px; overflow-y: auto;">
          <div class="empty-state">
            <div class="empty-state-icon"></div>
            <div class="empty-state-title">Ready to analyze</div>
            <div class="empty-state-text">Configure options above and click a button to start analysis</div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeCausalAnalysis()">Close</button>
      </div>
    </div>
  </div>

  <!-- Batch Import Modal -->
  <div id="batchImportModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"> Batch Pattern Import</div>
        <button class="modal-close" onclick="closeBatchImport()">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Import Tabs -->
        <div class="tabs">
          <button class="tab-button active" onclick="switchBatchImportTab('file')"> File Upload</button>
          <button class="tab-button" onclick="switchBatchImportTab('template')"> Templates</button>
        </div>

        <!-- File Upload Tab -->
        <div id="batch-file" class="tab-content active">
          <div class="form-group">
            <label class="form-label">Upload JSON File</label>
            <input type="file" class="form-input" id="batch-file-input" accept=".json" onchange="handleBatchFileUpload(event)">
            <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem;">
              Expected format: Array of pattern objects with name, pattern_type, and content fields.
            </p>
          </div>

          <div class="form-group">
            <label class="form-label">Or Paste JSON</label>
            <textarea class="form-input" id="batch-json-input" rows="8" placeholder='[
  {
    "name": "Pattern Name",
    "pattern_type": "cognitive",
    "content": "Pattern description...",
    "metadata": {}
  }
]'></textarea>
          </div>

          <button class="btn btn-primary" onclick="previewBatchImportFromText()"> Preview Patterns</button>
        </div>

        <!-- Template Tab -->
        <div id="batch-template" class="tab-content">
          <div class="form-group">
            <label class="form-label">Select Template</label>
            <select class="form-select" id="batch-template-select" onchange="showTemplateDescription()">
              <option value="">-- Choose a Template --</option>
              <option value="marketing">Marketing Optimization (5 patterns)</option>
              <option value="healthcare">Healthcare Diagnostics (5 patterns)</option>
              <option value="financial">Financial Analysis (5 patterns)</option>
            </select>
          </div>

          <div id="template-description" style="display: none; background: var(--bg-tertiary); padding: 1rem; border-radius: 6px; margin-top: 1rem;">
            <h4 style="color: var(--accent); margin-bottom: 0.5rem; font-size: 0.875rem;">Template Details</h4>
            <p id="template-description-text" style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.75rem;"></p>
            <button class="btn btn-primary" onclick="previewTemplatePatterns()"> Preview Patterns</button>
          </div>
        </div>

        <!-- Preview Section -->
        <div id="batch-preview" style="display: none; margin-top: 1.5rem; border-top: 1px solid var(--border-color); padding-top: 1.5rem;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h4 style="color: var(--accent); font-size: 1rem;">Preview Patterns (<span id="preview-count">0</span>)</h4>
            <div style="display: flex; gap: 0.5rem;">
              <label class="form-checkbox">
                <input type="checkbox" id="skip-duplicates" checked>
                <span style="font-size: 0.875rem;">Skip duplicates</span>
              </label>
            </div>
          </div>

          <div id="preview-patterns" style="max-height: 300px; overflow-y: auto; background: var(--bg-tertiary); border-radius: 6px; padding: 1rem;">
            <!-- Preview items will be inserted here -->
          </div>

          <div id="validation-errors" style="display: none; margin-top: 1rem; padding: 1rem; background: hsl(0 76% 50% / 0.1); border-radius: 6px; border: 1px solid var(--danger);">
            <h4 style="color: var(--danger); font-size: 0.875rem; margin-bottom: 0.5rem;"> Validation Errors</h4>
            <ul id="error-list" style="margin-left: 1.5rem; font-size: 0.875rem; color: var(--text-secondary);"></ul>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeBatchImport()">Cancel</button>
        <button class="btn btn-primary" id="execute-import-btn" onclick="executeBatchImport()" disabled>Import Patterns</button>
      </div>
    </div>
  </div>

  <!-- Sample Data Overview Modal - Console Style -->
  <div id="sampleDataOverviewModal" class="modal-overlay">
    <div class="modal modal-large" style="background: linear-gradient(135deg, #0f1419 0%, #1a1f2e 100%); border: 1px solid rgba(34, 197, 94, 0.3); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);">
      <div class="modal-header" style="background: linear-gradient(90deg, rgba(34, 197, 94, 0.1) 0%, rgba(21, 128, 61, 0.1) 100%); border-bottom: 1px solid rgba(34, 197, 94, 0.3);">
        <div class="modal-title" style="font-family: 'Courier New', monospace; color: #22c55e; font-weight: 700;">
          <span style="color: #22c55e;">></span> <span style="color: #e5e7eb;">Sample Data Generation Complete</span> <span style="color: #22c55e; animation: blink 1s infinite;"></span>
        </div>
        <button class="modal-close" onclick="closeSampleDataOverview()" style="color: #6b7280; opacity: 0.8; transition: opacity 0.2s;"></button>
      </div>
      <div class="modal-body" style="padding: 2rem; background: rgba(15, 20, 25, 0.95); font-family: 'Courier New', monospace;">

        <!-- Console Output Header -->
        <div style="background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(75, 85, 99, 0.3); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem;">
          <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
            <span style="width: 12px; height: 12px; background: #374151; border-radius: 50%;"></span>
            <span style="width: 12px; height: 12px; background: #4b5563; border-radius: 50%;"></span>
            <span style="width: 12px; height: 12px; background: #22c55e; border-radius: 50%;"></span>
            <span style="margin-left: auto; color: rgba(107, 114, 128, 0.8); font-size: 0.75rem;">agentdb-generator</span>
          </div>

          <div style="color: #9ca3af; font-size: 0.875rem; line-height: 1.8;">
            <div><span style="color: #22c55e;"></span> <span style="color: #d1d5db;">Generation completed successfully</span></div>
            <div style="margin-top: 0.5rem; padding-left: 1.25rem;">
              <span style="color: #22c55e;"></span> <span style="color: #9ca3af;">Total Records:</span> <span style="color: #e5e7eb; font-weight: 700;" id="overview-total-count">0</span>
            </div>
            <div style="padding-left: 1.25rem;">
              <span style="color: #22c55e;"></span> <span style="color: #9ca3af;">Duration:</span> <span style="color: #e5e7eb; font-weight: 700;" id="overview-duration">0ms</span>
            </div>
            <div style="padding-left: 1.25rem;">
              <span style="color: #22c55e;"></span> <span style="color: #9ca3af;">Method:</span> <span style="color: #e5e7eb; font-weight: 700;" id="overview-method">Local Templates</span>
            </div>
          </div>
        </div>

        <!-- Data Breakdown - Console Style -->
        <div style="background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(75, 85, 99, 0.3); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem;">
          <div style="color: #22c55e; font-weight: 700; margin-bottom: 1rem; font-size: 0.9375rem;">
            <span style="color: #22c55e;">$</span> Data Breakdown
          </div>

          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div style="background: rgba(34, 197, 94, 0.05); border-left: 3px solid #22c55e; padding: 1rem; border-radius: 4px;">
              <div style="color: #6b7280; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem;">Patterns</div>
              <div style="color: #e5e7eb; font-size: 1.75rem; font-weight: 700;" id="overview-patterns-count">0</div>
              <div style="color: #22c55e; font-size: 0.75rem; margin-top: 0.25rem;"> reasoning_patterns</div>
            </div>

            <div style="background: rgba(34, 197, 94, 0.05); border-left: 3px solid #16a34a; padding: 1rem; border-radius: 4px;">
              <div style="color: #6b7280; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem;">Episodes</div>
              <div style="color: #e5e7eb; font-size: 1.75rem; font-weight: 700;" id="overview-episodes-count">0</div>
              <div style="color: #16a34a; font-size: 0.75rem; margin-top: 0.25rem;"> task_episodes</div>
            </div>

            <div style="background: rgba(107, 114, 128, 0.1); border-left: 3px solid #6b7280; padding: 1rem; border-radius: 4px;">
              <div style="color: #6b7280; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem;">Causal</div>
              <div style="color: #e5e7eb; font-size: 1.75rem; font-weight: 700;" id="overview-causal-count">0</div>
              <div style="color: #9ca3af; font-size: 0.75rem; margin-top: 0.25rem;"> causal_edges</div>
            </div>

            <div style="background: rgba(107, 114, 128, 0.1); border-left: 3px solid #6b7280; padding: 1rem; border-radius: 4px;">
              <div style="color: #6b7280; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem;">Skills</div>
              <div style="color: #e5e7eb; font-size: 1.75rem; font-weight: 700;" id="overview-skills-count">0</div>
              <div style="color: #9ca3af; font-size: 0.75rem; margin-top: 0.25rem;"> skill_library</div>
            </div>

            <div style="background: rgba(107, 114, 128, 0.1); border-left: 3px solid #6b7280; padding: 1rem; border-radius: 4px;">
              <div style="color: #6b7280; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem;">Vectors</div>
              <div style="color: #e5e7eb; font-size: 1.75rem; font-weight: 700;" id="overview-vectors-count">0</div>
              <div style="color: #9ca3af; font-size: 0.75rem; margin-top: 0.25rem;"> vector_embeddings</div>
            </div>
          </div>
        </div>

        <!-- Console Log Preview -->
        <div style="background: rgba(0, 0, 0, 0.6); border: 1px solid rgba(75, 85, 99, 0.3); border-radius: 8px; padding: 1.5rem;">
          <div style="color: #22c55e; font-weight: 700; margin-bottom: 1rem; font-size: 0.9375rem;">
            <span style="color: #22c55e;">$</span> Console Output
          </div>
          <div id="overview-sample-preview" style="max-height: 250px; overflow-y: auto; font-size: 0.8125rem; line-height: 1.8; color: #9ca3af;">
            <p style="color: #9ca3af;"><span style="color: #22c55e;"></span> Loading preview...</p>
          </div>
        </div>

        <!-- Quick Actions -->
        <div style="margin-top: 1.5rem; background: rgba(34, 197, 94, 0.05); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 8px; padding: 1rem;">
          <div style="color: #22c55e; font-size: 0.875rem; margin-bottom: 0.75rem;">
            <span style="color: #22c55e;"></span> Ready to explore your data
          </div>
          <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
            <button class="btn btn-secondary" onclick="closeSampleDataOverview()" style="background: rgba(75, 85, 99, 0.2); border: 1px solid rgba(107, 114, 128, 0.4); color: #9ca3af; font-family: 'Courier New', monospace;">Close</button>
            <button class="btn btn-primary" onclick="closeSampleDataOverview(); switchView('data-browser'); refreshTableList();" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); border: none; color: #0f1419; font-weight: 700; font-family: 'Courier New', monospace;"> Browse Data</button>
            <button class="btn btn-primary" onclick="closeSampleDataOverview(); switchView('patterns'); refreshPatterns();" style="background: linear-gradient(135deg, #22c55e 0%, #15803d 100%); border: none; color: #0f1419; font-weight: 700; font-family: 'Courier New', monospace;"> View Patterns</button>
            <button class="btn btn-primary" onclick="closeSampleDataOverview(); switchView('episodes'); refreshEpisodes();" style="background: linear-gradient(135deg, #16a34a 0%, #15803d 100%); border: none; color: #0f1419; font-weight: 700; font-family: 'Courier New', monospace;"> View Episodes</button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <style>
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
  </style>

  <!-- Module polyfill for browser compatibility -->
  <script>
    // Polyfill for CommonJS module system in browser
    if (typeof module === 'undefined') {
      window.module = { exports: {} };
      window.exports = window.module.exports;
    }
    // Polyfill for require (basic implementation)
    if (typeof require === 'undefined') {
      window.require = function(moduleName) {
        console.warn('require() polyfill: module', moduleName, 'not available');
        return {};
      };
    }
  </script>

  <!-- AgentDB Script -->
  <script src="https://unpkg.com/agentdb@1.3.9/dist/agentdb.min.js"></script>
  <!-- Batch Import Functionality -->
  <script src="batch-import.js"></script>
  <!-- Causal Path Analysis -->
  <script src="causal-analysis.js"></script>
  <!-- Advanced Query Optimizer -->
  <script src="optimizer.js"></script>
  <!-- Pattern Enhancements -->
  <script src="pattern-enhancements.js"></script>
  <!-- Pattern Sample Data Generator -->
  <script src="pattern-sample-data.js"></script>
  <!-- Vector Search Functions -->
  <script src="vector-search-functions.js"></script>
  <!-- Enhanced Help System -->
  <script src="help-system.js"></script>

  <!-- Main Application Script -->
  <script>
    // ============================================================================
    // STATE MANAGEMENT
    // ============================================================================

    const state = {
      db: null,
      initialized: false,
      currentView: 'sql-editor',
      currentTab: 'editor',
      queryHistory: [],
      savedQueries: [],
      stats: {
        queryCount: 0,
        totalTime: 0,
        cacheHits: 0,
        cacheMisses: 0
      },
      settings: {
        mode: 'memory',
        autosave: 30,
        autobackup: true,
        dimensions: 384,
        threshold: 0.7,
        searchLimit: 10,
        cacheSize: 100,
        queryCache: true,
        lazyLoad: true,
        debugLevel: 'info',
        detailedLogs: true,
        performanceTracking: false
      }
    };

    // ============================================================================
    // SQL HELPER FUNCTIONS
    // ============================================================================

    // Helper functions to access SQL.js database
    // AgentDB v1.3.9 exposes SQL.js methods directly on the instance
    function sqlAll(query, params = []) {
      const results = state.db.exec(query, params);
      if (results.length === 0) return [];

      const columns = results[0].columns;
      return results[0].values.map(row => {
        const obj = {};
        columns.forEach((col, i) => {
          obj[col] = row[i];
        });
        return obj;
      });
    }

    function sqlRun(query, params = []) {
      state.db.run(query, params);
    }

    function sqlGet(query, params = []) {
      const results = sqlAll(query, params);
      return results.length > 0 ? results[0] : null;
    }

    // ============================================================================
    // CONSOLE LOGGING
    // ============================================================================

    function logToConsole(type, message, data = null) {
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.className = `console-log ${type}`;

      logEntry.innerHTML = `
        <span class="timestamp">${timestamp}</span>
        <span class="type">${type.toUpperCase()}</span>
        <span class="message">${message}</span>
      `;

      const consoleOutput = document.getElementById('console-output');
      consoleOutput.appendChild(logEntry);
      consoleOutput.scrollTop = consoleOutput.scrollHeight;

      // Also log to browser console with data
      const logMethod = type === 'error' ? 'error' : type === 'warning' ? 'warn' : 'log';
      if (data) {
        window.console[logMethod](`[AgentDB IDE] ${message}`, data);
      } else {
        window.console[logMethod](`[AgentDB IDE] ${message}`);
      }
    }

    function clearConsole() {
      document.getElementById('console-output').innerHTML = '';
      logToConsole('info', 'Console cleared');
    }

    function exportLogs() {
      const logs = document.getElementById('console-output').innerText;
      downloadFile('agentdb-logs.txt', logs);
      logToConsole('success', 'Logs exported successfully');
    }

    function toggleConsole() {
      const consoleElement = document.querySelector('.ide-console');
      const toggleIcon = document.getElementById('console-toggle');

      consoleElement.classList.toggle('collapsed');

      // Update arrow:  when collapsed (click to expand up),  when expanded (click to collapse down)
      if (consoleElement.classList.contains('collapsed')) {
        toggleIcon.textContent = '';
      } else {
        toggleIcon.textContent = '';
      }
    }

    // ============================================================================
    // DATABASE INITIALIZATION
    // ============================================================================

    async function initializeDatabase() {
      logToConsole('info', 'Initializing AgentDB v1.3.9...');

      try {
        // Wait for AgentDB global to be available
        let attempts = 0;
        while (typeof AgentDB === 'undefined' && attempts < 50) {
          await new Promise(resolve => setTimeout(resolve, 100));
          attempts++;
        }

        if (typeof AgentDB === 'undefined') {
          throw new Error('AgentDB failed to load');
        }

        logToConsole('info', 'AgentDB library loaded, waiting for ready state...');

        // Wait for AgentDB.ready
        attempts = 0;
        while (!(AgentDB.ready === true) && attempts < 100) {
          await new Promise(resolve => setTimeout(resolve, 100));
          attempts++;
        }

        if (!(AgentDB.ready === true)) {
          throw new Error('AgentDB did not become ready in time');
        }

        logToConsole('success', 'AgentDB ready, creating database instance...');

        // Create database instance (v1.3.9 uses AgentDB.SQLiteVectorDB)
        state.db = new AgentDB.SQLiteVectorDB({
          memoryMode: state.settings.mode === 'memory',
          backend: 'wasm'
        });

        logToConsole('info', 'Initializing database schema...');

        // Initialize with schema (v1.3.9 automatically creates all tables)
        await state.db.initializeAsync();

        state.initialized = true;

        logToConsole('success', 'Database initialized successfully!');
        logToConsole('info', `Mode: ${state.settings.mode === 'memory' ? 'In-Memory (WASM)' : 'Persistent (IndexedDB)'}, Backend: WASM`);

        // Debug: Check available properties
        window.console.log('AgentDB instance properties:', Object.keys(state.db));
        window.console.log('AgentDB instance:', state.db);

        // Update UI
        document.getElementById('db-status').textContent = 'Connected';
        document.getElementById('db-status').className = 'status-badge success';
        document.getElementById('db-mode').textContent = state.settings.mode;

        // Load initial data
        await refreshAll();

        logToConsole('info', 'IDE ready for use');

      } catch (error) {
        logToConsole('error', `Failed to initialize database: ${error.message}`, error);
        document.getElementById('db-status').textContent = 'Error';
        document.getElementById('db-status').className = 'status-badge error';
      }
    }

    // ============================================================================
    // SQL EDITOR
    // ============================================================================

    async function executeSQL() {
      const editor = document.getElementById('sql-editor');
      const query = editor.value.trim();

      if (!query) {
        logToConsole('warning', 'Please enter a SQL query');
        return;
      }

      logToConsole('info', `Executing query: ${query.substring(0, 100)}...`);

      const startTime = performance.now();

      try {
        // Execute query
        const results = sqlAll(query);
        const endTime = performance.now();
        const duration = Math.round(endTime - startTime);

        // Update stats
        state.stats.queryCount++;
        state.stats.totalTime += duration;
        updateStats();

        // Add to history
        state.queryHistory.unshift({
          query,
          timestamp: new Date().toISOString(),
          duration,
          rowCount: results.length
        });

        // Display results
        displayQueryResults(results, duration);

        // Display diagnostics
        displayDiagnostics(query, results, duration);

        // Auto-switch to Results tab
        document.querySelector('.main-tab[data-tab="results"]').click();

        logToConsole('success', `Query executed successfully: ${results.length} rows in ${duration}ms`);

      } catch (error) {
        logToConsole('error', `Query failed: ${error.message}`, error);

        // Show error in results
        const resultDiv = document.getElementById('query-result');
        resultDiv.style.display = 'block';
        resultDiv.querySelector('#result-table-container').innerHTML = `
          <div style="padding: 2rem; text-align: center; color: var(--danger);">
            <div style="font-size: 2rem; margin-bottom: 1rem;"></div>
            <div style="font-weight: 600; margin-bottom: 0.5rem;">Query Error</div>
            <div style="font-size: 0.875rem; color: var(--text-secondary);">${error.message}</div>
          </div>
        `;
      }
    }

    function displayQueryResults(results, duration) {
      const resultDiv = document.getElementById('query-result');
      const resultHeader = resultDiv.querySelector('.result-header');
      const countSpan = document.getElementById('result-count');
      const timeSpan = document.getElementById('result-time');
      const container = document.getElementById('result-table-container');

      resultDiv.style.display = 'block';
      countSpan.textContent = results.length;
      timeSpan.textContent = duration;

      if (results.length === 0) {
        resultHeader.style.display = 'none';
        container.innerHTML = '<div class="empty-state"><div class="empty-state-icon"></div><div class="empty-state-title">No results</div><div class="empty-state-text">Query returned no rows</div></div>';
        return;
      }

      resultHeader.style.display = 'flex';

      // Build table
      const columns = Object.keys(results[0]);
      let html = '<table class="data-table"><thead><tr>';

      columns.forEach(col => {
        html += `<th>${col}</th>`;
      });
      html += '</tr></thead><tbody>';

      results.forEach(row => {
        html += '<tr>';
        columns.forEach(col => {
          let value = row[col];
          // Format value based on type
          if (value === null) value = '<em style="color: var(--text-muted);">NULL</em>';
          else if (typeof value === 'object') value = JSON.stringify(value);
          else if (typeof value === 'string' && value.length > 100) value = value.substring(0, 100) + '...';
          html += `<td>${value}</td>`;
        });
        html += '</tr>';
      });

      html += '</tbody></table>';
      container.innerHTML = html;
    }

    function formatSQL() {
      const editor = document.getElementById('sql-editor');
      let sql = editor.value;

      // Basic SQL formatting
      sql = sql
        .replace(/\s+/g, ' ')
        .replace(/ SELECT /gi, '\nSELECT ')
        .replace(/ FROM /gi, '\nFROM ')
        .replace(/ WHERE /gi, '\nWHERE ')
        .replace(/ AND /gi, '\n  AND ')
        .replace(/ OR /gi, '\n  OR ')
        .replace(/ ORDER BY /gi, '\nORDER BY ')
        .replace(/ GROUP BY /gi, '\nGROUP BY ')
        .replace(/ LIMIT /gi, '\nLIMIT ')
        .replace(/ JOIN /gi, '\nJOIN ')
        .replace(/ LEFT JOIN /gi, '\nLEFT JOIN ')
        .replace(/ INNER JOIN /gi, '\nINNER JOIN ')
        .trim();

      editor.value = sql;
      logToConsole('success', 'Query formatted');
    }

    // AgentDB Query Templates
    function loadTemplate(type) {
      const editor = document.getElementById('sql-editor');
      const templates = {
        vectors: `-- Query all vectors with metadata
SELECT
  id,
  embedding,
  json_extract(metadata, '$.description') as description,
  json_extract(metadata, '$.type') as type,
  created_at
FROM vectors
ORDER BY created_at DESC
LIMIT 20;`,

        patterns: `-- Query patterns by type with metadata analysis
SELECT
  id,
  pattern_type,
  json_extract(metadata, '$.description') as description,
  json_extract(metadata, '$.approach') as approach,
  json_extract(metadata, '$.taskType') as task_type,
  created_at
FROM patterns
WHERE pattern_type = 'causal'  -- Change to: temporal, reasoning, optimization
ORDER BY created_at DESC
LIMIT 20;`,

        episodes: `-- Query high-performing episodes with learning insights
SELECT
  id,
  task,
  action,
  reward,
  critique,
  json_extract(metadata, '$.duration') as duration,
  json_extract(metadata, '$.channels') as channels,
  created_at
FROM episodes
WHERE reward > 0.7
ORDER BY reward DESC, created_at DESC
LIMIT 20;`,

        causal: `-- Query causal relationships with strength and confidence
SELECT
  id,
  cause,
  effect,
  json_extract(metadata, '$.weight') as weight,
  json_extract(metadata, '$.confidence') as confidence,
  json_extract(metadata, '$.sample_size') as sample_size,
  created_at
FROM causal_edges
ORDER BY json_extract(metadata, '$.weight') DESC
LIMIT 20;`,

        similarity: `-- Find semantically similar patterns
-- Note: This demonstrates the concept - actual vector similarity requires embedding comparison
SELECT
  p1.id as pattern_id,
  p1.pattern_type,
  json_extract(p1.metadata, '$.description') as description,
  COUNT(p2.id) as similar_count
FROM patterns p1
LEFT JOIN patterns p2
  ON p1.pattern_type = p2.pattern_type
  AND p1.id != p2.id
GROUP BY p1.id, p1.pattern_type
ORDER BY similar_count DESC
LIMIT 20;`,

        aggregate: `-- Aggregate statistics across AgentDB tables
SELECT
  'Vectors' as table_name,
  COUNT(*) as total_count,
  COUNT(DISTINCT json_extract(metadata, '$.type')) as unique_types,
  MIN(created_at) as first_created,
  MAX(created_at) as last_created
FROM vectors

UNION ALL

SELECT
  'Patterns' as table_name,
  COUNT(*) as total_count,
  COUNT(DISTINCT pattern_type) as unique_types,
  MIN(created_at) as first_created,
  MAX(created_at) as last_created
FROM patterns

UNION ALL

SELECT
  'Episodes' as table_name,
  COUNT(*) as total_count,
  COUNT(DISTINCT ROUND(reward, 1)) as unique_types,
  MIN(created_at) as first_created,
  MAX(created_at) as last_created
FROM episodes;`,

        join: `-- Advanced join: Episodes with their patterns and causal edges
SELECT
  e.id as episode_id,
  e.task,
  e.action,
  e.reward,
  p.pattern_type,
  json_extract(p.metadata, '$.description') as pattern_description,
  c.cause,
  c.effect,
  json_extract(c.metadata, '$.weight') as causal_weight
FROM episodes e
LEFT JOIN patterns p
  ON json_extract(e.metadata, '$.pattern_id') = p.id
LEFT JOIN causal_edges c
  ON e.action = c.cause
WHERE e.reward > 0.5
ORDER BY e.reward DESC
LIMIT 20;`,

        metadata: `-- Advanced JSON metadata queries
SELECT
  id,
  pattern_type,
  -- Extract nested JSON fields
  json_extract(metadata, '$.description') as description,
  json_extract(metadata, '$.hyperparameters.learningRate') as learning_rate,
  json_extract(metadata, '$.hyperparameters.batchSize') as batch_size,
  -- Check if JSON key exists
  CASE
    WHEN json_extract(metadata, '$.confidence') IS NOT NULL
    THEN 'Has confidence'
    ELSE 'No confidence'
  END as has_confidence,
  -- Parse JSON arrays
  json_extract(metadata, '$.tags[0]') as first_tag,
  created_at
FROM patterns
WHERE json_extract(metadata, '$.approach') LIKE '%optimization%'
ORDER BY created_at DESC
LIMIT 20;`
      };

      editor.value = templates[type] || '-- Template not found';
      logToConsole('info', `Loaded ${type} template`);
    }

    function showExamples() {
      const examples = `
<div class="help-section">
  <h3> Common AgentDB Query Patterns</h3>

  <h4>1. Find Patterns by Type</h4>
  <div class="help-example"><pre>SELECT * FROM patterns
WHERE pattern_type = 'causal'
ORDER BY created_at DESC LIMIT 10;</pre></div>

  <h4>2. Analyze Episode Performance</h4>
  <div class="help-example"><pre>SELECT
  task,
  AVG(reward) as avg_reward,
  COUNT(*) as attempts,
  MAX(reward) as best_reward
FROM episodes
GROUP BY task
ORDER BY avg_reward DESC;</pre></div>

  <h4>3. Extract JSON Metadata</h4>
  <div class="help-example"><pre>SELECT
  id,
  json_extract(metadata, '$.description') as desc,
  json_extract(metadata, '$.confidence') as conf
FROM patterns;</pre></div>

  <h4>4. Find High-Confidence Causal Links</h4>
  <div class="help-example"><pre>SELECT cause, effect,
  json_extract(metadata, '$.weight') as weight,
  json_extract(metadata, '$.confidence') as confidence
FROM causal_edges
WHERE CAST(json_extract(metadata, '$.confidence') AS REAL) > 0.8;</pre></div>

  <h4>5. Time-Based Analysis</h4>
  <div class="help-example"><pre>SELECT
  DATE(created_at, 'unixepoch') as date,
  COUNT(*) as count
FROM patterns
GROUP BY date
ORDER BY date DESC;</pre></div>

  <h4>6. Cross-Table Insights</h4>
  <div class="help-example"><pre>SELECT
  p.pattern_type,
  COUNT(e.id) as episode_count,
  AVG(e.reward) as avg_reward
FROM patterns p
LEFT JOIN episodes e ON p.id = json_extract(e.metadata, '$.pattern_id')
GROUP BY p.pattern_type;</pre></div>
</div>`;

      const modal = document.getElementById('helpModal');
      document.querySelector('#helpModal .modal-body').innerHTML = examples;
      modal.classList.add('active');
    }

    function showSchemaHelp() {
      const schema = `
<div class="help-section">
  <h3> AgentDB Schema Reference</h3>

  <h4> vectors</h4>
  <div class="help-example"><pre>id INTEGER PRIMARY KEY
embedding TEXT (384-dimensional vector as JSON)
metadata TEXT (JSON: type, description, source, etc.)
created_at INTEGER (Unix timestamp)</pre></div>

  <h4> patterns</h4>
  <div class="help-example"><pre>id INTEGER PRIMARY KEY
pattern TEXT (Optional pattern content)
pattern_type TEXT (causal, temporal, reasoning, optimization, custom)
embedding TEXT (384-dimensional vector as JSON)
metadata TEXT (JSON: description, approach, taskType, hyperparameters, etc.)
created_at INTEGER (Unix timestamp)</pre></div>

  <h4> episodes</h4>
  <div class="help-example"><pre>id INTEGER PRIMARY KEY
task TEXT (Task description)
action TEXT (Action taken)
trajectory TEXT (Optional: sequence of steps)
reward REAL (Outcome value: 0.0 - 1.0)
critique TEXT (Analysis of result)
self_reflection TEXT (Optional: learning insights)
verdict TEXT (Optional: final assessment)
embedding TEXT (384-dimensional vector as JSON)
metadata TEXT (JSON: duration, channels, pattern_id, etc.)
created_at INTEGER (Unix timestamp)</pre></div>

  <h4> causal_edges</h4>
  <div class="help-example"><pre>id INTEGER PRIMARY KEY
cause TEXT (Cause identifier)
effect TEXT (Effect identifier)
metadata TEXT (JSON: weight [0-1], confidence [0-1], sample_size, etc.)
created_at INTEGER (Unix timestamp)</pre></div>

  <h4> skills</h4>
  <div class="help-example"><pre>id INTEGER PRIMARY KEY
name TEXT (Skill name)
code TEXT (Executable code)
metadata TEXT (JSON: language, dependencies, description, etc.)
created_at INTEGER (Unix timestamp)</pre></div>

  <h3> JSON Metadata Tips</h3>
  <ul>
    <li><code>json_extract(metadata, '$.key')</code> - Extract value</li>
    <li><code>json_extract(metadata, '$.nested.key')</code> - Nested access</li>
    <li><code>json_extract(metadata, '$.array[0]')</code> - Array element</li>
    <li><code>CAST(json_extract(...) AS REAL)</code> - Type conversion</li>
    <li><code>json_extract(...) IS NOT NULL</code> - Check existence</li>
  </ul>
</div>`;

      const modal = document.getElementById('helpModal');
      document.querySelector('#helpModal .modal-body').innerHTML = schema;
      modal.classList.add('active');
    }

    function clearEditor() {
      document.getElementById('sql-editor').value = '';
      logToConsole('info', 'Editor cleared');
    }

    function saveQuery() {
      const query = document.getElementById('sql-editor').value.trim();
      if (!query) return;

      const name = prompt('Enter a name for this query:');
      if (!name) return;

      state.savedQueries.push({ name, query });
      updateSavedQueriesDropdown();

      logToConsole('success', `Query saved: ${name}`);
    }

    function loadSavedQuery(name) {
      const saved = state.savedQueries.find(q => q.name === name);
      if (saved) {
        document.getElementById('sql-editor').value = saved.query;
        logToConsole('info', `Loaded query: ${name}`);
      }
    }

    function updateSavedQueriesDropdown() {
      const select = document.getElementById('saved-queries');
      select.innerHTML = '<option value="">Load Saved Query...</option>';

      state.savedQueries.forEach(q => {
        const option = document.createElement('option');
        option.value = q.name;
        option.textContent = q.name;
        select.appendChild(option);
      });
    }

    function exportResults(format) {
      const results = []; // Would need to store last results
      logToConsole('info', `Exporting results as ${format.toUpperCase()}`);
      // Implementation would go here
    }

    // ============================================================================
    // DATA BROWSER
    // ============================================================================

    async function refreshTableList() {
      try {
        const tableList = sqlAll("SELECT name FROM sqlite_master WHERE type='table' ORDER BY name");

        const select = document.getElementById('table-select');
        select.innerHTML = '<option value="">Choose a table...</option>';

        tableList.forEach(table => {
          const option = document.createElement('option');
          option.value = table.name;
          option.textContent = table.name;
          select.appendChild(option);
        });

        document.getElementById('db-tables').textContent = tableList.length;

        logToConsole('info', `Found ${tableList.length} tables`);

      } catch (error) {
        logToConsole('error', `Failed to refresh table list: ${error.message}`);
      }
    }

    async function browseTable(tableName) {
      if (!tableName) return;

      logToConsole('info', `Browsing table: ${tableName}`);

      try {
        const data = sqlAll(`SELECT * FROM ${tableName} LIMIT 100`);

        const container = document.getElementById('browser-content');

        if (data.length === 0) {
          container.innerHTML = '<div class="empty-state"><div class="empty-state-icon"></div><div class="empty-state-title">Table is empty</div></div>';
          return;
        }

        // Build table
        const columns = Object.keys(data[0]);
        let html = '<table class="data-table"><thead><tr>';

        columns.forEach(col => {
          html += `<th>${col}</th>`;
        });
        html += '</tr></thead><tbody>';

        data.forEach(row => {
          html += '<tr>';
          columns.forEach(col => {
            let value = row[col];
            if (value === null) value = '<em style="color: var(--text-muted);">NULL</em>';
            else if (typeof value === 'object') value = JSON.stringify(value);
            else if (typeof value === 'string' && value.length > 100) value = value.substring(0, 100) + '...';
            html += `<td>${value}</td>`;
          });
          html += '</tr>';
        });

        html += '</tbody></table>';
        container.innerHTML = html;

        logToConsole('success', `Loaded ${data.length} rows from ${tableName}`);

      } catch (error) {
        logToConsole('error', `Failed to browse table: ${error.message}`);
      }
    }

    function filterBrowserData() {
      const search = document.getElementById('browser-search').value.toLowerCase();
      // Would implement filtering logic here
      logToConsole('info', `Filtering data: ${search}`);
    }

    // ============================================================================
    // PATTERN MANAGEMENT
    // ============================================================================

    function showAddPattern() {
      document.getElementById('addPatternModal').classList.add('active');
    }

    function closeAddPattern() {
      document.getElementById('addPatternModal').classList.remove('active');
    }

    async function savePattern() {
      const type = document.getElementById('pattern-type').value;
      const description = document.getElementById('pattern-description').value;
      const metadataStr = document.getElementById('pattern-metadata').value;

      if (!description) {
        alert('Please enter a pattern description');
        return;
      }

      try {
        const metadata = JSON.parse(metadataStr);

        // Generate embedding (simplified - in real app would use actual embedding model)
        const embedding = generateMockEmbedding(description);

        await state.db.storePattern({
          pattern_type: type,
          embedding: embedding,
          metadata: {
            ...metadata,
            description: description
          }
        });

        logToConsole('success', `Pattern stored: ${type}`);
        closeAddPattern();
        refreshPatterns();

      } catch (error) {
        logToConsole('error', `Failed to save pattern: ${error.message}`);
        alert('Failed to save pattern. Check console for details.');
      }
    }

    async function refreshPatterns() {
      logToConsole('info', 'Refreshing patterns...');

      try {
        const patterns = sqlAll('SELECT * FROM patterns ORDER BY created_at DESC LIMIT 50');

        const container = document.getElementById('patterns-list');

        if (patterns.length === 0) {
          container.innerHTML = '<div class="empty-state"><div class="empty-state-icon"></div><div class="empty-state-title">No patterns stored</div><div class="empty-state-text">Click "Add Pattern" to create one</div></div>';
          return;
        }

        let html = '';
        patterns.forEach(pattern => {
          const metadata = typeof pattern.metadata === 'string' ? JSON.parse(pattern.metadata) : pattern.metadata;
          html += `
            <div class="card">
              <div style="display: flex; justify-content: space-between; align-items: start;">
                <div style="flex: 1;">
                  <div style="font-weight: 600; margin-bottom: 0.5rem;">
                    <span class="status-badge info">${pattern.pattern_type}</span>
                  </div>
                  <div style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">
                    ${metadata.description || 'No description'}
                  </div>
                  <div style="font-size: 0.75rem; color: var(--text-muted);">
                    ID: ${pattern.id} | Created: ${new Date(pattern.created_at * 1000).toLocaleString()}
                  </div>
                </div>
                <button class="btn btn-secondary btn-sm" onclick="viewPattern(${pattern.id})">View</button>
              </div>
            </div>
          `;
        });

        container.innerHTML = html;
        logToConsole('success', `Loaded ${patterns.length} patterns`);

      } catch (error) {
        logToConsole('error', `Failed to refresh patterns: ${error.message}`);
      }
    }

    function viewPattern(id) {
      const pattern = sqlGet(`SELECT * FROM patterns WHERE id = ?`, [id]);
      logToConsole('info', 'Viewing pattern:', pattern);

      if (!pattern) {
        logToConsole('error', `Pattern with ID ${id} not found`);
        alert(`Pattern with ID ${id} not found. It may have been deleted.`);
        return;
      }

      try {
        const metadata = pattern.metadata ? JSON.parse(pattern.metadata) : {};
        alert(`Pattern ID: ${id}\n\nType: ${pattern.pattern_type}\n\nMetadata:\n${JSON.stringify(metadata, null, 2)}`);
      } catch (error) {
        logToConsole('error', `Failed to parse pattern metadata: ${error.message}`);
        alert(`Pattern ID: ${id}\n\nType: ${pattern.pattern_type}\n\nMetadata: [Invalid JSON]`);
      }
    }

    // ============================================================================
    // EPISODE MANAGEMENT
    // ============================================================================

    function showAddEpisode() {
      document.getElementById('addEpisodeModal').classList.add('active');
    }

    function closeAddEpisode() {
      document.getElementById('addEpisodeModal').classList.remove('active');
    }

    async function saveEpisode() {
      const task = document.getElementById('episode-task').value;
      const action = document.getElementById('episode-action').value;
      const reward = parseFloat(document.getElementById('episode-reward').value);
      const critique = document.getElementById('episode-critique').value;
      const metadataStr = document.getElementById('episode-metadata').value;

      if (!task || !action) {
        alert('Please enter task and action');
        return;
      }

      try {
        const metadata = JSON.parse(metadataStr);
        const embedding = generateMockEmbedding(task + ' ' + action);

        await state.db.storeEpisode({
          task: task,
          action: action,
          reward: reward,
          critique: critique,
          embedding: embedding,
          metadata: metadata
        });

        logToConsole('success', `Episode stored: ${task}`);
        closeAddEpisode();
        refreshEpisodes();

      } catch (error) {
        logToConsole('error', `Failed to save episode: ${error.message}`);
        alert('Failed to save episode. Check console for details.');
      }
    }

    // Episode view mode state
    let episodeViewMode = 'cards';
    let episodeFilters = {
      rewardMin: -1,
      rewardMax: 1,
      taskType: '',
      timePeriod: 'all',
      outcome: 'all'
    };

    async function refreshEpisodes() {
      logToConsole('info', 'Refreshing episodes and analytics...');

      try {
        // Try to get episodes with proper null handling
        let episodes = [];
        try {
          // Query episodes - let SQLite auto-generate IDs if they exist, otherwise use rowid
          episodes = sqlAll('SELECT * FROM episodes ORDER BY created_at DESC LIMIT 100') || [];

          // Add debugging to see what IDs we're getting
          if (episodes.length > 0) {
            logToConsole('info', `First episode ID: ${episodes[0].id}, rowid: ${episodes[0].rowid}, keys: ${Object.keys(episodes[0]).join(', ')}`);
          }

          // If episodes don't have an ID, add rowid as id
          episodes = episodes.map((ep, index) => {
            if (!ep.id && ep.rowid) {
              return { ...ep, id: ep.rowid };
            }
            // If no id or rowid, use index + 1
            if (!ep.id) {
              return { ...ep, id: index + 1 };
            }
            return ep;
          });
        } catch (sqlError) {
          // If episodes table doesn't exist or has wrong schema, create empty array
          logToConsole('warning', `Episodes query failed: ${sqlError.message}. Table may not exist yet.`);
          episodes = [];
        }

        if (!Array.isArray(episodes)) {
          episodes = [];
        }

        // Update analytics dashboard
        updateEpisodeAnalytics(episodes);

        // Filter episodes
        const filteredEpisodes = filterEpisodesData(episodes);

        // Render based on view mode
        renderEpisodesView(filteredEpisodes);

        logToConsole('success', `Loaded ${episodes.length} episodes (${filteredEpisodes.length} filtered)`);

      } catch (error) {
        logToConsole('error', `Failed to refresh episodes: ${error.message}`);
      }
    }

    function updateEpisodeAnalytics(episodes) {
      // Null safety check
      if (!episodes || !Array.isArray(episodes) || episodes.length === 0) {
        const safeSet = (id, value) => {
          const el = document.getElementById(id);
          if (el) el.textContent = value;
        };
        safeSet('total-episodes', '0');
        safeSet('success-rate', '0%');
        safeSet('avg-reward', '0.00');
        safeSet('top-strategy', '--');
        safeSet('strategy-count', '--');
        return;
      }

      // Calculate statistics with null safety
      const totalEpisodes = episodes.length;
      const successCount = episodes.filter(e => e && e.reward && e.reward > 0.5).length;
      const successRate = totalEpisodes > 0 ? (successCount / totalEpisodes * 100).toFixed(1) : '0.0';
      const rewardSum = episodes.reduce((sum, e) => sum + (e && typeof e.reward === 'number' ? e.reward : 0), 0);
      const avgReward = totalEpisodes > 0 ? (rewardSum / totalEpisodes).toFixed(2) : '0.00';

      // Find top strategy (most common task pattern)
      const taskCounts = {};
      episodes.forEach(e => {
        if (e && e.task) {
          const taskType = extractTaskType(e.task);
          taskCounts[taskType] = (taskCounts[taskType] || 0) + 1;
        }
      });

      const entries = Object.entries(taskCounts);
      const topStrategy = entries.length > 0 ? entries.sort((a, b) => b[1] - a[1])[0] : null;

      // Update UI with null safety
      const safeSet = (id, value) => {
        const el = document.getElementById(id);
        if (el) el.textContent = value;
      };

      safeSet('total-episodes', totalEpisodes);
      safeSet('success-rate', successRate + '%');
      safeSet('avg-reward', avgReward);
      safeSet('top-strategy', topStrategy ? topStrategy[0] : '--');
      safeSet('strategy-count', topStrategy ? `${topStrategy[1]} episodes` : '--');

      // Calculate trends (compare last 20% vs previous 20%)
      const recent = episodes.slice(0, Math.floor(episodes.length * 0.2));
      const previous = episodes.slice(Math.floor(episodes.length * 0.2), Math.floor(episodes.length * 0.4));

      if (previous.length > 0 && recent.length > 0) {
        const recentSum = recent.reduce((sum, e) => sum + (e && typeof e.reward === 'number' ? e.reward : 0), 0);
        const prevSum = previous.reduce((sum, e) => sum + (e && typeof e.reward === 'number' ? e.reward : 0), 0);
        const recentAvg = recent.length > 0 ? recentSum / recent.length : 0;
        const prevAvg = previous.length > 0 ? prevSum / previous.length : 0;
        const trend = prevAvg !== 0 ? ((recentAvg - prevAvg) / Math.abs(prevAvg) * 100).toFixed(1) : '0.0';

        const trendEl = document.getElementById('reward-trend');
        if (trendEl) {
          trendEl.textContent = trend > 0 ? ` +${trend}%` : ` ${trend}%`;
          trendEl.className = `stat-card-trend ${trend > 0 ? 'positive' : 'negative'}`;
        }
      }

      // Update reward histogram
      renderRewardHistogram(episodes);

      // Update reward trend chart
      renderRewardTrendChart(episodes.slice(0, 20).reverse());
    }

    function renderRewardHistogram(episodes) {
      const histogram = document.getElementById('reward-histogram');
      const bins = 10;
      const buckets = new Array(bins).fill(0);

      episodes.forEach(e => {
        const binIndex = Math.min(Math.floor((e.reward + 1) / 2 * bins), bins - 1);
        buckets[binIndex]++;
      });

      const maxCount = Math.max(...buckets, 1);

      let html = '';
      buckets.forEach((count, i) => {
        const height = (count / maxCount * 100);
        const range = `${(-1 + i * 0.2).toFixed(1)} to ${(-1 + (i + 1) * 0.2).toFixed(1)}`;
        html += `<div class="histogram-bar" style="height: ${height}%" data-count="${count} (${range})" title="${count} episodes"></div>`;
      });

      histogram.innerHTML = html;
    }

    function renderRewardTrendChart(episodes) {
      const canvas = document.getElementById('reward-trend-chart');
      const ctx = canvas.getContext('2d');

      // Set canvas size
      canvas.width = canvas.offsetWidth;
      canvas.height = 60;

      const width = canvas.width;
      const height = canvas.height;

      // Clear canvas
      ctx.clearRect(0, 0, width, height);

      if (episodes.length < 2) return;

      // Calculate scaling
      const xScale = width / (episodes.length - 1);
      const yMin = -1;
      const yMax = 1;
      const yScale = height / (yMax - yMin);

      // Draw grid lines
      ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
      ctx.lineWidth = 1;
      [0].forEach(y => {
        const yPos = height - (y - yMin) * yScale;
        ctx.beginPath();
        ctx.moveTo(0, yPos);
        ctx.lineTo(width, yPos);
        ctx.stroke();
      });

      // Draw trend line
      ctx.strokeStyle = 'hsl(142, 76%, 50%)';
      ctx.lineWidth = 2;
      ctx.beginPath();

      episodes.forEach((episode, i) => {
        const x = i * xScale;
        const y = height - (episode.reward - yMin) * yScale;

        if (i === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
      });

      ctx.stroke();

      // Draw points
      ctx.fillStyle = 'hsl(142, 76%, 50%)';
      episodes.forEach((episode, i) => {
        const x = i * xScale;
        const y = height - (episode.reward - yMin) * yScale;

        ctx.beginPath();
        ctx.arc(x, y, 3, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function extractTaskType(task) {
      if (!task) return 'custom';
      const lower = task.toLowerCase();
      if (lower.includes('code') || lower.includes('implement')) return 'coding';
      if (lower.includes('analyz') || lower.includes('review')) return 'analysis';
      if (lower.includes('optim') || lower.includes('improve')) return 'optimization';
      if (lower.includes('test')) return 'testing';
      return 'custom';
    }

    function filterEpisodesData(episodes) {
      return episodes.filter(e => {
        // Reward range filter
        if (e.reward < episodeFilters.rewardMin || e.reward > episodeFilters.rewardMax) {
          return false;
        }

        // Task type filter
        if (episodeFilters.taskType && extractTaskType(e.task) !== episodeFilters.taskType) {
          return false;
        }

        // Time period filter
        if (episodeFilters.timePeriod !== 'all') {
          const episodeDate = new Date(e.created_at);
          const now = new Date();
          const hoursDiff = (now - episodeDate) / (1000 * 60 * 60);

          if (episodeFilters.timePeriod === '1h' && hoursDiff > 1) return false;
          if (episodeFilters.timePeriod === '1d' && hoursDiff > 24) return false;
          if (episodeFilters.timePeriod === '1w' && hoursDiff > 168) return false;
          if (episodeFilters.timePeriod === '1m' && hoursDiff > 720) return false;
        }

        // Outcome filter
        if (episodeFilters.outcome === 'success' && e.reward <= 0.5) return false;
        if (episodeFilters.outcome === 'failure' && e.reward >= 0) return false;
        if (episodeFilters.outcome === 'neutral' && (e.reward < 0 || e.reward > 0.5)) return false;

        return true;
      });
    }

    function renderEpisodesView(episodes) {
      const container = document.getElementById('episodes-list');

      if (episodes.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-state-icon"></div><div class="empty-state-title">No episodes match filters</div><div class="empty-state-text">Try adjusting your filters or add new episodes</div></div>';
        return;
      }

      switch (episodeViewMode) {
        case 'cards':
          renderCardsView(episodes, container);
          break;
        case 'table':
          renderTableView(episodes, container);
          break;
        case 'timeline':
          renderTimelineView(episodes, container);
          break;
        case 'trajectories':
          renderTrajectoriesView(episodes, container);
          break;
      }
    }

    function renderCardsView(episodes, container) {
      let html = '';
      episodes.forEach(episode => {
        const rewardClass = episode.reward > 0.5 ? 'reward-high' : episode.reward >= 0 ? 'reward-medium' : 'reward-low';
        const rewardBadge = episode.reward > 0.5 ? 'success' : episode.reward >= 0 ? 'warning' : 'danger';
        const taskType = extractTaskType(episode.task);
        const sentiment = analyzeSentiment(episode.critique || '');

        const rewardValue = typeof episode.reward === 'number' ? episode.reward.toFixed(2) : 'N/A';

        html += `
          <div class="episode-card ${rewardClass}">
            <div class="episode-header">
              <div style="flex: 1;">
                <div class="episode-title">${episode.task || 'Unknown Task'}</div>
                <div style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.25rem;">
                  ${episode.action || 'No action'}
                </div>
                <div class="episode-badges">
                  <span class="episode-badge ${rewardBadge}"> ${rewardValue}</span>
                  <span class="episode-badge"> ${taskType}</span>
                  <span class="episode-badge"> ID: ${episode.id}</span>
                  ${sentiment ? `<span class="episode-badge">${sentiment}</span>` : ''}
                </div>
              </div>
            </div>

            ${episode.critique ? `<div style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 0.75rem; padding: 0.75rem; background: var(--bg-primary); border-radius: 4px; border-left: 3px solid var(--accent);"> ${truncate(episode.critique, 150)}</div>` : ''}

            <div class="episode-actions">
              <button class="episode-action-btn" onclick="viewEpisode(${episode.id})"> View Full</button>
              <button class="episode-action-btn" onclick="replayEpisode(${episode.id})"> Replay</button>
              <button class="episode-action-btn" onclick="cloneEpisode(${episode.id})"> Clone</button>
              <button class="episode-action-btn" onclick="showEpisodeTrajectory(${episode.id})"> Trajectory</button>
              <button class="episode-action-btn" onclick="annotateEpisode(${episode.id})"> Annotate</button>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function renderTableView(episodes, container) {
      let html = `
        <table style="width: 100%; border-collapse: collapse;">
          <thead style="background: var(--bg-tertiary); position: sticky; top: 0;">
            <tr>
              <th style="padding: 0.75rem; text-align: left; border-bottom: 2px solid var(--border-color);">ID</th>
              <th style="padding: 0.75rem; text-align: left; border-bottom: 2px solid var(--border-color);">Task</th>
              <th style="padding: 0.75rem; text-align: left; border-bottom: 2px solid var(--border-color);">Type</th>
              <th style="padding: 0.75rem; text-align: right; border-bottom: 2px solid var(--border-color);">Reward</th>
              <th style="padding: 0.75rem; text-align: center; border-bottom: 2px solid var(--border-color);">Date</th>
              <th style="padding: 0.75rem; text-align: center; border-bottom: 2px solid var(--border-color);">Actions</th>
            </tr>
          </thead>
          <tbody>
      `;

      episodes.forEach(episode => {
        const taskType = extractTaskType(episode.task);
        const reward = typeof episode.reward === 'number' ? episode.reward : 0;
        const rewardColor = reward > 0.5 ? 'var(--success)' : reward >= 0 ? 'var(--warning)' : 'var(--danger)';
        const rewardValue = typeof episode.reward === 'number' ? episode.reward.toFixed(2) : 'N/A';
        const date = episode.created_at ? new Date(episode.created_at).toLocaleString() : 'Unknown';

        html += `
          <tr style="border-bottom: 1px solid var(--border-color); transition: background 0.2s;" onmouseover="this.style.background='var(--bg-tertiary)'" onmouseout="this.style.background='transparent'">
            <td style="padding: 0.75rem;">${episode.id}</td>
            <td style="padding: 0.75rem;">${truncate(episode.task || 'Unknown', 50)}</td>
            <td style="padding: 0.75rem;"><span class="episode-badge">${taskType}</span></td>
            <td style="padding: 0.75rem; text-align: right; font-weight: 600; color: ${rewardColor};">${rewardValue}</td>
            <td style="padding: 0.75rem; text-align: center; font-size: 0.8rem; color: var(--text-muted);">${date}</td>
            <td style="padding: 0.75rem; text-align: center;">
              <button class="episode-action-btn" onclick="viewEpisode(${episode.id})">View</button>
            </td>
          </tr>
        `;
      });

      html += '</tbody></table>';
      container.innerHTML = html;
    }

    function renderTimelineView(episodes, container) {
      let html = '<div class="timeline-container"><div class="timeline-line"></div>';

      episodes.forEach(episode => {
        const reward = typeof episode.reward === 'number' ? episode.reward : 0;
        const statusClass = reward > 0.5 ? 'success' : reward < 0 ? 'failure' : '';
        const date = episode.created_at ? new Date(episode.created_at).toLocaleString() : 'Unknown';
        const rewardValue = typeof episode.reward === 'number' ? episode.reward.toFixed(2) : 'N/A';
        const rewardBadge = reward > 0.5 ? 'success' : reward >= 0 ? 'warning' : 'danger';

        html += `
          <div class="timeline-item ${statusClass}">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
              <div>
                <div style="font-weight: 600; margin-bottom: 0.25rem;">${episode.task || 'Unknown'}</div>
                <div style="font-size: 0.75rem; color: var(--text-muted);">${date}</div>
              </div>
              <span class="episode-badge ${rewardBadge}">
                ${rewardValue}
              </span>
            </div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">${truncate(episode.action || 'No action', 100)}</div>
            <div style="margin-top: 0.5rem;">
              <button class="episode-action-btn" onclick="viewEpisode(${episode.id})">View Details</button>
            </div>
          </div>
        `;
      });

      html += '</div>';
      container.innerHTML = html;
    }

    function renderTrajectoriesView(episodes, container) {
      let html = '<div style="display: grid; gap: 1rem;">';

      // Group episodes by task type
      const grouped = {};
      episodes.forEach(e => {
        const type = extractTaskType(e.task);
        if (!grouped[type]) grouped[type] = [];
        grouped[type].push(e);
      });

      Object.entries(grouped).forEach(([type, eps]) => {
        const rewardSum = eps.reduce((s, e) => s + (typeof e.reward === 'number' ? e.reward : 0), 0);
        const avgReward = eps.length > 0 ? (rewardSum / eps.length).toFixed(2) : '0.00';

        html += `
          <div class="trajectory-container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
              <div>
                <div style="font-weight: 600; margin-bottom: 0.25rem;">${type.charAt(0).toUpperCase() + type.slice(1)} Tasks</div>
                <div style="font-size: 0.75rem; color: var(--text-muted);">${eps.length} episodes</div>
              </div>
              <div style="text-align: right;">
                <div style="font-size: 0.75rem; color: var(--text-secondary);">Avg Reward</div>
                <div style="font-weight: 600; color: var(--accent);">${avgReward}</div>
              </div>
            </div>
            <svg class="trajectory-chart" viewBox="0 0 400 150" preserveAspectRatio="none">
              ${renderTrajectoryPath(eps.slice(0, 20))}
            </svg>
          </div>
        `;
      });

      html += '</div>';
      container.innerHTML = html;
    }

    function renderTrajectoryPath(episodes) {
      if (episodes.length < 2) return '';

      const width = 400;
      const height = 150;
      const padding = 10;

      const xScale = (width - 2 * padding) / (episodes.length - 1);
      const yScale = (height - 2 * padding) / 2;

      let path = 'M';
      let points = '';

      episodes.forEach((episode, i) => {
        const reward = typeof episode.reward === 'number' ? episode.reward : 0;
        const x = padding + i * xScale;
        const y = height / 2 - reward * yScale;

        if (i === 0) {
          path += `${x},${y}`;
        } else {
          path += ` L${x},${y}`;
        }

        const rewardText = typeof episode.reward === 'number' ? episode.reward.toFixed(2) : 'N/A';
        points += `<circle class="trajectory-point" cx="${x}" cy="${y}" r="4" data-episode="${episode.id}"><title>Reward: ${rewardText}</title></circle>`;
      });

      return `<path class="trajectory-path" d="${path}" />${points}`;
    }

    function analyzeSentiment(text) {
      if (!text) return '';
      const lower = text.toLowerCase();
      if (lower.includes('excellent') || lower.includes('great') || lower.includes('perfect')) return ' Positive';
      if (lower.includes('poor') || lower.includes('failed') || lower.includes('bad')) return ' Negative';
      if (lower.includes('good') || lower.includes('okay')) return ' Neutral';
      return '';
    }

    function truncate(str, length) {
      return str.length > length ? str.substring(0, length) + '...' : str;
    }

    function viewEpisode(id) {
      try {
        console.log('[DEBUG] viewEpisode called with ID:', id, 'type:', typeof id);

        // Convert ID to integer to avoid datatype mismatch
        const episodeId = parseInt(id, 10);

        // Get all episodes and find by ID in JavaScript to avoid SQL parameter issues
        const allEpisodes = sqlAll(`SELECT rowid as id, * FROM episodes`);
        console.log('[DEBUG] All episodes:', allEpisodes);

        // Find episode by matching ID
        let episode = allEpisodes.find(ep => ep.id === episodeId || ep.rowid === episodeId);
        console.log('[DEBUG] Found episode:', episode);

        if (!episode) {
          alert(`Episode with ID ${id} not found`);
          logToConsole('warning', `Episode ${id} not found. Available IDs: ${allEpisodes.map(e => e.id).join(', ')}`);
          return;
        }

        logToConsole('info', 'Viewing episode:', episode);

        const rewardValue = typeof episode.reward === 'number' ? episode.reward.toFixed(2) : 'N/A';
        const task = episode.task || 'Unknown Task';
        const action = episode.action || 'No action';
        const critique = episode.critique || 'None';

        alert(`Episode ID: ${episode.id}\n\nTask: ${task}\nAction: ${action}\nReward: ${rewardValue}\n\nCritique:\n${critique}`);
      } catch (error) {
        logToConsole('error', `Failed to view episode ${id}: ${error.message}`);
        console.error('[DEBUG] Full error:', error);
        alert(`Error viewing episode: ${error.message}`);
      }
    }

    // Episode Action Functions
    function setEpisodeViewMode(mode) {
      episodeViewMode = mode;

      // Update button states
      document.querySelectorAll('.view-mode-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.mode === mode) {
          btn.classList.add('active');
        }
      });

      refreshEpisodes();
    }

    function applyEpisodeFilters() {
      episodeFilters.rewardMin = parseFloat(document.getElementById('reward-min').value) || -1;
      episodeFilters.rewardMax = parseFloat(document.getElementById('reward-max').value) || 1;
      episodeFilters.taskType = document.getElementById('task-type-filter').value;
      episodeFilters.timePeriod = document.getElementById('time-period-filter').value;
      episodeFilters.outcome = document.getElementById('outcome-filter').value;

      refreshEpisodes();
      logToConsole('info', 'Applied episode filters', episodeFilters);
    }

    function resetEpisodeFilters() {
      episodeFilters = {
        rewardMin: -1,
        rewardMax: 1,
        taskType: '',
        timePeriod: 'all',
        outcome: 'all'
      };

      document.getElementById('reward-min').value = -1;
      document.getElementById('reward-max').value = 1;
      document.getElementById('task-type-filter').value = '';
      document.getElementById('time-period-filter').value = 'all';
      document.getElementById('outcome-filter').value = 'all';

      refreshEpisodes();
      logToConsole('info', 'Reset episode filters');
    }

    function saveFilterPreset() {
      const presetName = prompt('Enter preset name:');
      if (presetName) {
        localStorage.setItem(`episode-filter-${presetName}`, JSON.stringify(episodeFilters));
        logToConsole('success', `Saved filter preset: ${presetName}`);
      }
    }

    function replayEpisode(id) {
      try {
        const episodeId = parseInt(id, 10);
        const allEpisodes = sqlAll(`SELECT rowid as id, * FROM episodes`);
        const episode = allEpisodes.find(ep => ep.id === episodeId || ep.rowid === episodeId);

        if (!episode) {
          alert(`Episode with ID ${id} not found`);
          logToConsole('warning', `Episode ${id} not found`);
          return;
        }

        logToConsole('info', `Replaying episode ${id}...`);

        const rewardValue = typeof episode.reward === 'number' ? episode.reward.toFixed(2) : 'N/A';
        const task = episode.task || 'Unknown Task';
        const action = episode.action || 'No action';
        const critique = episode.critique || 'None';

        alert(` Replay Episode ${id}\n\nTask: ${task}\nAction: ${action}\n\nThis would show the full execution trajectory:\n1. Initial state\n2. Action sequence\n3. Intermediate results\n4. Final reward: ${rewardValue}\n\nCritique: ${critique}`);
      } catch (error) {
        logToConsole('error', `Failed to replay episode ${id}: ${error.message}`);
        alert(`Error replaying episode: ${error.message}`);
      }
    }

    function cloneEpisode(id) {
      try {
        const episodeId = parseInt(id, 10);
        const allEpisodes = sqlAll(`SELECT rowid as id, * FROM episodes`);
        const episode = allEpisodes.find(ep => ep.id === episodeId || ep.rowid === episodeId);

        if (!episode) {
          alert(`Episode with ID ${id} not found`);
          logToConsole('warning', `Episode ${id} not found`);
          return;
        }

        // Pre-fill the add episode modal with cloned data
        document.getElementById('episode-task').value = `Clone: ${episode.task || 'Unknown'}`;
        document.getElementById('episode-action').value = episode.action || '';
        document.getElementById('episode-reward').value = 0;
        document.getElementById('episode-critique').value = '';

        showAddEpisode();
        logToConsole('info', `Cloned episode ${id} to new episode form`);
      } catch (error) {
        logToConsole('error', `Failed to clone episode ${id}: ${error.message}`);
        alert(`Error cloning episode: ${error.message}`);
      }
    }

    function showEpisodeTrajectory(id) {
      try {
        const episodeId = parseInt(id, 10);
        const allEpisodes = sqlAll(`SELECT rowid as id, * FROM episodes`);
        const episode = allEpisodes.find(ep => ep.id === episodeId || ep.rowid === episodeId);

        if (!episode) {
          alert(`Episode with ID ${id} not found`);
          logToConsole('warning', `Episode ${id} not found`);
          return;
        }

        logToConsole('info', `Showing trajectory for episode ${id}`);

        const rewardValue = typeof episode.reward === 'number' ? episode.reward.toFixed(2) : 'N/A';
        const task = episode.task || 'Unknown Task';
        const action = episode.action || 'No action';

        alert(` Episode Trajectory\n\nEpisode: ${task}\n\nTrajectory Analysis:\n- Start State: Initial\n- Actions Taken: ${action}\n- Reward Progress: 0.0  ${rewardValue}\n- Decision Points: 3\n- Alternative Paths: 2\n\nThis would show:\n Interactive timeline\n Reward progression graph\n Decision tree visualization\n Alternative path exploration`);
      } catch (error) {
        logToConsole('error', `Failed to show trajectory for episode ${id}: ${error.message}`);
        alert(`Error showing trajectory: ${error.message}`);
      }
    }

    function annotateEpisode(id) {
      const annotation = prompt('Add annotation for this episode:');
      if (annotation) {
        try {
          const episodeId = parseInt(id, 10);
          const allEpisodes = sqlAll(`SELECT rowid as id, * FROM episodes`);
          const episode = allEpisodes.find(ep => ep.id === episodeId || ep.rowid === episodeId);

          if (!episode) {
            alert(`Episode with ID ${id} not found`);
            logToConsole('warning', `Episode ${id} not found`);
            return;
          }

          logToConsole('info', `Added annotation to episode ${id}: ${annotation}`);
          const metadata = JSON.parse(episode.metadata || '{}');
          metadata.annotations = metadata.annotations || [];
          metadata.annotations.push({
            text: annotation,
            timestamp: new Date().toISOString(),
            user: 'current-user'
          });

          // Update would happen here
          alert(` Annotation added successfully!\n\n"${annotation}"`);
        } catch (error) {
          logToConsole('error', `Failed to annotate episode ${id}: ${error.message}`);
          alert(`Error adding annotation: ${error.message}`);
        }
      }
    }

    function showEpisodeTemplates() {
      const templates = [
        { name: 'High Success Coding', type: 'coding', avgReward: 0.85, count: 15 },
        { name: 'Optimization Strategy', type: 'optimization', avgReward: 0.78, count: 12 },
        { name: 'Analysis Pattern', type: 'analysis', avgReward: 0.72, count: 10 },
        { name: 'Testing Approach', type: 'testing', avgReward: 0.68, count: 8 }
      ];

      let message = ' Episode Templates\n\nSaved templates based on successful episodes:\n\n';
      templates.forEach((t, i) => {
        message += `${i + 1}. ${t.name}\n   Type: ${t.type} | Avg Reward: ${t.avgReward} | ${t.count} episodes\n\n`;
      });
      message += 'Select a template to create similar episodes with proven strategies.';

      alert(message);
      logToConsole('info', 'Showing episode templates');
    }

    function showCompareEpisodes() {
      let episodes;

      try {
        episodes = sqlAll('SELECT * FROM episodes ORDER BY reward DESC LIMIT 10');
      } catch (error) {
        alert(' Unable to compare episodes\n\nPlease load sample data first using the "$ load-sample-data" button on the dashboard.\n\nError: ' + error.message);
        logToConsole('error', 'Failed to compare episodes', { error: error.message });
        return;
      }

      if (episodes.length < 2) {
        alert('Need at least 2 episodes to compare.\n\nPlease generate more sample data first.');
        return;
      }

      let message = ' Episode Comparison\n\nTop Episodes by Reward:\n\n';
      episodes.slice(0, 5).forEach((e, i) => {
        const reward = typeof e.reward === 'number' ? e.reward.toFixed(2) : 'N/A';
        message += `${i + 1}. [${reward}] ${truncate(e.task || 'Unknown', 40)}\n`;
      });

      message += '\n\nComparison Analysis:\n';
      const minReward = typeof episodes[episodes.length - 1]?.reward === 'number' ? episodes[episodes.length - 1].reward.toFixed(2) : 'N/A';
      const maxReward = typeof episodes[0]?.reward === 'number' ? episodes[0].reward.toFixed(2) : 'N/A';
      const rewardSum = episodes.reduce((s, e) => s + (typeof e.reward === 'number' ? e.reward : 0), 0);
      const avgReward = episodes.length > 0 ? (rewardSum / episodes.length).toFixed(2) : '0.00';
      message += ` Reward Range: ${minReward} to ${maxReward}\n`;
      message += ` Average: ${avgReward}\n`;
      message += ` Best Strategy: ${extractTaskType(episodes[0]?.task)}\n`;

      alert(message);
      logToConsole('info', 'Comparing episodes');
    }

    function showLearningInsights() {
      const episodes = sqlAll('SELECT * FROM episodes ORDER BY created_at DESC LIMIT 50');

      if (episodes.length === 0) {
        alert('No episodes available for insights');
        return;
      }

      // Analyze patterns with null safety
      const successEpisodes = episodes.filter(e => e && typeof e.reward === 'number' && e.reward > 0.5);
      const failureEpisodes = episodes.filter(e => e && typeof e.reward === 'number' && e.reward < 0);

      // Task type analysis
      const typeSuccessRate = {};
      ['coding', 'analysis', 'optimization', 'testing', 'custom'].forEach(type => {
        const typeEpisodes = episodes.filter(e => e && e.task && extractTaskType(e.task) === type);
        const typeSuccess = typeEpisodes.filter(e => typeof e.reward === 'number' && e.reward > 0.5).length;
        if (typeEpisodes.length > 0) {
          typeSuccessRate[type] = (typeSuccess / typeEpisodes.length * 100).toFixed(1);
        }
      });

      // Build insights message
      let message = ' Learning Insights\n\n';
      message += ' Success Patterns:\n';

      if (successEpisodes.length > 0) {
        const topType = Object.entries(typeSuccessRate).sort((a, b) => b[1] - a[1])[0];
        message += ` ${topType[0]} tasks have ${topType[1]}% success rate\n`;
        message += ` ${successEpisodes.length} successful episodes (${(successEpisodes.length/episodes.length*100).toFixed(1)}%)\n`;
        const successRewardSum = successEpisodes.reduce((s, e) => s + (typeof e.reward === 'number' ? e.reward : 0), 0);
        const avgSuccessReward = successEpisodes.length > 0 ? (successRewardSum / successEpisodes.length).toFixed(2) : '0.00';
        message += ` Avg successful reward: ${avgSuccessReward}\n`;
      }

      message += '\n Failure Patterns:\n';
      if (failureEpisodes.length > 0) {
        message += ` ${failureEpisodes.length} failed episodes\n`;
        message += ` Common failure types: Need more data analysis\n`;
      } else {
        message += ' No failures detected - great job!\n';
      }

      message += '\n Recommendations:\n';
      const sortedTypes = Object.entries(typeSuccessRate).sort((a,b) => b[1]-a[1]);
      if (sortedTypes.length > 0) {
        message += ` Focus on ${sortedTypes[0][0]} tasks\n`;
        message += ` Experiment with low-performing task types\n`;
      } else {
        message += ` Generate more episodes to get task-specific recommendations\n`;
      }
      message += ` Track critique patterns for improvements\n`;

      alert(message);
      logToConsole('info', 'Generated learning insights', { successEpisodes: successEpisodes.length, failureEpisodes: failureEpisodes.length });
    }

    // ============================================================================
    // CAUSAL GRAPH
    // ============================================================================

    function showAddCausalEdge() {
      document.getElementById('addCausalEdgeModal').classList.add('active');
    }

    function closeAddCausalEdge() {
      document.getElementById('addCausalEdgeModal').classList.remove('active');
    }

    async function saveCausalEdge() {
      const cause = document.getElementById('causal-cause').value;
      const effect = document.getElementById('causal-effect').value;
      const weight = parseFloat(document.getElementById('causal-weight').value);
      const metadataStr = document.getElementById('causal-metadata').value;

      if (!cause || !effect) {
        alert('Please enter cause and effect');
        return;
      }

      try {
        const metadata = JSON.parse(metadataStr);

        // Store weight in metadata since AgentDB v1.3.9 schema stores it there
        metadata.weight = weight;

        await state.db.addCausalEdge({
          cause: cause,
          effect: effect,
          metadata: metadata
        });

        logToConsole('success', `Causal edge added: ${cause}  ${effect} (weight: ${weight})`);
        closeAddCausalEdge();
        refreshCausalGraph();

      } catch (error) {
        logToConsole('error', `Failed to save causal edge: ${error.message}`);
        alert('Failed to save causal edge. Check console for details.');
      }
    }

    async function refreshCausalGraph() {
      logToConsole('info', 'Refreshing causal graph...');

      try {
        // Check if table exists first
        const tableExists = sqlAll("SELECT name FROM sqlite_master WHERE type='table' AND name='causal_edges'");
        if (tableExists.length === 0) {
          const container = document.getElementById('causal-graph-viz');
          container.innerHTML = '<div class="empty-state"><div class="empty-state-icon"></div><div class="empty-state-title">No causal relationships</div><div class="empty-state-text">Table not yet created. Add your first causal edge to get started.</div></div>';
          return;
        }

        const edges = sqlAll('SELECT * FROM causal_edges ORDER BY created_at DESC LIMIT 50');

        const container = document.getElementById('causal-graph-viz');

        if (edges.length === 0) {
          container.innerHTML = '<div class="empty-state"><div class="empty-state-icon"></div><div class="empty-state-title">No causal relationships</div><div class="empty-state-text">Click "Add Edge" to create one</div></div>';
          return;
        }

        let html = '<div style="display: grid; gap: 0.75rem;">';
        edges.forEach(edge => {
          // Parse metadata if it's a string
          const metadata = typeof edge.metadata === 'string' ? JSON.parse(edge.metadata || '{}') : (edge.metadata || {});
          const weight = metadata.weight || 0.5;
          const strength = (weight * 100).toFixed(0);
          const confidence = metadata.confidence ? ` (${(metadata.confidence * 100).toFixed(0)}% confident)` : '';

          html += `
            <div class="card" style="padding: 1rem;">
              <div style="display: flex; align-items: center; gap: 1rem;">
                <div style="flex: 1;">
                  <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                    <span style="font-weight: 600;">${edge.cause || 'Unknown'}</span>
                    <span style="color: var(--accent);"></span>
                    <span style="font-weight: 600;">${edge.effect || 'Unknown'}</span>
                  </div>
                  <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.5rem;">
                    ID: ${edge.id}${confidence}
                  </div>
                  <div class="stat-bar" style="margin-bottom: 0;">
                    <div class="stat-label" style="min-width: 80px;">Strength</div>
                    <div class="stat-value">
                      <div class="stat-fill" style="width: ${strength}%;">
                        <span class="stat-text">${strength}%</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `;
        });
        html += '</div>';

        container.innerHTML = html;
        logToConsole('success', `Loaded ${edges.length} causal edges`);

      } catch (error) {
        logToConsole('error', `Failed to refresh causal graph: ${error.message}`);
      }
    }

    // ============================================================================
    // VECTOR SEARCH
    // ============================================================================

    async function performVectorSearch() {
      const query = document.getElementById('vector-query').value.trim();
      const limit = parseInt(document.getElementById('vector-limit').value);

      if (!query) {
        alert('Please enter a search query');
        return;
      }

      logToConsole('info', `Performing vector search: "${query}" (limit: ${limit})`);

      try {
        const embedding = generateMockEmbedding(query);
        const results = state.db.searchSimilar(embedding, limit);

        const container = document.getElementById('vector-results');

        if (results.length === 0) {
          container.innerHTML = '<div class="empty-state"><div class="empty-state-icon"></div><div class="empty-state-title">No similar vectors found</div></div>';
          return;
        }

        let html = '<div style="display: grid; gap: 0.75rem;">';
        results.forEach((result, index) => {
          const similarity = ((1 - result.distance) * 100).toFixed(1);
          const metadata = typeof result.metadata === 'string' ? JSON.parse(result.metadata) : result.metadata;

          html += `
            <div class="card">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                <div style="font-weight: 600;">Result ${index + 1}</div>
                <span class="status-badge success">${similarity}% match</span>
              </div>
              <div style="color: var(--text-secondary); font-size: 0.875rem;">
                ${metadata.description || JSON.stringify(metadata).substring(0, 100)}
              </div>
              <div class="stat-bar" style="margin-top: 0.75rem; margin-bottom: 0;">
                <div class="stat-label" style="min-width: 80px;">Similarity</div>
                <div class="stat-value">
                  <div class="stat-fill" style="width: ${similarity}%;">
                    <span class="stat-text">${similarity}%</span>
                  </div>
                </div>
              </div>
            </div>
          `;
        });
        html += '</div>';

        container.innerHTML = html;
        logToConsole('success', `Found ${results.length} similar vectors`);

      } catch (error) {
        logToConsole('error', `Vector search failed: ${error.message}`);
      }
    }

    // ============================================================================
    // QUERY OPTIMIZER
    // ============================================================================

    async function analyzeQuery() {
      const query = document.getElementById('optimizer-query').value.trim();

      if (!query) {
        alert('Please enter a query to analyze');
        return;
      }

      logToConsole('info', 'Analyzing query for optimization...');

      // Perform EXPLAIN QUERY PLAN
      try {
        const plan = sqlAll(`EXPLAIN QUERY PLAN ${query}`);

        const suggestions = generateOptimizationSuggestions(query, plan);

        const container = document.getElementById('optimizer-results');

        let html = '<div class="card"><div class="card-title">Query Analysis</div>';

        // Query Plan
        html += '<h4 style="margin-top: 1rem; margin-bottom: 0.5rem; font-size: 0.875rem;">Execution Plan</h4>';
        html += '<div class="help-example"><pre>';
        plan.forEach(step => {
          html += `${step.detail}\n`;
        });
        html += '</pre></div>';

        // Suggestions
        html += '<h4 style="margin-top: 1rem; margin-bottom: 0.5rem; font-size: 0.875rem;">Optimization Suggestions</h4>';
        html += '<ul style="margin-left: 1.5rem; color: var(--text-secondary);">';
        suggestions.forEach(suggestion => {
          html += `<li style="margin-bottom: 0.5rem;">${suggestion}</li>`;
        });
        html += '</ul>';

        html += '</div>';

        container.innerHTML = html;
        logToConsole('success', 'Query analysis complete');

      } catch (error) {
        logToConsole('error', `Analysis failed: ${error.message}`);
      }
    }

    function generateOptimizationSuggestions(query, plan) {
      const suggestions = [];
      const queryLower = query.toLowerCase();

      // Check for missing indexes
      const scanningTable = plan.some(step => step.detail.includes('SCAN'));
      if (scanningTable) {
        suggestions.push(' Consider adding indexes on frequently queried columns to avoid table scans');
      }

      // Check for SELECT *
      if (queryLower.includes('select *')) {
        suggestions.push(' Avoid SELECT * - specify only needed columns for better performance');
      }

      // Check for missing LIMIT
      if (!queryLower.includes('limit') && queryLower.includes('select')) {
        suggestions.push(' Add LIMIT clause to prevent loading excessive rows');
      }

      // Check for JOINs
      if (queryLower.includes('join')) {
        suggestions.push(' Ensure JOIN columns are indexed for optimal performance');
      }

      // Check for subqueries
      if (queryLower.includes('select') && queryLower.split('select').length > 2) {
        suggestions.push(' Consider using JOINs instead of subqueries when possible');
      }

      if (suggestions.length === 0) {
        suggestions.push(' Query looks optimized! No major issues detected.');
      }

      return suggestions;
    }

    // ============================================================================
    // SCHEMA MANAGEMENT
    // ============================================================================

    async function refreshSchema() {
      logToConsole('info', 'Refreshing schema view...');

      try {
        const tables = sqlAll("SELECT name FROM sqlite_master WHERE type='table' ORDER BY name");

        let html = '<div class="schema-tree">';

        for (const table of tables) {
          // Get columns for this table
          const columns = sqlAll(`PRAGMA table_info(${table.name})`);

          html += `
            <div class="schema-table">
              <div class="schema-table-name">
                 ${table.name}
              </div>
              <div class="schema-columns">
          `;

          columns.forEach(col => {
            html += `<div class="schema-column">${col.name}: ${col.type}${col.pk ? ' (PK)' : ''}</div>`;
          });

          html += '</div></div>';
        }

        html += '</div>';

        document.getElementById('schema-view').innerHTML = html;

        // Update vector count
        try {
          const vectorCount = sqlGet('SELECT COUNT(*) as count FROM vectors');
          document.getElementById('db-vectors').textContent = vectorCount.count;
        } catch (e) {
          // vectors table might not exist
        }

      } catch (error) {
        logToConsole('error', `Failed to refresh schema: ${error.message}`);
      }
    }

    function showSchemaDesigner() {
      document.getElementById('schemaDesignerModal').classList.add('active');
    }

    function closeSchemaDesigner() {
      document.getElementById('schemaDesignerModal').classList.remove('active');
    }

    function previewSchema() {
      const tableName = document.getElementById('schema-table-name').value.trim();
      const columns = document.getElementById('schema-columns').value.trim();

      if (!tableName || !columns) {
        alert('Please enter table name and columns');
        return;
      }

      const sql = `CREATE TABLE IF NOT EXISTS ${tableName} (\n  ${columns.split('\n').join(',\n  ')}\n);`;

      document.getElementById('schema-sql').textContent = sql;
      document.getElementById('schema-preview').style.display = 'block';

      logToConsole('info', 'Schema preview generated');
    }

    async function createTableFromSchema() {
      const tableName = document.getElementById('schema-table-name').value.trim();
      const columns = document.getElementById('schema-columns').value.trim();

      if (!tableName || !columns) {
        alert('Please enter table name and columns');
        return;
      }

      const sql = `CREATE TABLE IF NOT EXISTS ${tableName} (\n  ${columns.split('\n').join(',\n  ')}\n);`;

      try {
        sqlRun(sql);
        logToConsole('success', `Table created: ${tableName}`);
        await refreshAll();
        closeSchemaDesigner();
      } catch (error) {
        logToConsole('error', `Failed to create table: ${error.message}`);
        alert('Failed to create table. Check console for details.');
      }
    }

    // ============================================================================
    // IMPORT/EXPORT
    // ============================================================================

    function showImportExport() {
      document.getElementById('importExportModal').classList.add('active');
    }

    function closeImportExport() {
      document.getElementById('importExportModal').classList.remove('active');
    }

    function switchImportExportTab(tab) {
      document.querySelectorAll('#importExportModal .tab-button').forEach(btn => {
        btn.classList.toggle('active', btn.textContent.toLowerCase() === tab);
      });
      document.querySelectorAll('#importExportModal .tab-content').forEach(content => {
        content.classList.toggle('active', content.id === `importexport-${tab}`);
      });
    }

    async function exportDatabase(format) {
      logToConsole('info', `Exporting database as ${format.toUpperCase()}...`);

      try {
        let data;
        let filename;
        let mimeType;

        if (format === 'json') {
          // Export all tables as JSON
          const tables = sqlAll("SELECT name FROM sqlite_master WHERE type='table'");
          data = {};

          for (const table of tables) {
            data[table.name] = sqlAll(`SELECT * FROM ${table.name}`);
          }

          filename = 'agentdb-export.json';
          mimeType = 'application/json';
          data = JSON.stringify(data, null, 2);

        } else if (format === 'sql') {
          // Export as SQL dump
          const tables = sqlAll("SELECT sql FROM sqlite_master WHERE type='table'");
          data = tables.map(t => t.sql + ';').join('\n\n');
          filename = 'agentdb-export.sql';
          mimeType = 'text/plain';

        } else if (format === 'csv') {
          // Export first table as CSV (simplified)
          const tables = sqlAll("SELECT name FROM sqlite_master WHERE type='table'");
          if (tables.length > 0) {
            const rows = sqlAll(`SELECT * FROM ${tables[0].name}`);
            if (rows.length > 0) {
              const headers = Object.keys(rows[0]);
              data = headers.join(',') + '\n';
              data += rows.map(row => headers.map(h => JSON.stringify(row[h])).join(',')).join('\n');
            }
          }
          filename = 'agentdb-export.csv';
          mimeType = 'text/csv';
        }

        downloadFile(filename, data, mimeType);
        logToConsole('success', `Database exported as ${format.toUpperCase()}`);

      } catch (error) {
        logToConsole('error', `Export failed: ${error.message}`);
      }
    }

    async function importDatabase() {
      const fileInput = document.getElementById('import-file');
      const file = fileInput.files[0];

      if (!file) {
        alert('Please select a file');
        return;
      }

      logToConsole('info', `Importing ${file.name}...`);

      const reader = new FileReader();
      reader.onload = async (e) => {
        try {
          const content = e.target.result;

          if (file.name.endsWith('.json')) {
            const data = JSON.parse(content);
            // Import logic here
            logToConsole('success', 'JSON import complete');
          } else if (file.name.endsWith('.sql')) {
            sqlRun(content);
            logToConsole('success', 'SQL import complete');
          }

          await refreshAll();

        } catch (error) {
          logToConsole('error', `Import failed: ${error.message}`);
        }
      };
      reader.readAsText(file);
    }

    // ============================================================================
    // HTML GENERATOR
    // ============================================================================

    async function generateHTML() {
      logToConsole('info', 'Generating standalone HTML configuration...');

      try {
        // Export current database state
        const tables = sqlAll("SELECT name FROM sqlite_master WHERE type='table'");
        const dbData = {};

        for (const table of tables) {
          dbData[table.name] = sqlAll(`SELECT * FROM ${table.name}`);
        }

        // Create standalone HTML with embedded data
        const html = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AgentDB Configuration Export</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 2rem;
      background: #0a0a0a;
      color: #f0f0f0;
    }
    h1 { color: #22c55e; }
    pre {
      background: #1a1a1a;
      padding: 1rem;
      border-radius: 8px;
      overflow-x: auto;
      border: 1px solid #2a2a2a;
    }
    .info {
      background: #1a2a1a;
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      border-left: 3px solid #22c55e;
    }
  </style>
</head>
<body>
  <h1> AgentDB Configuration Export</h1>

  <div class="info">
    <strong>Exported:</strong> ${new Date().toLocaleString()}<br>
    <strong>Tables:</strong> ${tables.length}<br>
    <strong>Settings:</strong> ${JSON.stringify(state.settings)}
  </div>

  <h2>Database Data</h2>
  <pre>${JSON.stringify(dbData, null, 2)}</pre>

  <h2>Import Instructions</h2>
  <ol>
    <li>Open AgentDB IDE</li>
    <li>Go to Import/Export</li>
    <li>Select this file to import</li>
  </ol>

  <script>
    // Embedded database data
    const EXPORTED_DATA = ${JSON.stringify(dbData)};
    const EXPORTED_SETTINGS = ${JSON.stringify(state.settings)};

    console.log('AgentDB Configuration loaded:', {
      tables: Object.keys(EXPORTED_DATA),
      settings: EXPORTED_SETTINGS
    });
  <\/script>

  <footer style="margin-top: 3rem; text-align: center; color: #666;">
    <p>Generated by <a href="https://agentdb.ruv.io" style="color: #22c55e;">AgentDB</a> Management IDE</p>
    <p style="font-size: 0.875rem;">
      <a href="https://agentdb.ruv.io" style="color: #22c55e;">AgentDB</a> |
      <a href="https://github.com/ruvnet/agentic-flow" style="color: #22c55e;">GitHub</a> |
      <a href="https://www.npmjs.com/package/agentdb" style="color: #22c55e;">NPM</a>
    </p>
  </footer>
</body>
</html>`;

        downloadFile('agentdb-config.html', html, 'text/html');
        logToConsole('success', 'Standalone HTML configuration generated and downloaded');

      } catch (error) {
        logToConsole('error', `HTML generation failed: ${error.message}`);
      }
    }

    // ============================================================================
    // SETTINGS
    // ============================================================================

    function showSettings() {
      document.getElementById('settingsModal').classList.add('active');
      loadSettingsToForm();
    }

    function closeSettings() {
      document.getElementById('settingsModal').classList.remove('active');
    }

    function switchSettingsTab(tab) {
      document.querySelectorAll('#settingsModal .tab-button').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('onclick').includes(tab));
      });
      document.querySelectorAll('#settingsModal .tab-content').forEach(content => {
        content.classList.toggle('active', content.id === `settings-${tab}`);
      });
    }

    function loadSettingsToForm() {
      document.getElementById('setting-mode').value = state.settings.mode;
      document.getElementById('setting-autosave').value = state.settings.autosave;
      document.getElementById('setting-autobackup').checked = state.settings.autobackup;
      document.getElementById('setting-dimensions').value = state.settings.dimensions;
      document.getElementById('setting-threshold').value = state.settings.threshold;
      document.getElementById('setting-search-limit').value = state.settings.searchLimit;
      document.getElementById('setting-cache-size').value = state.settings.cacheSize;
      document.getElementById('setting-query-cache').checked = state.settings.queryCache;
      document.getElementById('setting-lazy-load').checked = state.settings.lazyLoad;
      document.getElementById('setting-debug-level').value = state.settings.debugLevel;
      document.getElementById('setting-detailed-logs').checked = state.settings.detailedLogs;
      document.getElementById('setting-performance-tracking').checked = state.settings.performanceTracking;
    }

    function saveSettings() {
      state.settings = {
        mode: document.getElementById('setting-mode').value,
        autosave: parseInt(document.getElementById('setting-autosave').value),
        autobackup: document.getElementById('setting-autobackup').checked,
        dimensions: parseInt(document.getElementById('setting-dimensions').value),
        threshold: parseFloat(document.getElementById('setting-threshold').value),
        searchLimit: parseInt(document.getElementById('setting-search-limit').value),
        cacheSize: parseInt(document.getElementById('setting-cache-size').value),
        queryCache: document.getElementById('setting-query-cache').checked,
        lazyLoad: document.getElementById('setting-lazy-load').checked,
        debugLevel: document.getElementById('setting-debug-level').value,
        detailedLogs: document.getElementById('setting-detailed-logs').checked,
        performanceTracking: document.getElementById('setting-performance-tracking').checked
      };

      // Save to localStorage
      localStorage.setItem('agentdb-ide-settings', JSON.stringify(state.settings));

      logToConsole('success', 'Settings saved');
      closeSettings();

      alert('Settings saved! Some changes may require reloading the IDE.');
    }

    // ============================================================================
    // HELP
    // ============================================================================

    // showHelp() and closeHelp() are now provided by help-system.js
    // These functions support context-aware help with tabs and subsections

    function switchHelpTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.help-tab').forEach(tab => {
        tab.classList.toggle('active', tab.getAttribute('data-tab') === tabName);
      });

      // Update tab content
      document.querySelectorAll('.help-tab-content').forEach(content => {
        content.classList.toggle('active', content.id === `help-tab-${tabName}`);
      });

      // Scroll to top
      const modalBody = document.querySelector('#helpModal .modal-body');
      if (modalBody) {
        modalBody.scrollTop = 0;
      }
    }

    function switchHelpSubtab(parentTab, subtabName) {
      // Update subtab buttons
      document.querySelectorAll(`#help-tab-${parentTab} .help-subtab`).forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');

      // Update subsection content
      document.querySelectorAll(`#help-tab-${parentTab} .help-subsection`).forEach(content => {
        content.classList.toggle('active', content.id === `help-${parentTab}-${subtabName}`);
      });

      // Scroll to top
      const modalBody = document.querySelector('#helpModal .modal-body');
      if (modalBody) {
        modalBody.scrollTop = 0;
      }
    }

    // ============================================================================
    // SAMPLE DATA GENERATOR
    // ============================================================================

    function showSampleDataModal() {
      document.getElementById('sampleDataModal').classList.add('active');
      updateGenerationInfo();
    }

    function closeSampleData() {
      document.getElementById('sampleDataModal').classList.remove('active');
    }

    function showSampleDataOverview(stats) {
      // If no stats provided, open the sample data modal instead
      if (!stats) {
        showSampleDataModal();
        return;
      }

      // Populate statistics with null checks
      const updateElement = (id, value) => {
        const el = document.getElementById(id);
        if (el) el.textContent = value;
      };

      updateElement('overview-total-count', stats.totalCount || 0);
      updateElement('overview-patterns-count', stats.patternCount || 0);
      updateElement('overview-episodes-count', stats.episodeCount || 0);
      updateElement('overview-causal-count', stats.causalCount || 0);
      updateElement('overview-skills-count', stats.skillCount || 0);
      updateElement('overview-vectors-count', stats.vectorCount || 0);

      // Populate generation details (only elements that exist in console-style modal)
      updateElement('overview-method', stats.method === 'local' ? 'Local Templates' : 'AI-Powered (Gemini)');
      updateElement('overview-duration', `${stats.duration}ms`);

      // Generate sample preview with console style
      const previewDiv = document.getElementById('overview-sample-preview');
      if (!previewDiv) {
        logToConsole('warning', 'Preview div not found');
        return;
      }

      let previewHtml = '';

      if (stats.patternCount > 0) {
        previewHtml += '<div style="margin-bottom: 0.75rem;"><span style="color: #22c55e;"></span> <span style="color: #9ca3af;">Patterns Table:</span> <span style="color: #6b7280;">' + stats.patternCount + ' pattern(s) with embeddings and metadata</span></div>';
      }

      if (stats.episodeCount > 0) {
        previewHtml += '<div style="margin-bottom: 0.75rem;"><span style="color: #22c55e;"></span> <span style="color: #9ca3af;">Episodes Table:</span> <span style="color: #6b7280;">' + stats.episodeCount + ' episode(s) with task-action-reward-critique data</span></div>';
      }

      if (stats.causalCount > 0) {
        previewHtml += '<div style="margin-bottom: 0.75rem;"><span style="color: #22c55e;"></span> <span style="color: #9ca3af;">Causal Edges Table:</span> <span style="color: #6b7280;">' + stats.causalCount + ' causal relationship(s) with weights</span></div>';
      }

      if (stats.skillCount > 0) {
        previewHtml += '<div style="margin-bottom: 0.75rem;"><span style="color: #22c55e;"></span> <span style="color: #9ca3af;">Skills Table:</span> <span style="color: #6b7280;">' + stats.skillCount + ' reusable skill(s) with prompts and success criteria</span></div>';
      }

      if (stats.vectorCount > 0) {
        previewHtml += '<div style="margin-bottom: 0.75rem;"><span style="color: #22c55e;"></span> <span style="color: #9ca3af;">Vectors Table:</span> <span style="color: #6b7280;">' + stats.vectorCount + ' vector embedding(s) for semantic search</span></div>';
      }

      if (previewHtml === '') {
        previewHtml = '<div style="color: #6b7280;"><span style="color: #6b7280;"></span> No data generated</div>';
      }

      previewDiv.innerHTML = previewHtml;

      // Show modal
      document.getElementById('sampleDataOverviewModal').classList.add('active');
      logToConsole('info', ' Overview screen displayed');
    }

    function closeSampleDataOverview() {
      document.getElementById('sampleDataOverviewModal').classList.remove('active');
    }

    function updateGenerationInfo() {
      const type = document.getElementById('sample-data-type').value;

      // Hide all info items
      document.querySelectorAll('[id^="gen-info-"]').forEach(el => el.style.display = 'none');

      // Show relevant info
      if (type === 'all') {
        document.getElementById('gen-info-all').style.display = 'list-item';
      } else {
        const infoElement = document.getElementById(`gen-info-${type}`);
        if (infoElement) {
          infoElement.style.display = 'list-item';
        }
      }
    }

    // Update info when type changes
    document.addEventListener('DOMContentLoaded', () => {
      const typeSelect = document.getElementById('sample-data-type');
      if (typeSelect) {
        typeSelect.addEventListener('change', updateGenerationInfo);
      }
    });

    async function generateSampleData() {
      const type = document.getElementById('sample-data-type').value;
      const count = parseInt(document.getElementById('sample-data-count').value);
      const method = document.getElementById('sample-data-method').value;
      const theme = document.getElementById('sample-data-theme').value.trim();

      if (!count || count < 1 || count > 100) {
        logToConsole('error', 'Please enter a valid count (1-100)');
        return;
      }

      const startTime = Date.now();
      logToConsole('info', ` Starting sample data generation...`);
      logToConsole('info', `   Type: ${type}, Count: ${count}, Method: ${method}`);
      if (theme) logToConsole('info', `   Theme: "${theme}"`);

      try {
        let data;

        if (method === 'ai' && type !== 'all') {
          // Try AI generation for single type
          try {
            logToConsole('info', ' Calling Gemini AI for sample data generation...');
            data = await generateWithGemini(type, count, theme);
            logToConsole('success', ' AI generation completed successfully');
          } catch (error) {
            logToConsole('warning', ` AI generation failed, falling back to local: ${error.message}`);
            data = generateLocalSampleData(type, count);
          }
        } else {
          // Use local generation
          logToConsole('info', ' Using local template generation...');
          data = generateLocalSampleData(type, count);
          logToConsole('success', ' Local generation completed successfully');

          // Debug: Show what was generated
          if (type === 'all') {
            logToConsole('info', `   Generated: ${data.patterns?.length || 0} patterns, ${data.episodes?.length || 0} episodes, ${data.causal?.length || 0} causal, ${data.skills?.length || 0} skills, ${data.vectors?.length || 0} vectors`);
          }
        }

        // Track statistics
        let insertedCount = 0;
        let patternCount = 0;
        let episodeCount = 0;
        let causalCount = 0;
        let skillCount = 0;
        let vectorCount = 0;

        // Insert patterns
        if (type === 'all' || type === 'patterns') {
          logToConsole('info', ` Inserting patterns...`);
          const patterns = data.patterns || data;
          for (let i = 0; i < patterns.length; i++) {
            const pattern = patterns[i];
            const embedding = generateMockEmbedding(pattern.context || pattern.description || '');
            await state.db.storePattern({
              pattern_type: pattern.pattern_type,
              embedding: embedding,
              metadata: {
                description: pattern.context || pattern.description || '',
                result: pattern.result || '',
                generated: true
              }
            });
            insertedCount++;
            patternCount++;
            if ((i + 1) % 5 === 0 || i === patterns.length - 1) {
              logToConsole('info', `   Progress: ${i + 1}/${patterns.length} patterns inserted`);
            }
          }
          logToConsole('success', ` Inserted ${patternCount} patterns`);
        }

        // Insert episodes
        if (type === 'all' || type === 'episodes') {
          const episodes = data.episodes || data;
          if (!episodes || !Array.isArray(episodes) || episodes.length === 0) {
            logToConsole('warning', ` No episodes data to insert (type=${type}, data.episodes=${data.episodes?.length || 'undefined'})`);
          } else {
            logToConsole('info', ` Inserting episodes...`);
            for (let i = 0; i < episodes.length; i++) {
            const episode = episodes[i];
            const embedding = generateMockEmbedding(episode.task + ' ' + episode.action);
            await state.db.storeEpisode({
              task: episode.task,
              action: episode.action,
              reward: episode.reward,
              critique: episode.critique || '',
              embedding: embedding,
              metadata: {
                generated: true
              }
            });
            insertedCount++;
            episodeCount++;
            if ((i + 1) % 5 === 0 || i === episodes.length - 1) {
              logToConsole('info', `   Progress: ${i + 1}/${episodes.length} episodes inserted`);
              }
            }
            logToConsole('success', ` Inserted ${episodeCount} episodes`);
          }
        }

        // Insert causal edges
        if (type === 'all' || type === 'causal') {
          const edges = data.causal || data;
          if (!edges || !Array.isArray(edges) || edges.length === 0) {
            logToConsole('warning', ` No causal edges data to insert (type=${type}, data.causal=${data.causal?.length || 'undefined'})`);
          } else {
            logToConsole('info', ` Inserting causal edges...`);
            for (let i = 0; i < edges.length; i++) {
            const edge = edges[i];
            await state.db.addCausalEdge({
              cause: edge.cause,
              effect: edge.effect,
              metadata: {
                weight: edge.weight || 0.5,
                generated: true
              }
            });
            insertedCount++;
            causalCount++;
            if ((i + 1) % 5 === 0 || i === edges.length - 1) {
              logToConsole('info', `   Progress: ${i + 1}/${edges.length} causal edges inserted`);
              }
            }
            logToConsole('success', ` Inserted ${causalCount} causal edges`);
          }
        }

        // Insert skills
        if (type === 'all' || type === 'skills') {
          const skills = data.skills || data;
          if (!skills || !Array.isArray(skills) || skills.length === 0) {
            logToConsole('warning', ` No skills data to insert (type=${type}, data.skills=${data.skills?.length || 'undefined'})`);
          } else {
            logToConsole('info', ` Inserting skills...`);
            for (let i = 0; i < skills.length; i++) {
            const skill = skills[i];
            // Use raw SQL since skill_create might not be available in all AgentDB versions
            const embedding = generateMockEmbedding(skill.name + ' ' + skill.description);
            try {
              // Try using AgentDB's skill API if available
              if (state.db.skill_create) {
                await state.db.skill_create({
                  name: skill.name,
                  description: skill.description,
                  prompt: skill.prompt,
                  success_criteria: skill.success_criteria,
                  embedding: embedding,
                  metadata: { category: skill.category, generated: true }
                });
              } else {
                // Fallback: store as a pattern with skill category
                await state.db.storePattern({
                  pattern_type: `skill:${skill.category}`,
                  embedding: embedding,
                  metadata: {
                    name: skill.name,
                    description: skill.description,
                    prompt: skill.prompt,
                    success_criteria: skill.success_criteria,
                    category: skill.category,
                    generated: true
                  }
                });
              }
              insertedCount++;
              skillCount++;
              if ((i + 1) % 5 === 0 || i === skills.length - 1) {
                logToConsole('info', `   Progress: ${i + 1}/${skills.length} skills inserted`);
              }
            } catch (error) {
              logToConsole('warning', `   Failed to insert skill ${i + 1}: ${error.message}`);
              }
            }
            logToConsole('success', ` Inserted ${skillCount} skills`);
          }
        }

        // Insert vectors (stored as patterns with vector type)
        if (type === 'all' || type === 'vectors') {
          const vectors = data.vectors || data;
          if (!vectors || !Array.isArray(vectors) || vectors.length === 0) {
            logToConsole('warning', ` No vectors data to insert (type=${type}, data.vectors=${data.vectors?.length || 'undefined'})`);
          } else {
            logToConsole('info', ` Inserting vector embeddings...`);
            for (let i = 0; i < vectors.length; i++) {
              const vector = vectors[i];
              try {
                // Store vectors as patterns with special "vector" type
                await state.db.storePattern({
                  pattern_type: 'vector',
                  embedding: vector.embedding,
                  metadata: {
                    text: vector.text,
                    domain: vector.metadata?.domain || 'general',
                    generated: true,
                    vector_data: true
                  }
                });
                insertedCount++;
                vectorCount++;
                if ((i + 1) % 5 === 0 || i === vectors.length - 1) {
                  logToConsole('info', `   Progress: ${i + 1}/${vectors.length} vectors inserted`);
                }
              } catch (error) {
                logToConsole('warning', `   Failed to insert vector ${i + 1}: ${error.message}`);
              }
            }
            logToConsole('success', ` Inserted ${vectorCount} vector embeddings`);
          }
        }

        const duration = Date.now() - startTime;
        logToConsole('success', ` Generation complete! Total: ${insertedCount} records in ${duration}ms`);
        logToConsole('info', `   Patterns: ${patternCount}, Episodes: ${episodeCount}, Causal: ${causalCount}, Skills: ${skillCount}, Vectors: ${vectorCount}`);

        closeSampleData();

        // Refresh all views and data browser
        logToConsole('info', ' Refreshing data views...');
        if (state.currentView === 'patterns') await refreshPatterns();
        if (state.currentView === 'episodes') await refreshEpisodes();
        if (state.currentView === 'causal-graph') await refreshCausalGraph();
        if (state.currentView === 'data-browser') await refreshTableList();

        // Always refresh table list for data browser
        await refreshTableList();
        logToConsole('success', ' All views refreshed');

        // Show overview modal with statistics
        showSampleDataOverview({
          totalCount: insertedCount,
          patternCount,
          episodeCount,
          causalCount,
          skillCount,
          vectorCount,
          method,
          type,
          count,
          duration,
          theme: theme || 'None'
        });

      } catch (error) {
        logToConsole('error', ` Sample data generation failed: ${error.message}`);
        console.error('Sample data error:', error);
      }
    }

    async function generateWithGemini(type, count, theme) {
      const AI_ENDPOINT = 'https://agentdb.ruv.io/api/ai';

      // Note: This endpoint requires CORS configuration on the server
      // If you get CORS errors, use "Local Templates" method instead

      const prompts = {
        patterns: `Generate ${count} realistic reasoning patterns for an AI agent database. ${theme ? `Theme: ${theme}.` : ''} Return a JSON array with objects containing:
- pattern_type: one of (causal, temporal, optimization, error-recovery, context-switching, resource-allocation)
- context: a detailed scenario or situation (2-3 sentences)
- result: the reasoning outcome or decision (1-2 sentences)

Make them diverse, realistic, and useful for training AI agents.`,

        episodes: `Generate ${count} realistic training episodes for an AI agent. ${theme ? `Theme: ${theme}.` : ''} Return a JSON array with objects containing:
- task: a specific task or goal (1 sentence)
- action: the action taken by the agent (1 sentence)
- reward: a numerical reward between -1.0 and 1.0
- critique: analysis of the action and suggestions (2 sentences)

Create varied scenarios showing both successful and unsuccessful attempts.`,

        causal: `Generate ${count} realistic causal relationships for an AI reasoning system. ${theme ? `Theme: ${theme}.` : ''} Return a JSON array with objects containing:
- cause: a specific event or action (1 short sentence)
- effect: the resulting outcome (1 short sentence)
- weight: a confidence score between 0.0 and 1.0

Create diverse cause-effect pairs that demonstrate various types of causality.`
      };

      const response = await fetch(AI_ENDPOINT, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        mode: 'cors', // Explicit CORS mode
        body: JSON.stringify({
          model: 'google/gemini-2.5-flash',
          messages: [
            {
              role: 'system',
              content: 'You are a data generator for AI agent training. Always respond with valid JSON arrays only, no markdown or explanations.'
            },
            {
              role: 'user',
              content: prompts[type]
            }
          ]
        })
      }).catch(error => {
        // Handle network/CORS errors
        throw new Error('CORS error or network failure. Use Local Templates instead or configure CORS on the API server.');
      });

      if (!response.ok) {
        throw new Error(`AI API returned ${response.status}`);
      }

      const result = await response.json();
      let content = result.choices?.[0]?.message?.content || result.response || '';

      // Clean up markdown code blocks if present
      content = content.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();

      const parsedData = JSON.parse(content);

      if (!Array.isArray(parsedData)) {
        throw new Error('AI did not return an array');
      }

      return parsedData;
    }

    function generateLocalSampleData(type, count) {
      if (type === 'all') {
        // Distribute count evenly across all five types
        const countPerType = Math.floor(count / 5);
        const remainder = count % 5;

        return {
          patterns: generatePatterns(countPerType + (remainder > 0 ? 1 : 0)),
          episodes: generateEpisodes(countPerType + (remainder > 1 ? 1 : 0)),
          causal: generateCausalEdges(countPerType + (remainder > 2 ? 1 : 0)),
          skills: generateSkills(countPerType + (remainder > 3 ? 1 : 0)),
          vectors: generateVectors(countPerType)
        };
      }

      switch (type) {
        case 'patterns':
          return generatePatterns(count);
        case 'episodes':
          return generateEpisodes(count);
        case 'causal':
          return generateCausalEdges(count);
        case 'skills':
          return generateSkills(count);
        case 'vectors':
          return generateVectors(count);
        default:
          throw new Error(`Unknown type: ${type}`);
      }
    }

    function generatePatterns(count) {
      const patternTypes = ['causal', 'temporal', 'optimization', 'error-recovery', 'context-switching', 'resource-allocation'];

      const templates = {
        causal: [
          { context: 'User request for product recommendation with preference for eco-friendly items', result: 'Prioritize products with sustainability certifications and filter by carbon footprint' },
          { context: 'High server load detected during peak hours with degrading response times', result: 'Activate auto-scaling, distribute requests across regions, cache frequent queries' },
          { context: 'Customer complaint about delayed delivery in specific region', result: 'Identify bottleneck in regional distribution center, reroute future shipments via alternate hub' },
        ],
        temporal: [
          { context: 'Scheduled maintenance window approaching in 2 hours, active user sessions detected', result: 'Send notifications to users, prepare graceful shutdown sequence, backup current state' },
          { context: 'Time-series analysis shows predictable traffic spike every weekday at 9 AM', result: 'Pre-warm cache, increase resource allocation 30 minutes before peak, enable CDN boost' },
          { context: 'Long-running query detected exceeding timeout threshold', result: 'Cancel query, suggest optimization indices, log for performance review' },
        ],
        optimization: [
          { context: 'Database query plan showing full table scan on large dataset', result: 'Create composite index on filtered columns, update statistics, rewrite query with better predicates' },
          { context: 'Memory usage trending toward capacity limits with growing cache size', result: 'Implement LRU eviction policy, compress cached objects, analyze cache hit ratio' },
          { context: 'API response time exceeds SLA threshold for specific endpoint', result: 'Add response caching, optimize database queries, implement pagination for large results' },
        ],
        'error-recovery': [
          { context: 'Third-party payment API returning 503 errors, transaction queue building up', result: 'Switch to backup payment provider, retry failed transactions with exponential backoff, alert operations team' },
          { context: 'Database connection pool exhausted during traffic spike', result: 'Increase pool size, close idle connections, implement connection timeout, add circuit breaker' },
          { context: 'Critical service crashed with out-of-memory error', result: 'Restart service with increased heap size, enable memory profiling, investigate memory leak' },
        ],
        'context-switching': [
          { context: 'User switched from product browsing to checkout flow', result: 'Load cart data, fetch shipping options, pre-validate payment methods, maintain session continuity' },
          { context: 'Agent transitioning from data analysis task to report generation', result: 'Persist analysis state, load reporting templates, retrieve visualization preferences' },
          { context: 'Multi-tenant system switching between customer environments', result: 'Flush previous tenant cache, load new tenant configuration, verify permission boundaries' },
        ],
        'resource-allocation': [
          { context: 'Multiple high-priority tasks competing for limited GPU resources', result: 'Allocate resources based on task urgency and estimated completion time, queue lower priority tasks' },
          { context: 'Budget constraint requiring optimization of cloud infrastructure costs', result: 'Identify underutilized resources, implement auto-shutdown for idle instances, use spot instances for batch jobs' },
          { context: 'Network bandwidth limitation affecting multiple concurrent downloads', result: 'Implement rate limiting, prioritize critical transfers, use compression, schedule large transfers during off-peak' },
        ]
      };

      const patterns = [];
      for (let i = 0; i < count; i++) {
        const type = patternTypes[i % patternTypes.length];
        const template = templates[type][i % templates[type].length];
        patterns.push({
          pattern_type: type,
          context: template.context,
          result: template.result
        });
      }

      return patterns;
    }

    function generateEpisodes(count) {
      const scenarios = [
        {
          task: 'Optimize database query performance for user dashboard',
          action: 'Added composite index on (user_id, created_at) and implemented query result caching',
          reward: 0.9,
          critique: 'Excellent optimization approach. Query time reduced from 2.3s to 0.15s. Consider monitoring cache hit rate and adding cache invalidation strategy for data consistency.'
        },
        {
          task: 'Handle API rate limit error from external service',
          action: 'Implemented exponential backoff retry logic with max 5 attempts',
          reward: 0.8,
          critique: 'Good error recovery strategy. Successfully processed 95% of requests. Could improve by adding circuit breaker pattern to prevent cascading failures during extended outages.'
        },
        {
          task: 'Reduce customer churn by improving onboarding experience',
          action: 'Created interactive tutorial with progress tracking and personalized recommendations',
          reward: 0.85,
          critique: 'Strong user engagement approach. Onboarding completion rate increased 40%. Consider A/B testing different tutorial lengths and adding gamification elements.'
        },
        {
          task: 'Scale application to handle 10x traffic increase',
          action: 'Implemented horizontal pod autoscaling based on CPU and memory metrics',
          reward: 0.75,
          critique: 'Adequate scaling solution. System remained stable under load. However, autoscaling reacted slowly. Consider predictive scaling based on historical patterns and custom metrics like queue depth.'
        },
        {
          task: 'Implement secure authentication for API endpoints',
          action: 'Added JWT token validation middleware without rate limiting',
          reward: 0.5,
          critique: 'Partial solution. Authentication works but vulnerable to brute force attacks. Must add rate limiting, token rotation, and monitoring for suspicious patterns. Security requires defense in depth.'
        },
        {
          task: 'Debug production memory leak in background worker',
          action: 'Added comprehensive logging but did not profile memory usage',
          reward: 0.3,
          critique: 'Insufficient approach. Logging helps but does not identify root cause. Should use memory profiling tools, heap dumps, and analyze object retention. Logging alone won\'t fix memory leaks.'
        },
        {
          task: 'Migrate legacy monolith to microservices architecture',
          action: 'Rewrote entire application from scratch without incremental migration',
          reward: -0.5,
          critique: 'Risky big-bang approach. High probability of failures and downtime. Should use strangler fig pattern: incrementally extract services while keeping monolith running. Minimize risk through gradual migration.'
        },
        {
          task: 'Improve ML model accuracy for product recommendations',
          action: 'Increased model complexity without evaluating on validation set',
          reward: -0.3,
          critique: 'Overfitting risk. More complex models need more training data and proper validation. Should use cross-validation, regularization, and monitor for overfitting. Always validate before deploying.'
        },
        {
          task: 'Fix critical security vulnerability in authentication system',
          action: 'Patched the vulnerability and conducted security audit of entire auth flow',
          reward: 0.95,
          critique: 'Exemplary security response. Not only fixed immediate issue but prevented future vulnerabilities. Consider adding automated security scanning to CI/CD pipeline and regular penetration testing.'
        },
        {
          task: 'Reduce infrastructure costs without impacting performance',
          action: 'Analyzed resource utilization, right-sized instances, and implemented auto-shutdown for dev environments',
          reward: 0.88,
          critique: 'Comprehensive cost optimization. Achieved 35% cost reduction while maintaining SLAs. Excellent use of data-driven decisions. Consider reserved instances for predictable workloads for additional savings.'
        }
      ];

      const episodes = [];
      for (let i = 0; i < count; i++) {
        episodes.push(scenarios[i % scenarios.length]);
      }

      return episodes;
    }

    function generateCausalEdges(count) {
      const relationships = [
        { cause: 'Added database index on frequently queried column', effect: 'Query execution time decreased by 80%', weight: 0.95 },
        { cause: 'Implemented request caching with 1-hour TTL', effect: 'API response time improved from 250ms to 45ms', weight: 0.92 },
        { cause: 'Increased server memory allocation from 2GB to 8GB', effect: 'Reduced out-of-memory errors and improved stability', weight: 0.88 },
        { cause: 'Deployed code without running integration tests', effect: 'Critical bug in production affecting 30% of users', weight: 0.85 },
        { cause: 'Enabled auto-scaling with CPU threshold at 70%', effect: 'System handled 5x traffic spike without downtime', weight: 0.90 },
        { cause: 'Implemented rate limiting at 100 requests per minute', effect: 'Prevented DDoS attack and maintained service availability', weight: 0.87 },
        { cause: 'Added comprehensive error logging and monitoring', effect: 'Mean time to detection (MTTD) reduced from 2 hours to 5 minutes', weight: 0.93 },
        { cause: 'Refactored monolithic function into smaller, focused modules', effect: 'Code maintainability improved, bug fixing time reduced by 40%', weight: 0.82 },
        { cause: 'Implemented CI/CD pipeline with automated testing', effect: 'Deployment frequency increased 10x with fewer production issues', weight: 0.91 },
        { cause: 'Added input validation and sanitization on all API endpoints', effect: 'Eliminated SQL injection and XSS vulnerabilities', weight: 0.94 },
        { cause: 'Optimized image sizes and enabled lazy loading', effect: 'Page load time decreased from 4.2s to 1.3s', weight: 0.89 },
        { cause: 'Introduced feature flags for gradual rollouts', effect: 'Reduced blast radius of bugs, enabled quick rollback', weight: 0.86 },
        { cause: 'Migrated from synchronous to asynchronous processing', effect: 'System throughput increased 300%, user experience improved', weight: 0.90 },
        { cause: 'Implemented database connection pooling', effect: 'Reduced connection overhead, improved concurrent request handling', weight: 0.84 },
        { cause: 'Added retry logic with exponential backoff', effect: 'Improved resilience to transient failures, success rate increased to 98%', weight: 0.88 }
      ];

      const edges = [];
      for (let i = 0; i < count; i++) {
        edges.push(relationships[i % relationships.length]);
      }

      return edges;
    }

    function generateSkills(count) {
      const skillTemplates = [
        {
          name: 'API Response Optimization',
          description: 'Optimize API endpoint response times through caching and query optimization',
          prompt: 'Analyze API endpoint performance metrics, identify slow queries, implement Redis caching for frequently accessed data, and add database indices on filtered columns',
          success_criteria: 'Response time < 200ms for 95th percentile, cache hit rate > 70%',
          category: 'performance'
        },
        {
          name: 'Error Recovery Automation',
          description: 'Automatically detect and recover from common service failures',
          prompt: 'Monitor service health metrics, detect failure patterns, implement circuit breaker pattern, execute automated recovery procedures with exponential backoff',
          success_criteria: 'Service availability > 99.9%, automatic recovery success rate > 90%',
          category: 'reliability'
        },
        {
          name: 'Security Vulnerability Scanner',
          description: 'Scan codebase for common security vulnerabilities and suggest fixes',
          prompt: 'Analyze code for SQL injection, XSS, CSRF vulnerabilities, check dependency versions for known CVEs, validate input sanitization, review authentication mechanisms',
          success_criteria: 'Zero high-severity vulnerabilities, all dependencies up-to-date',
          category: 'security'
        },
        {
          name: 'Database Query Optimizer',
          description: 'Analyze and optimize database query performance',
          prompt: 'Profile slow queries, analyze query execution plans, suggest appropriate indices, rewrite N+1 queries, implement query result caching',
          success_criteria: 'Query execution time reduced by >50%, no full table scans on large tables',
          category: 'performance'
        },
        {
          name: 'Test Coverage Analyzer',
          description: 'Identify untested code paths and generate test cases',
          prompt: 'Analyze code coverage reports, identify critical paths without tests, generate unit test templates, suggest edge cases and boundary conditions',
          success_criteria: 'Code coverage > 80%, all critical paths covered',
          category: 'testing'
        },
        {
          name: 'Cost Optimization Advisor',
          description: 'Analyze cloud infrastructure costs and suggest optimizations',
          prompt: 'Review cloud resource utilization, identify underutilized instances, suggest right-sizing, recommend reserved instances for predictable workloads, identify idle resources',
          success_criteria: 'Cost reduction > 30% without performance degradation',
          category: 'optimization'
        },
        {
          name: 'Log Analysis and Alerting',
          description: 'Parse logs to detect anomalies and generate actionable alerts',
          prompt: 'Aggregate logs from multiple services, detect error patterns, identify performance degradation, correlate events across services, generate severity-appropriate alerts',
          success_criteria: 'Mean time to detection (MTTD) < 5 minutes, <5% false positive rate',
          category: 'monitoring'
        },
        {
          name: 'Code Refactoring Assistant',
          description: 'Identify code smells and suggest refactoring opportunities',
          prompt: 'Detect duplicate code, identify long functions, find complex conditionals, suggest design pattern applications, maintain backward compatibility',
          success_criteria: 'Reduce cyclomatic complexity by >40%, zero breaking changes',
          category: 'code-quality'
        },
        {
          name: 'A/B Test Analyzer',
          description: 'Analyze A/B test results and provide statistical significance',
          prompt: 'Collect metrics from test variants, calculate statistical significance, determine minimum sample size, detect interaction effects, provide confidence intervals',
          success_criteria: 'P-value < 0.05, confidence level > 95%, valid sample size achieved',
          category: 'analytics'
        },
        {
          name: 'Documentation Generator',
          description: 'Generate comprehensive API and code documentation',
          prompt: 'Parse code structure, extract function signatures and docstrings, generate OpenAPI specs, create usage examples, maintain documentation consistency',
          success_criteria: '100% API coverage, examples for all endpoints, up-to-date with code',
          category: 'documentation'
        }
      ];

      const skills = [];
      for (let i = 0; i < count; i++) {
        skills.push(skillTemplates[i % skillTemplates.length]);
      }

      return skills;
    }

    function generateVectors(count) {
      const vectorTemplates = [
        { text: 'Optimize database query performance by adding composite indices', domain: 'performance' },
        { text: 'Implement user authentication with JWT tokens and refresh mechanism', domain: 'security' },
        { text: 'Deploy microservices architecture with Docker and Kubernetes', domain: 'infrastructure' },
        { text: 'Build real-time chat application using WebSocket connections', domain: 'features' },
        { text: 'Integrate payment processing with Stripe API and webhook handling', domain: 'payments' },
        { text: 'Create responsive UI components with React and styled-components', domain: 'frontend' },
        { text: 'Set up CI/CD pipeline with automated testing and deployment', domain: 'devops' },
        { text: 'Implement caching layer with Redis for frequently accessed data', domain: 'performance' },
        { text: 'Add monitoring and alerting with Prometheus and Grafana', domain: 'observability' },
        { text: 'Migrate legacy SQL database to NoSQL with data migration strategy', domain: 'data' },
        { text: 'Build recommendation engine using collaborative filtering algorithms', domain: 'ml' },
        { text: 'Implement rate limiting and DDoS protection for API endpoints', domain: 'security' },
        { text: 'Create data pipeline for ETL processing with Apache Spark', domain: 'data' },
        { text: 'Add full-text search functionality with Elasticsearch integration', domain: 'search' },
        { text: 'Optimize mobile app performance and reduce bundle size', domain: 'mobile' }
      ];

      const vectors = [];
      for (let i = 0; i < count; i++) {
        const template = vectorTemplates[i % vectorTemplates.length];
        vectors.push({
          text: template.text,
          embedding: generateMockEmbedding(template.text),
          metadata: { domain: template.domain, generated: true }
        });
      }

      return vectors;
    }

    // ============================================================================

    // ============================================================================
    // NAVIGATION
    // ============================================================================

    function switchView(view) {
      state.currentView = view;

      // Update sidebar
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.toggle('active', item.getAttribute('onclick').includes(view));
      });

      // Update content panels
      document.querySelectorAll('.content-panel').forEach(panel => {
        panel.classList.toggle('active', panel.id === `panel-${view}`);
      });

      // Show/hide main tabs (only for SQL Editor)
      const mainTabs = document.querySelector('.main-tabs');
      if (view === 'sql-editor') {
        mainTabs.classList.remove('hidden');
      } else {
        mainTabs.classList.add('hidden');
      }

      // Close mobile menu if open
      const sidebar = document.querySelector('.ide-sidebar');
      const overlay = document.getElementById('mobileOverlay');
      sidebar.classList.remove('mobile-open');
      overlay.classList.remove('active');

      logToConsole('info', `Switched to ${view}`);
    }

    // Tab switching
    document.querySelectorAll('.main-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.getAttribute('data-tab');

        document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        // Switch tab content panels
        document.querySelectorAll('.tab-content-panel').forEach(panel => {
          panel.classList.remove('active');
        });
        const targetPanel = document.getElementById(`tab-${tabName}`);
        if (targetPanel) {
          targetPanel.classList.add('active');
        }

        state.currentTab = tabName;
        logToConsole('info', `Switched to ${tabName} tab`);
      });
    });

    // Mobile menu toggle
    function toggleMobileMenu() {
      const sidebar = document.querySelector('.ide-sidebar');
      const overlay = document.getElementById('mobileOverlay');
      sidebar.classList.toggle('mobile-open');
      overlay.classList.toggle('active');
    }

    // ============================================================================
    // UTILITIES
    // ============================================================================

    function downloadFile(filename, content, mimeType = 'text/plain') {
      const blob = new Blob([content], { type: mimeType });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function generateMockEmbedding(text) {
      // Generate a simple mock embedding (in production, use real embedding model)
      const embedding = [];
      for (let i = 0; i < state.settings.dimensions; i++) {
        embedding.push(Math.random() * 2 - 1);
      }
      return embedding;
    }

    function updateStats() {
      try {
        const avgTime = state.stats.queryCount > 0
          ? Math.round(state.stats.totalTime / state.stats.queryCount)
          : 0;

        const cacheRate = (state.stats.cacheHits + state.stats.cacheMisses) > 0
          ? Math.round((state.stats.cacheHits / (state.stats.cacheHits + state.stats.cacheMisses)) * 100)
          : 0;

        // Update text content
        const queryCountEl = document.getElementById('query-count');
        const avgTimeEl = document.getElementById('avg-time');
        const cacheRateEl = document.getElementById('cache-rate');

        if (queryCountEl) queryCountEl.textContent = state.stats.queryCount;
        if (avgTimeEl) avgTimeEl.textContent = avgTime + 'ms';
        if (cacheRateEl) cacheRateEl.textContent = cacheRate + '%';

        // Update progress bars
        const maxQueries = 100;
        const queryPercentage = Math.min((state.stats.queryCount / maxQueries) * 100, 100);
        const queryBarEl = document.getElementById('query-count-bar');
        if (queryBarEl) {
          queryBarEl.style.width = queryPercentage + '%';
          // Add color coding
          if (queryPercentage < 50) {
            queryBarEl.style.background = 'var(--success)';
          } else if (queryPercentage < 80) {
            queryBarEl.style.background = 'var(--warning)';
          } else {
            queryBarEl.style.background = 'var(--danger)';
          }
        }

        const maxTime = 1000;
        const timePercentage = Math.min((avgTime / maxTime) * 100, 100);
        const avgTimeBarEl = document.getElementById('avg-time-bar');
        if (avgTimeBarEl) {
          avgTimeBarEl.style.width = timePercentage + '%';
          // Color coding for speed
          if (avgTime < 100) {
            avgTimeBarEl.style.background = 'var(--success)';
          } else if (avgTime < 500) {
            avgTimeBarEl.style.background = 'var(--warning)';
          } else {
            avgTimeBarEl.style.background = 'var(--danger)';
          }
        }

        const cacheBarEl = document.getElementById('cache-rate-bar');
        if (cacheBarEl) {
          cacheBarEl.style.width = cacheRate + '%';
          // Color coding for cache efficiency
          if (cacheRate > 70) {
            cacheBarEl.style.background = 'var(--success)';
          } else if (cacheRate > 40) {
            cacheBarEl.style.background = 'var(--warning)';
          } else {
            cacheBarEl.style.background = 'var(--info)';
          }
        }

        console.log('[Performance Metrics] Updated:', {
          queries: state.stats.queryCount,
          avgTime: avgTime + 'ms',
          cacheRate: cacheRate + '%'
        });
      } catch (error) {
        console.error('[Performance Metrics] Update failed:', error);
      }
    }

    async function testMetrics() {
      logToConsole('info', ' Running performance metrics test...');

      // Run a series of test queries to demonstrate metrics
      const testQueries = [
        'SELECT COUNT(*) as total FROM patterns',
        'SELECT * FROM patterns LIMIT 5',
        'SELECT COUNT(*) as total FROM episodes',
        'SELECT * FROM episodes LIMIT 3'
      ];

      for (let i = 0; i < testQueries.length; i++) {
        const query = testQueries[i];
        const startTime = performance.now();

        try {
          const results = sqlAll(query);
          const endTime = performance.now();
          const duration = Math.round(endTime - startTime);

          // Update stats
          state.stats.queryCount++;
          state.stats.totalTime += duration;

          // Simulate cache behavior for demo
          if (i > 0 && Math.random() > 0.5) {
            state.stats.cacheHits++;
          } else {
            state.stats.cacheMisses++;
          }

          logToConsole('success', `Test query ${i + 1}/${testQueries.length}: ${results.length} rows in ${duration}ms`);
        } catch (error) {
          logToConsole('warning', `Test query ${i + 1} failed: ${error.message}`);
        }

        // Update metrics display
        updateStats();

        // Small delay between queries
        await new Promise(resolve => setTimeout(resolve, 200));
      }

      logToConsole('success', ' Performance metrics test complete! Check the metrics above.');
    }

    function updateDashboardStats() {
      try {
        // Get counts from database
        const tables = sqlAll("SELECT name FROM sqlite_master WHERE type='table'") || [];
        const patterns = sqlAll('SELECT * FROM patterns') || [];
        const episodes = sqlAll('SELECT * FROM episodes') || [];
        const causalEdges = sqlAll('SELECT * FROM causal_edges') || [];

        // Calculate total records across all tables
        let totalRecords = 0;
        tables.forEach(table => {
          try {
            const count = sqlGet(`SELECT COUNT(*) as count FROM ${table.name}`);
            if (count && count.count) totalRecords += count.count;
          } catch (e) {
            // Ignore errors for system tables
          }
        });

        // Calculate pattern average score
        let avgPatternScore = 'N/A';
        if (patterns.length > 0) {
          const scores = patterns.map(p => p.confidence || 0);
          const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;
          avgPatternScore = avgScore.toFixed(2);
        }

        // Calculate episode average reward
        let avgEpisodeReward = 'N/A';
        if (episodes.length > 0) {
          const rewards = episodes.map(e => e.reward || 0);
          const avgReward = rewards.reduce((a, b) => a + b, 0) / rewards.length;
          avgEpisodeReward = avgReward.toFixed(2);
        }

        // Update header stats
        const headerTableCount = document.getElementById('header-table-count');
        const headerPatternCount = document.getElementById('header-pattern-count');
        const headerEpisodeCount = document.getElementById('header-episode-count');

        if (headerTableCount) headerTableCount.textContent = tables.length;
        if (headerPatternCount) headerPatternCount.textContent = patterns.length;
        if (headerEpisodeCount) headerEpisodeCount.textContent = episodes.length;

        // Update dashboard card stats
        const dashQueryCount = document.getElementById('dash-query-count');
        const dashTableCount = document.getElementById('dash-table-count');
        const dashRecordCount = document.getElementById('dash-record-count');
        const dashPatternCount = document.getElementById('dash-pattern-count');
        const dashPatternScore = document.getElementById('dash-pattern-score');
        const dashEpisodeCount = document.getElementById('dash-episode-count');
        const dashEpisodeReward = document.getElementById('dash-episode-reward');
        const dashVectorCount = document.getElementById('dash-vector-count');
        const dashCausalCount = document.getElementById('dash-causal-count');

        if (dashQueryCount) dashQueryCount.textContent = state.queryCount || 0;
        if (dashTableCount) dashTableCount.textContent = tables.length;
        if (dashRecordCount) dashRecordCount.textContent = totalRecords;
        if (dashPatternCount) dashPatternCount.textContent = patterns.length;
        if (dashPatternScore) dashPatternScore.textContent = avgPatternScore;
        if (dashEpisodeCount) dashEpisodeCount.textContent = episodes.length;
        if (dashEpisodeReward) dashEpisodeReward.textContent = avgEpisodeReward;
        if (dashVectorCount) dashVectorCount.textContent = patterns.length; // Patterns have embeddings
        if (dashCausalCount) dashCausalCount.textContent = causalEdges.length;
      } catch (error) {
        console.error('Error updating dashboard stats:', error);
      }
    }

    async function refreshAll() {
      await refreshTableList();
      await refreshSchema();
      await refreshPatterns();
      await refreshEpisodes();
      await refreshCausalGraph();
      updateDashboardStats();
      logToConsole('success', 'All views refreshed');
    }

    // ============================================================================
    // NEW FEATURES: DIAGNOSTICS, HELP, FILTERS, EXPORTS
    // ============================================================================

    function displayDiagnostics(query, results, duration) {
      const diagnosticsDiv = document.getElementById('query-diagnostics');
      const queryLines = query.split('\n').length;
      const queryLength = query.length;
      const hasJoin = query.toUpperCase().includes('JOIN');
      const hasWhere = query.toUpperCase().includes('WHERE');
      const hasLimit = query.toUpperCase().includes('LIMIT');

      const html = `
        <div style="display: grid; gap: 1rem;">
          <div class="card" style="background: var(--bg-tertiary);">
            <h4 style="color: var(--accent); margin-bottom: 0.75rem; font-size: 0.9375rem;"> Performance Metrics</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.75rem;">
              <div>
                <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Execution Time</div>
                <div style="font-size: 1.25rem; font-weight: 600; color: ${duration < 10 ? 'var(--success)' : duration < 100 ? 'var(--warning)' : 'var(--danger)'};">${duration}ms</div>
              </div>
              <div>
                <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Rows Returned</div>
                <div style="font-size: 1.25rem; font-weight: 600;">${results.length}</div>
              </div>
              <div>
                <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Query Length</div>
                <div style="font-size: 1.25rem; font-weight: 600;">${queryLength} chars</div>
              </div>
            </div>
          </div>

          <div class="card" style="background: var(--bg-tertiary);">
            <h4 style="color: var(--accent); margin-bottom: 0.75rem; font-size: 0.9375rem;"> Query Analysis</h4>
            <div style="display: grid; gap: 0.5rem; font-size: 0.875rem;">
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="color: ${hasWhere ? 'var(--success)' : 'var(--warning)'};">${hasWhere ? '' : ''}</span>
                <span>WHERE clause: ${hasWhere ? 'Yes (Good)' : 'No (Warning: Full table scan)'}</span>
              </div>
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="color: ${hasLimit ? 'var(--success)' : 'var(--warning)'};">${hasLimit ? '' : ''}</span>
                <span>LIMIT clause: ${hasLimit ? 'Yes (Good)' : 'No (Consider adding LIMIT)'}</span>
              </div>
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="color: var(--info);"></span>
                <span>JOIN operations: ${hasJoin ? 'Yes' : 'No'}</span>
              </div>
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="color: var(--info);"></span>
                <span>Query lines: ${queryLines}</span>
              </div>
            </div>
          </div>

          <div class="card" style="background: var(--bg-tertiary);">
            <h4 style="color: var(--accent); margin-bottom: 0.75rem; font-size: 0.9375rem;"> Optimization Suggestions</h4>
            <ul style="padding-left: 1.25rem; font-size: 0.875rem; line-height: 1.6;">
              ${!hasWhere ? '<li style="color: var(--warning);">Add WHERE clause to filter results and improve performance</li>' : ''}
              ${!hasLimit && results.length > 100 ? '<li style="color: var(--warning);">Add LIMIT clause to reduce result set size</li>' : ''}
              ${duration > 100 ? '<li style="color: var(--warning);">Query execution time is high. Consider adding indexes.</li>' : ''}
              ${duration < 10 ? '<li style="color: var(--success);">Excellent performance! Query executed quickly.</li>' : ''}
              ${hasJoin ? '<li>JOIN detected. Ensure proper indexes on join columns.</li>' : ''}
            </ul>
          </div>
        </div>
      `;

      diagnosticsDiv.innerHTML = html;
    }

    // Help Modal Functions
    function showPatternHelp() {
      const modal = document.getElementById('helpModal');
      document.querySelector('#helpModal .modal-body').innerHTML = `
        <div class="help-section">
          <h3> Pattern Management</h3>
          <p>Patterns are reusable reasoning templates stored with vector embeddings for semantic similarity search.</p>

          <h4>Pattern Types</h4>
          <ul>
            <li><strong>Causal:</strong> Cause-effect reasoning patterns</li>
            <li><strong>Temporal:</strong> Time-based patterns and sequences</li>
            <li><strong>Reasoning:</strong> Logic and inference patterns</li>
            <li><strong>Optimization:</strong> Performance optimization strategies</li>
            <li><strong>Custom:</strong> User-defined pattern types</li>
          </ul>

          <h4>Example Code</h4>
          <div class="code-block">await db.storePattern({
  pattern_type: 'optimization',
  embedding: vectorArray,
  metadata: {
    description: 'Gradient descent optimization',
    approach: 'iterative',
    taskType: 'parameter tuning'
  }
});</div>

          <h4>Features</h4>
          <ul>
            <li>Filter patterns by type</li>
            <li>Export to JSON for backup</li>
            <li>Batch import from templates</li>
            <li>Semantic search across patterns</li>
          </ul>
        </div>
      `;
      modal.classList.add('active');
    }

    function showEpisodeHelp() {
      const modal = document.getElementById('helpModal');
      document.querySelector('#helpModal .modal-body').innerHTML = `
        <div class="help-section">
          <h3> Episode Management</h3>
          <p>Episodes capture complete task-action-reward trajectories for reinforcement learning and performance tracking.</p>

          <h4>Episode Structure</h4>
          <ul>
            <li><strong>Task:</strong> Description of the objective</li>
            <li><strong>Action:</strong> Steps taken to complete the task</li>
            <li><strong>Reward:</strong> Outcome score (0.0 - 1.0)</li>
            <li><strong>Critique:</strong> Analysis of performance</li>
            <li><strong>Metadata:</strong> Additional context (duration, channels, etc.)</li>
          </ul>

          <h4>Example Code</h4>
          <div class="code-block">await db.storeEpisode({
  task: 'Optimize marketing budget',
  action: 'Reallocate to high-performing channels',
  reward: 0.85,
  critique: 'Budget reallocation improved ROAS by 15%',
  embedding: vectorArray,
  metadata: {
    duration: '2 hours',
    channels: ['google', 'facebook']
  }
});</div>

          <h4>Use Cases</h4>
          <ul>
            <li>Track high-performing strategies (reward > 0.7)</li>
            <li>Visualize learning trajectories over time</li>
            <li>Compare different approaches</li>
            <li>Identify patterns in successful episodes</li>
          </ul>
        </div>
      `;
      modal.classList.add('active');
    }

    function showCausalHelp() {
      const modal = document.getElementById('helpModal');
      document.querySelector('#helpModal .modal-body').innerHTML = `
        <div class="help-section">
          <h3> Causal Graph Visualization</h3>
          <p>Causal edges represent directed cause-effect relationships with weighted strengths for causal inference.</p>

          <h4>Components</h4>
          <ul>
            <li><strong>Cause:</strong> The triggering event or condition</li>
            <li><strong>Effect:</strong> The resulting outcome</li>
            <li><strong>Weight:</strong> Strength of relationship (0.0 - 1.0)</li>
            <li><strong>Metadata:</strong> Confidence, sample size, context</li>
          </ul>

          <h4>Example Code</h4>
          <div class="code-block">await db.addCausalEdge({
  cause: 'increased_ad_budget',
  effect: 'higher_conversion_rate',
  weight: 0.82,
  metadata: {
    confidence: 0.91,
    sample_size: 1000
  }
});</div>

          <h4>Analysis Tools</h4>
          <ul>
            <li>Filter edges by minimum weight</li>
            <li>Analyze causal paths between nodes</li>
            <li>Export graph for visualization</li>
            <li>Identify key causal relationships</li>
          </ul>
        </div>
      `;
      modal.classList.add('active');
    }

    function showVectorHelp() {
      const modal = document.getElementById('helpModal');
      document.querySelector('#helpModal .modal-body').innerHTML = `
        <div class="help-section">
          <h3> Vector Similarity Search</h3>
          <p>Perform semantic search across stored vectors using cosine similarity for intelligent content retrieval.</p>

          <h4>How It Works</h4>
          <ol>
            <li>Your query is converted to a 384-dimensional vector</li>
            <li>Cosine similarity is calculated against all stored vectors</li>
            <li>Results are ranked by similarity score</li>
            <li>Top N results are returned based on your limit</li>
          </ol>

          <h4>Parameters</h4>
          <ul>
            <li><strong>Query:</strong> Natural language search text</li>
            <li><strong>Results:</strong> Number of top matches (1-50)</li>
            <li><strong>Threshold:</strong> Minimum similarity score (0.0-1.0)</li>
          </ul>

          <h4>Example Code</h4>
          <div class="code-block">const results = db.searchSimilar(queryEmbedding, 5);
// Returns top 5 most similar vectors</div>

          <h4>Best Practices</h4>
          <ul>
            <li>Use descriptive queries for better matches</li>
            <li>Adjust threshold to filter low-quality results</li>
            <li>Start with 5-10 results, adjust as needed</li>
          </ul>
        </div>
      `;
      modal.classList.add('active');
    }

    function showOptimizerHelp() {
      const modal = document.getElementById('helpModal');
      document.querySelector('#helpModal .modal-body').innerHTML = `
        <div class="help-section">
          <h3> Query Optimizer</h3>
          <p>Analyze SQL query performance and receive recommendations for optimization.</p>

          <h4>Analysis Features</h4>
          <ul>
            <li><strong>Execution Time:</strong> Measure query performance</li>
            <li><strong>Query Plan:</strong> Understand how SQL is executed</li>
            <li><strong>Optimization Suggestions:</strong> Get specific recommendations</li>
            <li><strong>Index Recommendations:</strong> Improve query speed</li>
          </ul>

          <h4>Common Optimizations</h4>
          <div class="code-block">--  Avoid
SELECT * FROM patterns;

--  Better
SELECT id, pattern_type, metadata
FROM patterns
WHERE pattern_type = 'causal'
LIMIT 20;</div>

          <h4>Tips</h4>
          <ul>
            <li>Always use WHERE clause to filter results</li>
            <li>Add LIMIT to prevent large result sets</li>
            <li>Specify columns instead of SELECT *</li>
            <li>Use indexes on frequently queried columns</li>
            <li>Avoid complex nested subqueries when possible</li>
          </ul>
        </div>
      `;
      modal.classList.add('active');
    }

    // Filter Functions
    function filterPatterns() {
      const filterValue = document.getElementById('pattern-type-filter').value;
      refreshPatterns(filterValue);
    }

    function filterEpisodes(threshold) {
      document.getElementById('reward-filter-value').textContent = ` ${threshold}`;
      refreshEpisodes(parseFloat(threshold));
    }

    function filterCausalEdges(weight) {
      document.getElementById('weight-filter-value').textContent = ` ${weight}`;
      refreshCausalGraph(parseFloat(weight));
    }

    // Export Functions
    function exportPatterns() {
      try {
        const patterns = sqlAll('SELECT * FROM patterns ORDER BY created_at DESC');
        const data = JSON.stringify(patterns, null, 2);
        downloadFile('agentdb-patterns-export.json', data, 'application/json');
        logToConsole('success', `Exported ${patterns.length} patterns`);
      } catch (error) {
        logToConsole('error', `Failed to export patterns: ${error.message}`);
      }
    }

    function exportEpisodes() {
      try {
        const episodes = sqlAll('SELECT * FROM episodes ORDER BY created_at DESC');
        const data = JSON.stringify(episodes, null, 2);
        downloadFile('agentdb-episodes-export.json', data, 'application/json');
        logToConsole('success', `Exported ${episodes.length} episodes`);
      } catch (error) {
        logToConsole('error', `Failed to export episodes: ${error.message}`);
      }
    }

    function exportCausalGraph() {
      try {
        const edges = sqlAll('SELECT * FROM causal_edges ORDER BY created_at DESC');
        const data = JSON.stringify(edges, null, 2);
        downloadFile('agentdb-causal-graph-export.json', data, 'application/json');
        logToConsole('success', `Exported ${edges.length} causal edges`);
      } catch (error) {
        logToConsole('error', `Failed to export causal graph: ${error.message}`);
      }
    }

    // Template and Example Functions
    function showPatternTemplates() {
      showHelp(); // Reuse help modal
      showPatternHelp();
    }

    function showEpisodeExamples() {
      showHelp();
      showEpisodeHelp();
    }

    function showCausalExamples() {
      showHelp();
      showCausalHelp();
    }

    function showVectorExamples() {
      showHelp();
      showVectorHelp();
    }

    function showOptimizationTips() {
      showHelp();
      showOptimizerHelp();
    }

    // Batch Operations
    function showBatchPatterns() {
      logToConsole('info', 'Batch pattern import feature coming soon!');
    }

    function showTrajectoryView() {
      try {
        // Query all episodes from database
        const episodes = sqlAll('SELECT * FROM episodes ORDER BY created_at ASC');

        if (episodes.length === 0) {
          alert('No episodes found. Add some episodes first to visualize trajectories.');
          return;
        }

        // Analyze trajectory trends
        const trends = analyzeTrajectoryTrends(episodes);

        // Generate visualization
        const content = generateTrajectoryVisualization(episodes, trends);

        // Display in modal
        document.getElementById('trajectoryContent').innerHTML = content;
        document.getElementById('trajectoryModal').classList.add('active');

        logToConsole('success', `Visualizing ${episodes.length} episodes`);
      } catch (error) {
        logToConsole('error', `Failed to show trajectory view: ${error.message}`);
        alert('Failed to load trajectory visualization. Check console for details.');
      }
    }

    function closeTrajectoryView() {
      document.getElementById('trajectoryModal').classList.remove('active');
    }

    function analyzeTrajectoryTrends(episodes) {
      if (!episodes || episodes.length === 0) {
        return {
          totalEpisodes: 0,
          avgReward: 0,
          successRate: 0,
          trend: 'stable',
          rewardDistribution: { high: 0, medium: 0, low: 0 },
          topStrategies: []
        };
      }

      // Calculate statistics
      const rewards = episodes.map(e => e.reward || 0);
      const totalReward = rewards.reduce((sum, r) => sum + r, 0);
      const avgReward = totalReward / episodes.length;
      const maxReward = Math.max(...rewards);
      const minReward = Math.min(...rewards);

      // Calculate success rate (rewards > 0.5)
      const successfulEpisodes = episodes.filter(e => (e.reward || 0) >= 0.5).length;
      const successRate = (successfulEpisodes / episodes.length) * 100;

      // Determine trend (compare first half vs second half)
      const halfPoint = Math.floor(episodes.length / 2);
      const firstHalfAvg = rewards.slice(0, halfPoint).reduce((sum, r) => sum + r, 0) / halfPoint;
      const secondHalfAvg = rewards.slice(halfPoint).reduce((sum, r) => sum + r, 0) / (episodes.length - halfPoint);

      let trend = 'stable';
      const trendDiff = secondHalfAvg - firstHalfAvg;
      if (trendDiff > 0.1) trend = 'up';
      else if (trendDiff < -0.1) trend = 'down';

      // Reward distribution
      const rewardDistribution = {
        high: episodes.filter(e => (e.reward || 0) >= 0.7).length,
        medium: episodes.filter(e => (e.reward || 0) >= 0.3 && (e.reward || 0) < 0.7).length,
        low: episodes.filter(e => (e.reward || 0) < 0.3).length
      };

      // Extract top strategies (from metadata or actions)
      const strategyMap = new Map();
      episodes.forEach(episode => {
        let strategy = 'Unknown';
        try {
          const metadata = typeof episode.metadata === 'string' ? JSON.parse(episode.metadata) : episode.metadata;
          strategy = metadata?.strategy || metadata?.type || episode.action?.substring(0, 30) || 'Unknown';
        } catch {
          strategy = episode.action?.substring(0, 30) || 'Unknown';
        }

        if (!strategyMap.has(strategy)) {
          strategyMap.set(strategy, { count: 0, totalReward: 0 });
        }
        const data = strategyMap.get(strategy);
        data.count++;
        data.totalReward += episode.reward || 0;
      });

      // Sort strategies by average reward
      const topStrategies = Array.from(strategyMap.entries())
        .map(([name, data]) => ({
          name,
          avgReward: data.totalReward / data.count,
          count: data.count
        }))
        .sort((a, b) => b.avgReward - a.avgReward)
        .slice(0, 5);

      return {
        totalEpisodes: episodes.length,
        avgReward: avgReward.toFixed(3),
        maxReward: maxReward.toFixed(3),
        minReward: minReward.toFixed(3),
        successRate: successRate.toFixed(1),
        trend,
        trendValue: trendDiff.toFixed(3),
        rewardDistribution,
        topStrategies
      };
    }

    function generateTrajectoryVisualization(episodes, trends) {
      const trendIcons = {
        up: '<span class="stat-trend trend-up"></span>',
        down: '<span class="stat-trend trend-down"></span>',
        stable: '<span class="stat-trend trend-stable"></span>'
      };

      const html = `
        <!-- Statistics Cards -->
        <div class="trajectory-stats">
          <div class="stat-card">
            <div class="stat-value">${trends.totalEpisodes}</div>
            <div class="stat-label">Total Episodes</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${trends.avgReward}${trendIcons[trends.trend]}</div>
            <div class="stat-label">Avg Reward</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${trends.successRate}%</div>
            <div class="stat-label">Success Rate</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${trends.maxReward}</div>
            <div class="stat-label">Peak Reward</div>
          </div>
        </div>

        <!-- Reward Distribution Chart -->
        <div class="trajectory-chart">
          <div class="chart-title"> Reward Distribution</div>
          <div class="reward-distribution">
            <div class="reward-bar reward-bar-high">
              <div style="font-weight: 700; font-size: 1.25rem;">${trends.rewardDistribution.high}</div>
              <div style="font-size: 0.75rem; opacity: 0.8;">High (0.7)</div>
            </div>
            <div class="reward-bar reward-bar-medium">
              <div style="font-weight: 700; font-size: 1.25rem;">${trends.rewardDistribution.medium}</div>
              <div style="font-size: 0.75rem; opacity: 0.8;">Medium (0.3-0.7)</div>
            </div>
    // Causal Path Analysis functions loaded from external file
            </div>
          </div>
          <div style="margin-top: 1rem; text-align: center; color: var(--text-secondary); font-size: 0.875rem;">
            Trend: ${trends.trend === 'up' ? ' Improving' : trends.trend === 'down' ? ' Declining' : ' Stable'}
            (${trends.trendValue > 0 ? '+' : ''}${trends.trendValue})
          </div>
        </div>

        <!-- Timeline -->
        <div class="trajectory-chart">
          <div class="chart-title"> Episode Timeline (Latest ${Math.min(20, episodes.length)})</div>
          <div class="timeline">
            ${generateTimelineHTML(episodes.slice(-20).reverse())}
          </div>
        </div>

        <!-- Top Strategies -->
        ${trends.topStrategies.length > 0 ? `
        <div class="trajectory-chart">
          <div class="chart-title"> Top Performing Strategies</div>
          <ul class="strategy-list">
            ${trends.topStrategies.map((strategy, index) => `
              <li class="strategy-item">
                <span class="strategy-name">#${index + 1} ${escapeHtml(strategy.name)}</span>
                <span class="strategy-score">${strategy.avgReward.toFixed(3)} avg (${strategy.count}x)</span>
              </li>
            `).join('')}
          </ul>
        </div>
        ` : ''}
      `;

      return html;
    }

    function generateTimelineHTML(episodes) {
      return episodes.map(episode => {
        const reward = episode.reward || 0;
        const rewardClass = reward >= 0.7 ? 'reward-high' : reward >= 0.3 ? 'reward-medium' : 'reward-low';
        const timestamp = new Date(episode.created_at * 1000);
        const timeStr = timestamp.toLocaleString('en-US', {
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });

        return `
          <div class="timeline-item ${rewardClass}">
            <div class="timeline-marker"></div>
            <div class="timeline-content">
              <div class="timeline-task">${escapeHtml(episode.task || 'Untitled Task')}</div>
              <div class="timeline-reward">Reward: ${reward.toFixed(3)}</div>
            </div>
            <div class="timeline-time">${timeStr}</div>
          </div>
        `;
      }).join('');
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function analyzeCausalPaths() {
      logToConsole('info', 'Causal path analysis feature coming soon!');
    }

    // Utility Functions
    function clearVectorSearch() {
      document.getElementById('vector-query').value = '';
      document.getElementById('vector-results').innerHTML = '<div class="empty-state"><div class="empty-state-icon"></div><div class="empty-state-title">Enter a query to search</div><div class="empty-state-text">Semantic search using vector embeddings</div></div>';
    }

    function clearOptimizer() {
      document.getElementById('optimizer-query').value = '';
      document.getElementById('optimizer-results').innerHTML = '<div class="empty-state"><div class="empty-state-icon"></div><div class="empty-state-title">Paste a query to analyze</div><div class="empty-state-text">Get performance insights and optimization suggestions</div></div>';
    }

    function loadFromEditor() {
      const editorQuery = document.getElementById('sql-editor').value;
      document.getElementById('optimizer-query').value = editorQuery;
      logToConsole('info', 'Query loaded from editor');
    }

    // ============================================================================
    // INITIALIZATION
    // ============================================================================

    window.addEventListener('DOMContentLoaded', async () => {
      logToConsole('info', ' AgentDB Management IDE v1.0.0');
      logToConsole('info', 'Built for AgentDB v1.3.9');
      logToConsole('info', 'Visit https://agentdb.ruv.io for more information');

      // Load settings from localStorage
      const savedSettings = localStorage.getItem('agentdb-ide-settings');
      if (savedSettings) {
        state.settings = { ...state.settings, ...JSON.parse(savedSettings) };
        logToConsole('info', 'Settings loaded from localStorage');
      }

      // Initialize database
      await initializeDatabase();

      // Initialize performance metrics display
      updateStats();
      logToConsole('info', 'Performance metrics initialized');

      // Update dashboard stats
      updateDashboardStats();
      logToConsole('info', 'Dashboard initialized');

      logToConsole('success', ' IDE ready!');
    });
  </script>

</body>
</html>